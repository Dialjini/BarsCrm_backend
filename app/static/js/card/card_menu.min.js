let saveTableAndCard;function getCurrentTime(){let t=new Date;return`${t.getHours()>12?t.getHours():t.getHours()<10?"0"+t.getHours():t.getHours()}:${t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()}`}function getCurrentDate(t="none"){let e=new Date,n=+e.getMonth()<10?"0"+ +e.getMonth():+e.getMonth(),i=e.getDate()<10?"0"+e.getDate():e.getDate();if("none"!==t){let t=e.getFullYear();return`${i}.${n}.${t=String(t).substring(2,4)}`}return`${i}.${n}`}function getCurrentDateNotComparison(t="none"){let e=new Date,n=+e.getMonth()<9?"0"+(+e.getMonth()+1):+e.getMonth()+1,i=e.getDate()<10?"0"+e.getDate():e.getDate();if("none"!==t){let t=e.getFullYear();return`${i}.${n}.${t=String(t).substring(2,4)}`}return`${i}.${n}`}function createCardMenu(t,e=0){$("body").append('\n        <div id="preloader">\n            <div id="preloader_preload"></div>\n        </div>\n    '),preloader=document.getElementById("preloader_preload"),sortStatus={product:{status:!1,filter:null,last:null},price:{status:!1,filter:null},area:{status:!1,filter:null},category:{status:!1,filter:null,last:null},manager:{status:!1,filter:null,last:null},customer:{status:!1,filter:null,last:null},status:{status:!1,filter:null,last:null},date:{status:!1,filter:null,last:null},search_on_regions:{status:!1,filter:null,last:null}},0==e?($(".table, .blockCreateEmptyCard").remove(),$('[name="linkCategory"]').removeClass("active")):$(".overflow").remove(),$(".card_menu").remove();let n=t.id.split("_"),i=new Object;const a=[{id:"client",list:[],link:function(t){return $("<div>",{class:"row_card",append:$("<table>",{class:"table_block",append:$("<tr>",{append:$("<td>",{class:"bold",html:"Наименование"}).add($("<td>",{append:$("<input>",{type:"text",id:"client_name",onchange:"saveCard()",value:t.Name,class:"string",onblur:"hiddenFullField(this.id)",onfocus:"viewFullField(this.id)"})}))}).add(`<tr>\n                            <td>Область/Край</td>\n                            <td>\n                                <select id="client_region" onchange="getListAreas(this)"></select>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>Район</td>\n                            <td><select id="client_area" onchange="saveCard()"></select></td>\n                        </tr>\n                        <tr>\n                            <td>Адрес</td>\n                            <td><input type="text" autocomplete="off" class="string" onblur="hiddenFullField(this.id)" onfocus="viewFullField(this.id)" id="client_address" onchange="saveCard()" value="${t.Adress}"></td>\n                        </tr>\n                        <tr>\n                            <td>Факт. адрес</td>\n                            <td><input type="text" class="string" onblur="hiddenFullField(this.id)" onfocus="viewFullField(this.id)" id="client_factual_address" onchange="saveCard()" value="${t.Fact_address}"></td>\n                        </tr>\n                    `)}).add(`\n                    <div class="visible_block">\n                        <div class="visible_info">\n                            <div id="props" class="visible_title" onclick="showOrHideInfo(this.id)">\n                                <span>Реквизиты</span>\n                                <img id="hidden_image_props" src="static/images/dropmenu_black.svg" class="drop_down_img">\n                            </div>\n                            <table id="hidden_info_props" class="table_block" style="display:none; margin-bottom: 20px;">\n                                <tr>\n                                    <td>ИНН</td>\n                                    <td><input maxlength="12" class="string" type="text" id="client_inn" onchange="saveCard()" value="${t.UHH}"></td>\n                                </tr>\n                                <tr>\n                                    <td>БИК</td>\n                                    <td><input type="text" class="string" maxlength="9" id="client_bik" onchange="saveCard()" value="${t.Bik}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Корр. счёт</td>\n                                    <td><input type="text" class="string" maxlength="20" id="client_kc" onchange="saveCard()" value="${t.kc}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Расч. счёт</td>\n                                    <td><input type="text" class="string" maxlength="20" id="client_rc" onchange="saveCard()" value="${t.rc}"></td>\n                                </tr>\n                                <tr>\n                                    <td>КПП</td>\n                                    <td><input type="text" class="string" maxlength="20" id="client_kpp" onchange="saveCard()" value="${t.kpp}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Директор</td>\n                                    <td><input type="text" class="string" maxlength="20" id="client_director" onchange="saveCard()" value="${t.Director}"></td>\n                                </tr>\n                            </table>\n                        </div>\n                        <div class="visible_info">\n                            <div id="additional" class="visible_title" onclick="showOrHideInfo(this.id)">\n                                <span>Доп. информация</span>\n                                <img id="hidden_image_additional" src="static/images/dropmenu_black.svg" class="drop_down_img">\n                            </div>\n                            <table id="hidden_info_additional" class="table_block" style="display: none;">\n                                <tr>\n                                    <td>Категория</td>\n                                    <td>\n                                        <select id="client_category" onchange="itemSelection(this)">\n                                            <option value="disabled" selected disabled>Выбрать</option>\n                                            <option value="category_0">Клиент</option>\n                                            <option value="category_1">Потенциальный клиент</option>\n                                            <option value="category_2">Лидер</option>\n                                            <option value="category_3">Неперспективный клиент</option>\n                                        </select>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>Ж/Д Станция</td>\n                                    <td> <input type="text" id="client_station" autocomplete="off" onblur="hiddenFullField(this.id)" onfocus="viewFullField(this.id)" onchange="saveCard()" class="string" value="${t.Station}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Цена вагона, руб.</td>\n                                    <td><input type="text" onkeyup="maskNumber(this.id)" id="client_price" onchange="saveCard()" class="string" value="${t.Price}"></td>\n                                </tr>\n                                <tr>\n                                    <td>км от НСК</td>\n                                    <td><input type="text" onkeyup="maskNumber(this.id)" id="client_distance" onchange="saveCard()" class="string" value="${t.Distance}"></td>\n                                </tr>\n                            </table>\n                        </div>\n                    </div>\n                    <div class="info_block">\n                        <span class="lightgray">Отрасль</span>\n                        <select id="client_industry" onchange="itemSelection(this)">\n                            <option value="disabled" selected disabled>Выбрать</option>\n                            <option value="industry_0">Животноводство</option>\n                            <option value="industry_1">Птицеводство</option>\n                            <option value="industry_2">Свиноводство</option>\n                            <option value="industry_3">Растениеводство</option>\n                            <option value="industry_4">Рыбоводство</option>\n                            <option value="industry_5">Комбикормовый</option>\n                        </select>\n                        <span class="lightgray" style="margin-top: 17px;">Поголовье</span>\n                        <table>\n                            <tr>\n                                <th>Общее</th>\n                                <th>Дойного</th>\n                                <th>Надои</th>\n                            </tr>\n                            <tbody id="livestock">\n                                <tr>\n                                    <td><input onkeyup="maskNumberWithout(this.id)" id="livestock_general" type="text" style="width: 75px" value="${t.Livestock_all}"></td>\n                                    <td><input onkeyup="maskNumberWithout(this.id)" id="livestock_milking" type="text" style="width: 75px" value="${t.Livestock_milking}"></td>\n                                    <td><input onkeyup="maskNumberWithout(this.id)" id="livestock_milkyield" type="text" style="width: 75px" value="${t.Livestock_milkyield}"></td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>`)}).add('<div class="row_card" id="media">\n                    <div class="left_side">\n                        <div class="hmax" id="member"></div>\n                        <div class="events">\n                            <img class="add_something" src="static/images/add.png" onclick="addMember()">\n                        </div>\n                    </div>\n                    <div class="info_block" style="width: fit-content">\n                        <span class="lightgray">Группа товаров</span>\n                        <div class="hmax">\n                            <table>\n                                <tr>\n                                    <th>Товар</th>\n                                    <th>Объем, кг.</th>\n                                    <th>У кого</th>\n                                    <th>Цена, руб.</th>\n                                </tr>\n                                <tbody id="group"></tbody>\n                            </table>\n                        </div>\n                        <div class="events">\n                            <img class="add_something" id="client-group" src="static/images/add.png" onclick="addRow(this.id)">\n                            <img name="remove_last_group" class="add_something" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">\n                        </div>\n                    </div>\n                </div>\n                <div class="area">\n                    <div class="history">\n                        <div class="title">\n                            <div>История обращений</div>\n                            <img id="add_new_comment" onclick="addComment()" class="add_something" src="static/images/add.png">\n                        </div>\n                        <div class="messages">\n                            <table class="message">\n                                <tbody id="messages"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                    <div class="last_comment">\n                        <div class="title">\n                            <div>Последние комментарии</div>\n                            <img id="save_new_comment" onclick="getCommentsInfo.getRequest(this.name)" class="add_something save" src="static/images/save_comment.png">\n                        </div>\n                        <div class="messages">\n                            <table class="message">\n                                <tbody id="comments"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n                <div class="next">\n                    <button class="btn btn-main" id="client" onclick="contractNext(this)">Выставить</button>\n                </div>')},status:n[1]},{id:"provider",list:[],link:function(t){return $("<div>",{class:"row_card",append:$("<table>",{class:"table_block",append:$("<tr>",{append:$("<td>",{class:"bold",html:"Наименование"}).add($("<td>",{append:$("<input>",{type:"text",id:"provider_name",value:t.Name,onchange:"saveCard()",class:"string",onblur:"hiddenFullField(this.id)",onfocus:"viewFullField(this.id)"})}))}).add(`<tr>\n                            <td>Область/Край</td>\n                            <td>\n                                <select id="provider_region" onchange="getListAreas(this)"></select>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>Район</td>\n                            <td><select id="provider_area" onchange="saveCard()"></select></td>\n                        </tr>\n                        <tr>\n                            <td>Адрес</td>\n                            <td>\n                                <input type="text" class="string" autocomplete="off" onblur="hiddenFullField(this.id)" onfocus="viewFullField(this.id)" id="provider_address" onchange="saveCard()" value="${t.Adress}">\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>ИНН</td>\n                            <td>\n                                <input type="text" maxlength="12" class="string" id="provider_inn" onchange="saveCard()" value="${t.UHH}">\n                            </td>\n                        </tr>`)}).add(`<table class="table_block">\n                        <tr>\n                            <td>Ж/Д Станция</td>\n                            <td>\n                                <input type="text" id="provider_station" autocomplete="off" onblur="hiddenFullField(this.id)" onfocus="viewFullField(this.id)" class="string" onchange="saveCard()" value="${t.Train}">\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>Цена вагона, руб.</td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id)" type="text" id="provider_price" class="string" onchange="saveCard()" value="${t.Price}">\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>км от НСК</td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id)" type="text" id="provider_distance" class="string" onchange="saveCard()" value="${t.Distance}">\n                            </td>\n                        </tr>\n                    </table>\n                    <table class="table_block">\n                        <tr>\n                            <td>Объем про-ва, кг.</td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id)" type="text" id="provider_volume" class="string" onchange="saveCard()" value="${t.Volume}">\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>Меркурий</td>\n                            <td>\n                                <input type="text" id="provider_merc" class="string" onchange="saveCard()" value="${t.Merc}">\n                            </td>\n                        </tr>\n                    </table>`)}).add('<div class="row_card" id="media">\n                    <div class="left_side">\n                        <div class="hmax" id="member"></div>\n                        <div class="events">\n                            <img class="add_something" src="static/images/add.png" onclick="addMember()">\n                        </div>\n                    </div>\n                    <div class="info_block" style="width: fit-content">\n                        <span class="lightgray">Группа товаров</span>\n                        <div class="hmax">\n                            <table>\n                                <tr>\n                                    <th>Товар</th>\n                                    <th>Цена, руб.</th>\n                                    <th>Дата</th>\n                                    <th>НДС</th>\n                                    <th>Фасовка</th>\n                                    <th>Вес, кг.</th>\n                                    <th>Фракция</th>\n                                </tr>\n                                <tbody id="group"></tbody>\n                            </table>\n                        </div>\n                        <div class="events">\n                            <img class="add_something" id="provider-group" src="static/images/add.png" onclick="addRow(this.id)">\n                            <img name="remove_last_group" class="add_something" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">\n                        </div>\n                    </div>\n                </div>\n                <div class="area">\n                    <div class="history">\n                        <div class="title">\n                            <div>История обращений</div>\n                            <img id="add_new_comment" onclick="addComment()" class="add_something" src="static/images/add.png">\n                        </div>\n                        <div class="messages">\n                            <table class="message">\n                                <tbody id="messages"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                    <div class="last_comment">\n                        <div class="title">\n                            <div>Последние комментарии</div>\n                            <img id="save_new_comment" onclick="getCommentsInfo.getRequest(this.name)" class="add_something save" src="static/images/save_comment.png">\n                        </div>\n                        <div class="messages">\n                            <table class="message">\n                                <tbody id="comments"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n                <div class="next">\n                    <button class="btn btn-main" id="provider" onclick="closeCardMenu(this.name)">Сохранить</button> \n                </div>')},status:n[1]},{id:"carrier",list:[],link:function(t){return $("<div>",{class:"row_card",css:{"justify-content":"flex-start"},append:$("<table>",{class:"table_block",css:{"margin-right":"50px"},append:$("<tr>",{append:$("<td>",{class:"bold",html:"Наименование"}).add($("<td>",{append:$("<input>",{type:"text",id:"carrier_name",value:t.Name,onchange:"saveCard()",class:"string",onblur:"hiddenFullField(this.id)",onfocus:"viewFullField(this.id)"})}))}).add(`<tr>\n                            <td>Область/Край</td>\n                            <td>\n                                <select id="carrier_region" onchange="getListAreas(this)"></select>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>Район</td>\n                            <td><select id="carrier_area" onchange="saveCard()"></select></td>\n                        </tr>\n                        <tr>\n                            <td>Адрес</td>\n                            <td>\n                                <input type="text" id="carrier_address" autocomplete="off" onblur="hiddenFullField(this.id)" onfocus="viewFullField(this.id)" onchange="saveCard()" class="string" value="${t.Address}">\n                            </td>\n                        </tr>`)}).add(`<table class="table_block">\n                        <tr>\n                            <td>ИНН</td>\n                            <td>\n                                <input type="text" id="carrier_inn" maxlength="12" onchange="saveCard()" class="string" value="${t.UHH}">\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>БИК</td>\n                            <td><input type="text" class="string" maxlength="9" id="carrier_bik" onchange="saveCard()" value="${t.Bik}"></td>\n                        </tr>\n                        <tr>\n                            <td>Корр. счёт</td>\n                            <td><input type="text" class="string" maxlength="20" id="carrier_kc" onchange="saveCard()" value="${t.kc}"></td>\n                        </tr>\n                        <tr>\n                            <td>Расч. счёт</td>\n                            <td><input type="text" class="string" maxlength="20" id="carrier_rc" onchange="saveCard()" value="${t.rc}"></td>\n                        </tr>\n                        <tr>\n                            <td>КПП</td>\n                            <td><input type="text" class="string" maxlength="20" id="carrier_kpp" onchange="saveCard()" value="${t.kpp}"></td>\n                        </tr>\n                        <tr>\n                            <td>Директор</td>\n                            <td><input type="text" class="string" maxlength="20" id="carrier_director" onchange="saveCard()" value="${t.Director}"></td>\n                        </tr>\n                    </table>`).add(`\n                    <table class="table_block">\n                        <tr>\n                            <td>Грузоподъемность, кг.</td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id)" type="text" id="carrier_capacity" onchange="saveCard()" value="${t.Capacity}" class="string">\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>Вид перевозки</td>\n                            <td>\n                                <select id="carrier_view">\n                                    ${function(){if(""==t.View)return'\n                    <option selected disabled value="">Не выбран</option>\n                    <option value="Авто">Авто</option>\n                    <option value="Ж/Д">Ж/Д</option>\n                ';if("Авто"==t.View)return'\n                        <option selected value="Авто">Авто</option>\n                        <option value="Ж/Д">Ж/Д</option>\n                    ';if("Ж/Д"==t.View)return'\n                        <option value="Авто">Авто</option>\n                        <option selected value="Ж/Д">Ж/Д</option>\n                    '}()}\n                                </select>\n                            </td>\n                        </tr>\n                    </table>\n                    `)}).add(`<div class="row_card" id="media">\n                    <div class="left_side">\n                        <div class="hmax" id="member"></div>\n                        <div class="events">\n                            <img class="add_something" src="static/images/add.png" onclick="addMember('carrier')">\n                        </div>\n                    </div>\n                    <div class="info_block" style="width: fit-content">\n                        <span class="lightgray">Рейсы</span>\n                        <div class="hmax">\n                            <table>\n                                <tr>\n                                    <th>Дата</th>\n                                    <th>Клиент</th>\n                                    <th>Склад</th>\n                                    <th>Водитель</th>\n                                    <th>Цена, руб.</th>\n                                </tr>\n                                ${function(){let e=null==t.Items_delivery?null:JSON.parse(t.Items_delivery),n="";if(null!==e)for(let t=0;t<e.length;t++){let i=0;for(let n=t+1;n<e.length;n++)e[t].delivery_id==e[n].delivery_id&&(i+=+deleteSpaces(e[t].sum),e.splice(1,n),n--);0==i&&(i=e[t].sum),n+=`\n                        <tr>\n                            <td>${e[t].date}</td>\n                            <td>${e[t].client}</td>\n                            <td>${e[t].stock}</td>\n                            <td>${e[t].contact}</td>\n                            <td>${returnSpaces(i)}</td>\n                        </tr>\n                    `}return n}()}\n                            </table>\n                        </div>\n                    </div>\n                </div>\n                <div class="area">\n                    <div class="history">\n                        <div class="title">\n                            <div>История обращений</div>\n                            <img id="add_new_comment" onclick="addComment()" class="add_something" src="static/images/add.png">\n                        </div>\n                        <div class="messages">\n                            <table class="message">\n                                <tbody id="messages"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                    <div class="last_comment">\n                        <div class="title">\n                            <div>Последние комментарии</div>\n                            <img id="save_new_comment" onclick="getCommentsInfo.getRequest(this.name)" class="add_something save" src="static/images/save_comment.png">\n                        </div>\n                        <div class="messages">\n                            <table class="message">\n                                <tbody id="comments"></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n                <div class="next">\n                    <button class="btn btn-main" id="carrier" onclick="contractNext(this)">Оформить Договор</button>\n                </div>`)},status:n[1]},{id:"debit",list:[""],link:function(t){return"Секретное место. Если вы видите это сообщение, то что-то пошло не так. Сообщите об этом вашему непосредственному руководству."},status:n[1]},{id:"account",list:[],link:function(t){let e,n=!1;$.ajax({url:"/getStockTable",type:"GET",async:!1,dataType:"html",success:function(t){t=JSON.parse(t),null==categoryInStock[1][1]&&categoryInStock[1].push(t),$.ajax({url:"/getDeliveries",type:"GET",async:!1,dataType:"html",success:function(t){e=JSON.parse(t)}})}});let i=0,a=0,d=JSON.parse(t.account.Sale),s=JSON.parse(t.account.Hello),l=JSON.parse(t.account.Shipping),o=JSON.parse(t.account.Items_amount),c=t.account.id;for(let t=0;t<e.length;t++)e[t].delivery.Account_id==c&&(n=!0);t.account.Payment_history.length>22&&(n=!0);let r=!1;return function(){let e=JSON.parse(t.account.Payment_history),n=deleteSpaces(t.account.Sum),i=0;for(let t=0;t<e.length;t++)i+=+deleteSpaces(e[t].sum);r=+n<=+i||0!=+i}(),`${n?`\n                    <div class="row_card">\n                        <div class="costs gray">\n                            <div class="costs_element">\n                                <span>Всего затраты</span>\n                                <input type="text" value="${returnSpaces(t.account.Total_costs)}" disabled id="total_costs_inv" class="total_count red bold mrl">\n                            </div> \n                            <div class="costs_element">\n                                <span>Скидка</span> \n                                <input type="text" value="${t.account.Sale_costs}" disabled id="total_discount_inv" class="total_count bold mrl">\n                            </div>\n                            <div class="costs_element">\n                                <span>Привет</span> \n                                <input type="text" value="${returnSpaces(t.account.Hello_costs)}" disabled id="total_privet_inv" class="total_count bold mrl">\n                            </div>\n                            <div class="costs_element">\n                                <span>Доставка</span> \n                                <input type="text" value="${returnSpaces(t.account.Delivery_costs)}" disabled id="total_delivery_inv" class="total_count bold mrl">\n                            </div>\n                        </div>\n                        ${"true"==t.account.Shipment||r?"":`<div class="info_block">\n                            <span class="lightgray">Актуальность счета</span>\n                            ${"true"==t.account.Status?'<input checked type="checkbox" id="account_status">':'<input type="checkbox" id="account_status">'}\n                            <label for="account_status">Этот счет не актуален</label>\n                        </div>`}\n                    </div>\n                `:`\n                <div class="row_card">\n                    <div class="costs gray">\n                        <div class="costs_element">\n                            <span>Всего затраты</span>\n                            <input type="text" value="${returnSpaces(t.account.Total_costs)}" onkeyup="maskNumberWithout(this.id); all_costs()" id="total_costs_inv" class="total_count red bold mrl">\n                            <div name="unlock" class="lock_input" id="mode_costs" onclick="switchMode(this)"></div>\n                        </div> \n                        <div class="costs_element">\n                            <span>Скидка</span> \n                            <input type="text" value="${t.account.Sale_costs}" onkeyup="calculationIndicators()" value="" onblur="dataСalculation(this)" id="total_discount_inv" class="total_count bold mrl">\n                            <div name="unlock" class="lock_input" id="mode_discount" onclick="switchMode(this)"></div>\n                        </div>\n                        <div class="costs_element">\n                            <span>Привет</span> \n                            <input type="text" value="${returnSpaces(t.account.Hello_costs)}" onkeyup="maskNumberWithout(this.id); calculationIndicators()" value="" onblur="dataСalculation(this)" id="total_privet_inv" class="total_count bold mrl">\n                            <div name="unlock" class="lock_input" id="mode_privet" onclick="switchMode(this)"></div>\n                        </div>\n                        <div class="costs_element">\n                            <span>Доставка</span> \n                            <input type="text" value="${returnSpaces(t.account.Delivery_costs)}" onkeyup="maskNumberWithout(this.id); calculationIndicators()" value="" onblur="dataСalculation(this)" id="total_delivery_inv" class="total_count bold mrl">\n                            <div name="unlock" class="lock_input" id="mode_delivery" onclick="switchMode(this)"></div>\n                        </div>\n                    </div>\n                    ${"true"==t.account.Shipment||r?"":`<div class="info_block">\n                        <span class="lightgray">Актуальность счета</span>\n                        ${"true"==t.account.Status?'<input checked type="checkbox" id="account_status">':'<input type="checkbox" id="account_status">'}\n                        <label for="account_status">Этот счет не актуален</label>\n                    </div>`}\n                </div>\n            `}\n                <div class="row_card">\n                    <div class="info_block full">\n                        <table class="account_table new_table">\n                            <tr>\n                                <th width="15" rowspan="2"></th>\n                                <th width="150" rowspan="2">Товар</th>\n                                <th colspan="2">Фасовка</th>\n                                <th colspan="2">Количество</th>\n                                <th colspan="5">Цена, руб.</th>\n                                <th style="width: 90px;" rowspan="2">Сумма</th>\n                            </tr>\n                            <tr>\n                                <th>Вид</th>\n                                <th width="55">Вес, кг.</th>\n                                <th width="65">Всего, шт.</th>\n                                <th width="75">Объем, кг.</th>\n                                <th width="85">Цена прайса, руб.</th>\n                                <th width="60">Скидка</th>\n                                <th width="60">Привет</th>\n                                <th width="60">Доставка</th>\n                                <th width="75">За единицу</th>\n                            </tr>\n                            <tbody id="exposed_list">\n                                ${function(){let e=t.items,c="",r=[],u=[];for(let t=0;t<e.length;t++){r.push(e[t].Stock_id),u.push(e[t].Item_id),i+=+deleteSpaces(o[t].amount);let a=deleteSpaces(d[t]),p=deleteSpaces(s[t]),m=deleteSpaces(l[t]),v=+a+ +p+ +m+ +deleteSpaces(e[t].Cost);c=n?c.concat(`\n                        <tr class="product invoiled" id="product_${e[t].Item_id}">\n                            <td></td>\n                            <td>${e[t].Name}</td>\n                            <td>${e[t].Packing}</td>\n                            <td id="product_weight_${e[t].Item_id}">${returnSpaces(e[t].Weight)}</td>\n                            <td id="product_containers_${e[t].Item_id}">${returnSpaces(Math.round(+deleteSpaces(e[t].Transferred_volume)/+deleteSpaces(e[t].Weight)))}</td>\n                            <td>\n                                <input type="text" disabled id="invoiled_volume_${e[t].Item_id}" value="${returnSpaces(e[t].Transferred_volume)}">\n                            </td>\n                            <td id="product_cost_${e[t].Item_id}">${returnSpaces(e[t].Cost)}</td>\n                            <td>\n                                <input type="text" value="${returnSpaces(d[t])}" name="edit" id="calcSale_${e[t].Item_id}" disabled>\n                            </td>\n                            <td>\n                                <input type="text" value="${returnSpaces(s[t])}" name="edit" id="calcPrivet_${e[t].Item_id}" disabled>\n                            </td>\n                            <td>\n                                <input type="text" value="${returnSpaces(l[t])}" name="edit" id="calcDelivery_${e[t].Item_id}" disabled>\n                            </td>\n                            <td id="product_unit_${e[t].Item_id}">${returnSpaces(v)}</td>\n                            <td id="amountC_${e[t].Item_id}">${returnSpaces(o[t].amount)}</td>\n                        </tr>\n                    `):c.concat(`\n                        <tr class="product invoiled" id="product_${e[t].Item_id}">\n                            <td id="invoiled_${e[t].Item_id}" onclick="deleteProduct(this.id)">\n                                <img src="../static/images/returnBack.png" style="width: 12px;">\n                            </td>\n                            <td>${e[t].Name}</td>\n                            <td>${e[t].Packing}</td>\n                            <td id="product_weight_${e[t].Item_id}">${returnSpaces(e[t].Weight)}</td>\n                            <td id="product_containers_${e[t].Item_id}">${returnSpaces(Math.round(+deleteSpaces(e[t].Transferred_volume)/+deleteSpaces(e[t].Weight)))}</td>\n                            <td>\n                                <input type="text" onkeyup="maskNumberWithout(this.id); tarCalculation(this.id)" id="invoiled_volume_${e[t].Item_id}" value="${returnSpaces(e[t].Transferred_volume)}">\n                            </td>\n                            <td id="product_cost_${e[t].Item_id}">${returnSpaces(e[t].Cost)}</td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id); recountPrice(this)" type="text" value="${returnSpaces(d[t])}" name="edit" id="calcSale_${e[t].Item_id}">\n                            </td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id); recountPrice(this)" type="text" value="${returnSpaces(s[t])}" name="edit" id="calcPrivet_${e[t].Item_id}">\n                            </td>\n                            <td>\n                                <input onkeyup="maskNumber(this.id); recountPrice(this)" type="text" value="${returnSpaces(l[t])}" name="edit" id="calcDelivery_${e[t].Item_id}">\n                            </td>\n                            <td id="product_unit_${e[t].Item_id}">${returnSpaces(v)}</td>\n                            <td id="amountC_${e[t].Item_id}">${returnSpaces(o[t].amount)}</td>\n                        </tr>\n                    `)}for(let t=0;t<r.length-1;t++)for(let e=t+1;e<r.length;e++)r[t]==r[e]&&(r.splice(e,1),e--);if(c=c.concat(`\n                <div id="stock_items_list" style="display: none" data-stock="${r}" data-items="${u}"></div>\n            `),e[0].NDS=e[0].NDS[0]+e[0].NDS[1],a=i>0?i-i*+e[0].NDS/100:0,5-e.length>0)for(let t=0;t<5-e.length;t++)c=c.concat('\n                        <tr class="product">\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                            <td></td>\n                        </tr>\n                    ');return c}()}\n                            </tbody>\n                            <tr>\n                                <td colspan="10" style="border: none; border-top: 1px solid #e9e9e9"></td>\n                                <td colspan="2" class="fz10">\n                                    <div class="flex jc-sb"><span class="gray">НДС</span><span id="vat">${returnSpaces(Math.round(i-a))}</span></div>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td colspan="10" style="border: none;"></td>\n                                <td colspan="2" class="fz10">\n                                    <div class="flex jc-sb"><span class="gray">Без НДС</span><span id="without-vat">${returnSpaces(Math.round(a))}</span></div>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td colspan="10" style="border: none;"></td>\n                                <td colspan="2" class="fz10">\n                                    <div class="flex jc-sb"><span class="gray">Общая</span><span id="total">${returnSpaces(Math.round(i))}</span></div>\n                                </td>\n                            </tr>\n                        </table>\n                    </div>\n                </div>\n                ${n?"":`<div class="search_items">\n                        <input type="text" id="invoice_search_items" name="${t.account.id}">\n                        <button onclick="searchItemsInAccount()" class="btn btn-main btn-srch btn-srch-left">Поиск</button>\n                    </div>`}\n                <div class="row_card" id="row_output_table">\n                    ${function(){if(n)return"";{let e;return $.ajax({url:"/getStockTable",type:"GET",dataType:"html",async:!1,success:function(n){n=JSON.parse(n),e=`\n                            <div class="info_block full hmax">\n                                <table class="account_table new_table" id="output_table">\n                                    <tr>\n                                        <th>Группа товаров</th>\n                                        <th>Товар</th>\n                                        <th>Юр. лицо</th>\n                                        <th>Объем, кг.</th>\n                                        <th>Фасовка</th>\n                                        <th>НДС</th>\n                                        <th>Цена прайса, руб.</th>\n                                        <th>Склад</th>\n                                    </tr>\n                                    ${function(){let e='<tbody id="filter_list">',i=[];for(let e=0;e<t.items.length;e++)i.push(t.items[e].Item_id);for(let t=0;t<n.length;t++)if(null!==n[t].stock_address)for(let d=0;d<n[t].items.length;d++){function a(){for(let e=0;e<i.length;e++)if(i[e]==n[t].items[d].Item_id)return!1;return!0}a()&&(e+=`\n                                                    <tr id="add_${n[t].items[d].Item_id}" onclick="addItemToAccount(this)">\n                                                        <td>${n[t].items[d].Group_name}</td>\n                                                        <td>${n[t].items[d].Name}</td>\n                                                        <td>${n[t].items[d].Prefix}</td>\n                                                        <td>${n[t].items[d].Volume}</td>\n                                                        <td>${n[t].items[d].Packing}</td>\n                                                        <td>${n[t].items[d].NDS}</td>\n                                                        <td>${n[t].items[d].Cost}</td>\n                                                        <td>${n[t].stock_address}</td>\n                                                    </tr>\n                                                `)}return e+"</tbody>"}()}\n                                </table>\n                            </div>`}}),e}}()}\n                </div>\n                <div class="row_card">\n                    <div class="info_block">\n                        <span class="lightgray">Оплата</span>\n                        <div class="hmax">\n                            <table>\n                                <tr>\n                                    <th>Дата</th>\n                                    <th>Сумма, руб.</th>\n                                </tr>\n                                <tbody id="group"></tbody>\n                            </table>\n                        </div>\n                        <div class="events">\n                            <img class="add_something" id="account-group" src="static/images/add.png" onclick="addRow(this.id)">\n                            <img name="remove_last_group" class="add_something" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">\n                        </div>\n                    </div>\n                    <div class="info_block">\n                        <span class="lightgray">Оплата Привета</span>\n                        <table>\n                            <tr>\n                                <th>Дата</th>\n                            </tr>\n                            <tr>\n                                <td>\n                                    <input type="text" style="width: 70px" id="shipment_date" value="${t.account.Shipment_hello}">\n                                </td>\n                            </tr>\n                        </table>\n                    </div>\n                    <div class="info_block">\n                        <span class="lightgray">Отгрузки</span>\n                        <div class="hmax">\n                            <table style="width: 625px">\n                                ${`\n                <tbody id="shipments">\n                    ${function(){let e,n,i;$.ajax({url:"/getDeliveries",type:"GET",async:!1,dataType:"html",success:function(t){e=JSON.parse(t),$.ajax({url:"/getStockTable",type:"GET",async:!1,dataType:"html",success:function(t){n=JSON.parse(t),$.ajax({url:"/getThisUser",type:"GET",async:!1,dataType:"html",success:function(t){i=JSON.parse(t)}})}})}});let a=`\n                    <tr>\n                        <th>Дата</th>\n                        <th>Товар</th>\n                        <th>Склад</th>\n                        <th>Объем, кг.</th>\n                        <th>Вид упаковки</th>\n                        <th>Сумма, руб.</th>\n                        ${"admin"==i.role?"<th>Закупочная цена</th>":""}\n                    </tr>\n                `;for(let d=0;d<e.length;d++)if(+e[d].delivery.Account_id==+t.account.id){let t=JSON.parse(e[d].delivery.Amounts),s=JSON.parse(e[d].delivery.Item_ids),l=e[d].delivery.Date;for(let e=0;e<n.length;e++)for(let d=0;d<n[e].items.length;d++)for(let o=0;o<s.length;o++)n[e].items[d].Item_id==s[o]&&(a+=`\n                                            <tr id="item_flight_${n[e].items[d].Item_id}" name="item_flight">\n                                                <td>${l}</td>\n                                                <td>${n[e].items[d].Name}</td>\n                                                <td>${n[e].stock_address}</td>\n                                                <td>${returnSpaces(t[o].volume)}</td>\n                                                <td>${n[e].items[d].Packing}</td>\n                                                <td>${returnSpaces(t[o].sum)}</td>\n                                                ${"admin"==i.role?`<td>${returnSpaces(n[e].items[d].Purchase_price)}</td>`:""}\n                                            </tr>\n                                        `)}return a}()}\n                </tbody>\n            `}\n                            </table>\n                        </div>\n                    </div>\n                </div>\n                <div class="next">\n                    <div style="display:none" id="list_stock" data-stock=""></div>\n                    <button class="btn btn-main" id="delivery_new" onclick="editAccount(this)">Отгрузить</button>\n                </div>`},status:n[1]},{id:"delivery",list:["Оформить заявку на Доставку"],link:function(t,e){null!=$(e).attr("data-name")&&(array_info=$(e).attr("data-info").split("ç"),$(".info").append(`<div style="display: none;" id="transit_info" data-info="${array_info[1]}ç${array_info[5]}"></div>`));"Транзит"==t.Name&&(array_info=[],$(".info").append(`<div style="display: none;" id="transit_info" data-info="${t.Price}ç${t.Contact_Number}"></div>`));null==list_stock_acc&&(list_stock_acc=[t.Stock]);return`<div class="row_card">\n                        <table class="table_block">\n                            <tr>\n                                <td>Заказчик</td>\n                                <td>\n                                    <select id="delivery_customer">\n                                        ${function(){let e="";"ИП"==t.Customer?e+="\n                    <option selected>ИП</option>\n                    <option>ООО</option>\n                ":e+="\n                    <option>ИП</option>\n                    <option selected>ООО</option>\n                ";return e}()}\n                                    </select>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Дней отсрочки</td>\n                                <td>\n                                    <input type="number" style="width: 200px" id="delivery_postponement_date" value="${t.Postponement_date}">\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Дата отгрузки</td>\n                                <td>\n                                    <input type="text" style="width: 200px" id="delivery_start_date" value="${t.Start_date}">\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Дата разгрузки</td>\n                                <td>\n                                    <input type="text" style="width: 200px" id="delivery_end_date" value="${t.End_date}">\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Способ погрузки</td>\n                                <td>\n                                    <input type="text" style="width: 200px" id="delivery_load_type" value="${t.Load_type}">\n                                </td>\n                            </tr>\n                        </table>\n                        <table class="table_block">\n                            <tr>\n                                <td>Счёт</td>\n                                <td>\n                                    <select id="delivery_account" onchange="selectAccount(this.value)">\n                                        ${function(){if(null!=$(e).attr("data-name")||"Транзит"==t.Name)return'<option disabled selected value="Транзит">Транзит</option>';{let e="";return $.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",success:function(n){if(n=JSON.parse(n),null==categoryInFinanceAccount[1][1]&&categoryInFinanceAccount[1].push(n),""==t.Account_id){e+="<option disabled selected>Не выбран</option>";for(let t=0;t<n.length;t++)e+=`<option value="${n[t].account.id}">Счёт ${n[t].account.id}</option>`}else e+=`<option disabled selected value="${t.Account_id}">Счёт ${t.Account_id}</option>`}}),e}}()}\n                                    </select>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Клиент</td>\n                                <td>\n                                    <select id="delivery_client">\n                                        ${function(){if(null!=$(e).attr("data-name")||"Транзит"==t.Name)return null!=array_info[1]?`<option disabled selected value="${array_info[3]}">${array_info[3]}</option>`:`<option disabled selected value="${t.Client}">${t.Client}</option>`;{let e="",n=categoryInFinanceAccount[1][1];for(let i=0;i<n.length;i++)if(n[i].account.id==t.Account_id){""!=t.Account_id?(t.Name=n[i].account.Name,e+=`<option disabled selected value="${n[i].account.Name}">${n[i].account.Name}</option>`):e+="<option selected disabled>Не выбран</option>";break}return""==t.Account_id&&(e+="<option selected disabled>Выберите счёт</option>"),e}}()}\n                                    </select>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Контакт на выгрузке</td>\n                                <td>\n                                    <select id="delivery_contact_name">\n                                        ${function(){if(null!=$(e).attr("data-name")||"Транзит"==t.Name){if("null"===array_info[1])return"<option selected disabled>Нет контактов</option>";{let e,n;if(null!=array_info[1])n={id:array_info[1],category:"provider"};else{if(""==t.Price||null==t.Price||"null"==t.Price)return"<option selected disabled>Нет контактов</option>";n={id:t.Price,category:"provider"}}let i="";if(null==n)return"<option selected disabled>Выберите счёт</option>";if($.ajax({url:"/getContacts",type:"GET",async:!1,data:n,dataType:"html",success:function(t){e=JSON.parse(t)}}),0==e.length)i+="<option selected disabled>Контакты не указаны</option>";else for(let n=0;n<e.length;n++){let a=`${e[n].Position} | ${e[n].Name} | ${e[n].Number} | ${e[n].Phone_two}`;+t.Contact_End==+e[n].Contact_id?i+=`<option selected value="${a}">${a}</option>`:i+=`<option value="${a}">${a}</option>`}return i}}{let e,n,i=categoryInListClient[1][1],a="";for(let e=0;e<i.length;e++)if(i[e].Name==t.Name){n={id:i[e].id,category:"client"};break}if(null==n)return"<option selected disabled>Выберите счёт</option>";if($.ajax({url:"/getContacts",type:"GET",async:!1,data:n,dataType:"html",success:function(t){e=JSON.parse(t)}}),0==e.length)a+='<option selected value="Нет данных">Контакты не указаны</option>';else for(let n=0;n<e.length;n++){let i=`${e[n].Position} | ${e[n].Name} | ${e[n].Number} | ${e[n].Phone_two}`;+t.Contact_End==+e[n].Contact_id?a+=`<option selected value="${i}">${i}</option>`:a+=`<option value="${i}">${i}</option>`}return a}}()}\n                                    </select>\n                                </td>\n                            </tr>\n                            ${-1!=t.Stock.indexOf("-s!s-")||list_stock_acc.length>1?"":`<tr>\n                                <td>Склад</td>\n                                <td>\n                                    <select id="delivery_stock">\n                                        ${null!=$(e).attr("data-name")||"Транзит"==t.Name?null!=array_info[1]?`<option selected value="${array_info[4]}">${array_info[4]}</option>`:`<option selected value="${t.Stock}">${t.Stock}</option>`:null==list_stock_acc?""==t.Stock?'<option selected value="Нет данных">Нет контактов</option>':`<option selected value="${t.Stock}">${t.Stock}</option>`:`<option selected value="${list_stock_acc}">${list_stock_acc}</option>`}\n                                    </select>\n                                </td>\n                            </tr>`}\n                            <tr>\n                                <td>Комментарий</td>\n                                <td>\n                                    <input type="text" style="width: 200px" id="delivery_comment" value="${t.Comment}">\n                                </td>\n                            </tr>\n                        </table>\n                        <table class="table_block">\n                            <tr>\n                                <td>Перевозчик</td>\n                                <td>\n                                    ${function(){let e=categoryInListCarrier[1][1],n=[],i='<select id="delivery_carrier_id" onchange="selectDrivers(this.value)">';i+='<option value="disabled" selected disabled>Не выбран</option>';for(let a=0;a<e.length;a++)""!=t.Carrier_id&&t.Carrier_id==e[a].id?(i+=`<option value="${e[a].id}" selected>${e[a].Name}</option>`,selectDrivers(e[a].id,t)):i+=`<option value="${e[a].id}">${e[a].Name}</option>`,n.push({name:e[a].Name,id:e[a].id});return i+="</select>"}()}\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Вид перевозки</td>\n                                <td>\n                                    <select id="delivery_type" disabled>\n                                        <option selected disabled></option>\n                                    </select>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Водитель</td>\n                                <td>\n                                    <select id="delivery_driver"></select>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Марка авто</td>\n                                <td>\n                                    <input type="text" style="width: 200px" value="${t.Auto}" id="delivery_car">\n                                </td>\n                            </tr>\n                            <tr>\n                                <td>Паспортные данные</td>\n                                <td>\n                                    <input type="text" style="width: 200px" value="${t.Passport_data}" id="delivery_passport">\n                                </td>\n                            </tr>\n                        </table>\n                    </div>\n                    ${-1!=t.Stock.indexOf("-s!s-")||list_stock_acc.length>1?`<div class="row_card" style="display: flex; justify-content: center;">\n                            <div class="visible_block" style="width: 355px;">\n                                <div class="visible_info" style="margin-bottom: 10px; margin-right: 30px; margin-top: -15px;">\n                                    <div id="stocks_contacts" class="visible_title" onclick="showOrHideInfo(this.id)">\n                                        <span>Склады</span>\n                                        <img id="hidden_image_stocks_contacts" src="static/images/dropmenu_black.svg" class="drop_down_img">\n                                    </div>\n                                    <table id="hidden_info_stocks_contacts" class="table_block" style="margin-bottom: 20px; display: none;">\n                                        <tbody>\n                                            ${function(){1==list_stock_acc.length&&list_stock_acc[0].indexOf("-s!s-")&&(list_stock_acc=list_stock_acc[0].split("-s!s-"));let t="";for(let e=0;e<list_stock_acc.length;e++)t+=`\n                    <tr>\n                        <td>\n                            <div name="stock--delivery">${list_stock_acc[e]}</div>\n                        </td>\n                    </tr>\n                `;return t}()}\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>`:""}\n                    <div class="row_card">\n                        <div class="info_block">\n                            <div>\n                                <span class="lightgray">Рейс</span>\n                                <table>\n                                    <tr>\n                                        <th width="15"></th>\n                                        <th>Товар</th>\n                                        <th>Склад</th>\n                                        <th>Объем, кг.</th>\n                                        <th>Вид упаковки</th>\n                                        <th>Сумма, руб.</th>\n                                    </tr>\n                                    <tbody id="flight">\n                                        ${function(){let n,i=[];$.ajax({url:"/getAllItems",type:"GET",async:!1,dataType:"html",success:function(t){i=JSON.parse(t),$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(t){n=JSON.parse(t)}})}});let a,d="";null!=t.Amounts&&(a=JSON.parse(t.Amounts));if(null!=$(e).attr("data-name")||"Транзит"==t.Name){let e;e=null==array_info[1]?JSON.parse(t.Item_ids)[0]:array_info[2];for(let t=0;t<i.length;t++)for(let s=0;s<n.length;s++)i[t].Item_id==e&&i[t].Stock_id==n[s].id&&(d+=null==a?`\n                                <tr id="item_flight_${i[t].Item_id}" name="item_flight">\n                                    <td></td>\n                                    <td>${i[t].Name}</td>\n                                    <td>${n[s].Name}</td>\n                                    <td name="item_volume" id="item_volume_${e}">${returnSpaces(array_info[0])}</td>\n                                    <td>${i[t].Packing}</td>\n                                    <td><input onkeyup="maskNumber(this.id)" name="item_sum" id="item_sum_${i[t].Item_id}" type="text"></td>\n                                </tr>\n                                `:`\n                                    <tr id="item_flight_${i[t].Item_id}" name="item_flight">\n                                        <td></td>\n                                        <td>${i[t].Name}</td>\n                                        <td>${n[s].Name}</td>\n                                        <td name="item_volume" id="item_volume_${e}">${a[0].volume}</td>\n                                        <td>${i[t].Packing}</td>\n                                        <td><input onkeyup="maskNumber(this.id)" name="item_sum" id="item_sum_${i[t].Item_id}" value="${a[0].sum}" type="text"></td>\n                                    </tr>\n                                `)}else{let e=categoryInFinanceAccount[1][1];for(let s=0;s<i.length;s++){if(null==list_items_acc){if(""==t.Item_ids)return"";list_items_acc=JSON.parse(t.Item_ids)}for(let l=0;l<list_items_acc.length;l++)for(let o=0;o<n.length;o++)for(let c=0;c<e.length;c++){let r=JSON.parse(e[c].account.Item_ids);for(let u=0;u<r.length;u++)if(+list_items_acc[l]==+i[s].Item_id&&+i[s].Stock_id==n[o].id&&e[c].account.id==t.Account_id&&+i[s].Item_id==r[u].id)if(null==a)d+=`\n                                            <tr id="item_flight_${i[s].Item_id}" name="item_flight">\n                                                <td name="account_${e[c].account.id}_${t.id}" id="flight_${i[s].Item_id}" onclick="deleteItemInFlight(this)"><img src="../static/images/returnBack.png" style="width: 12px;"></td>\n                                                <td>${i[s].Name}</td>\n                                                <td>${n[o].Name}</td>\n                                                <td><input onkeyup="maskNumber(this.id)" name="item_volume" id="item_volume_${i[s].Item_id}" type="text"></td>\n                                                <td>${i[s].Packing}</td>\n                                                <td><input onkeyup="maskNumber(this.id)" name="item_sum" id="item_sum_${i[s].Item_id}" type="text"></td>\n                                            </tr>\n                                            `;else for(let r=0;r<a.length;r++)list_items_acc[l]==a[r].id&&(d+=`\n                                                        <tr id="item_flight_${i[s].Item_id}" name="item_flight">\n                                                            <td name="account_${e[c].account.id}_${t.id}" id="flight_${i[s].Item_id}" onclick="deleteItemInFlight(this)"><img src="../static/images/returnBack.png" style="width: 12px;"></td>\n                                                            <td>${i[s].Name}</td>\n                                                            <td>${n[o].Name}</td>\n                                                            <td><input onkeyup="maskNumber(this.id)" name="item_volume" id="item_volume_${i[s].Item_id}" value="${a[r].volume}" type="text"></td>\n                                                            <td>${i[s].Packing}</td>\n                                                            <td><input onkeyup="maskNumber(this.id)" name="item_sum" id="item_sum_${i[s].Item_id}" value="${a[r].sum}" type="text"></td>\n                                                        </tr>\n                                                    `)}}}return d}()}\n                                    </tbody>\n                                </table>\n                            </div>\n                            <div class="info_block fit" style="margin-top: 15px;">\n                                <span class="lightgray" style="margin-top: 10px;">Оплата</span>\n                                <div class="hmax">\n                                    <table style="width: fit-content">\n                                        <tr>\n                                            <th>Дата</th>\n                                            <th>Сумма, руб.</th>\n                                        </tr>\n                                        <tbody id="group"></tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="next">\n                        <button class="btn" style="margin-right: 10px" id="delivery_new" data-name="not-document" onclick="makeRequest(this)">Забирает сам</button>\n                        <button class="btn btn-main" data-name="document" id="delivery_new" onclick="makeRequest(this)">Оформить Заявку</button>\n                    </div>`},status:n[1]},{id:"stock",list:[""],link:function(t){return`<div class="row_card">\n                    <div class="info_block full">\n                        <div class="mb">\n                            <span class="bold">Транзит со склада</span>\n                            <select id="transit_from_stock" class="margin">\n                                <option selected disabled value="${t.stock_address}">${t.stock_address}</option>\n                            </select>\n                        </div>\n                        <div>\n                            <table class="full">\n                                <tr>\n                                    <td>Группа товаров</td>\n                                    <td>Товар</td>\n                                    <td>Юр. лицо</td>\n                                    <td>Объем, кг.</td>\n                                    <td>Фасовка</td>\n                                    <td>Цена прайса, руб.</td>\n                                </tr>\n                                <tbody>\n                                    <tr>\n                                        <td>${t.Group_name}</td>\n                                        <td>${t.Name}</td>\n                                        <td>${t.Prefix}</td>\n                                        <td id="from">${t.Volume}</td>\n                                        <td>${t.Packing}</td>\n                                        <td>${t.Cost}</td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div> \n                    </div>\n                </div>\n                <div class="row_card">\n                    <div class="info_block full">\n                        <div>\n                            <span class="bold">На склад</span>\n                            <select id="stock_select" class="margin">\n                                ${function(){let e=categoryInStock[1][1],n=[];for(let i=0;i<e.length;i++)n.push(e[i].stock_address),n[i]==t.stock_address&&n.splice(i,1);let i="<option disabled selected>Не выбран</option>";for(let t=0;t<n.length;t++)i+=`<option value="${n[t]}">${n[t]}</option>`;0==n.length&&(i='<option value="null" disabled selected>Нет другого склада</option>');return i}()}\n                            </select>\n                        </div>\n                        <div class="mb">\n                            <span class="bold">Объем, кг.</span>\n                            <input onkeyup="maskNumberWithout(this.id)" style="width: 60px" type="text" id="volume_transit" class="margin" oninput="fillVolume(this)">\n                        </div>\n                        <div>\n                            <table class="full">\n                                <tr>\n                                    <td>Группа товаров</td>\n                                    <td>Товар</td>\n                                    <td>Юр. лицо</td>\n                                    <td>Объем, кг.</td>\n                                    <td>Фасовка</td>\n                                    <td>Цена прайса, руб.</td>\n                                </tr>\n                                <tbody>\n                                    <tr>\n                                        <td>${t.Group_name}</td>\n                                        <td>${t.Name}</td>\n                                        <td>${t.Prefix}</td>\n                                        <td id="volume_goods"></td>\n                                        <td>${t.Packing}</td>\n                                        <td>${t.Cost}</td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>     \n                </div>\n                <div class="next">\n                    <button class="btn btn-main" id="transit" onclick="transitProduct(this)">Оформить</button>\n                </div>\n                `},status:n[1]},{id:"item",list:["Добавление товара","* Все поля обязательны к заполнению"],link:function(){return`\n            <div class="row_card">\n                <table class="table_block">\n                    <tr>\n                        <td>Склад</td>\n                        <td>\n                            <select type="text" id="stock_id">${function(){let t;$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});let e="";e+='<option value="0">Не выбран</option>';for(let n=0;n<t.length;n++)e+=`<option value="${t[n].id}">${t[n].Name}</option>`;return e}()}</select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Группа товаров</td>\n                        <td>\n                            <select type="text" id="group_id">${function(){let t;$.ajax({url:"/getItemGroup",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});let e="";for(let n=0;n<t.length;n++)e+=`<option value="${t[n].id}">${t[n].Group}</option>`;return setTimeout(function(){fadeOutPreloader(preloader)},0),e}()}</select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Товар</td>\n                        <td><input type="text" id="item_product" onchange="saveCard()" class="string"></td>\n                    </tr>\n                </table>\n                <table class="table_block">\n                    <tr>\n                        <td>Объем, кг.</td>\n                        <td><input onkeyup="maskNumber(this.id)" type="text" id="item_volume" onchange="saveCard()" class="string"></td>\n                    </tr>\n                    <tr>\n                        <td>Фасовка</td>\n                        <td>\n                            <select id="item_packing" type="text">\n                                <option selected value="Насыпь">Насыпь</option>\n                                <option value="Мешки">Мешки</option>\n                                <option value="ББ">ББ</option>\n                            </select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Вес, кг.</td>\n                        <td><input onkeyup="maskNumber(this.id)" type="text" id="item_weight" onchange="saveCard()" class="string"></td>\n                    </tr>\n                </table>\n                <table class="table_block">\n                    <tr>\n                        <td>Юр. лицо</td>\n                        <td>\n                            <select type="text" id="item_prefix">\n                                <option value="ООО">ООО</option>\n                                <option value="ИП">ИП</option>\n                            </select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>НДС</td>\n                        <td><input maxlength="12" type="number" id="item_vat" onchange="saveCard()" class="string"></td>\n                    </tr>\n                    <tr>\n                        <td>Цена прайса, руб.</td>\n                        <td><input onkeyup="maskNumber(this.id)" type="text" id="item_price" onchange="saveCard()" class="string"></td>\n                    </tr>\n                    <tr>\n                        <td>Закупочная цена, руб.</td>\n                        <td><input onkeyup="maskNumber(this.id)" type="text" id="item_purchase_price" onchange="saveCard()" class="string"></td>\n                    </tr>\n                </table> \n            </div>\n            <div> \n                <table class="table_block" style="margin-bottom: 15px;">\n                    <tr>\n                        <td><input id="create_stock" type="text" style="width: 240px; margin-right: 15px;" placeholder="Адрес склада"></td>\n                        <td><button class="btn btn-main" onclick="createNewStock()">Создать</button></td>\n                    </tr>\n                </table>\n                <table class="table_block">\n                    <tr>\n                        <td><input id="create_group" type="text" style="width: 240px; margin-right: 15px;" placeholder="Группа товаров"></td>\n                        <td><button class="btn btn-main" onclick="createNewGroup()">Создать</button></td>\n                    </tr>\n                </table>\n            </div>\n            <div class="next">\n                <button class="btn btn-main" id="item_new" onclick="createNewItem()">Добавить товар</button>\n            </div>\n        `},status:n[1]}];for(let e=0;e<a.length;e++)if(a[e].id.includes(n[0])){if(infoElement=a[e],"add"==n[1])break;if("new"!==n[1]){let t=dataName[e].link[1][1];if("stock"===n[0]){for(let e=0;e<t.length;e++)for(let a=0;a<t[e].items.length;a++)if(t[e].items[a].Item_id==n[1]){(i=t[e].items[a]).stock_address=t[e].stock_address;break}}else if("account"===n[0])for(let e=0;e<t.length;e++)t[e].account.id==n[1]&&(i=t[e]);else if("delivery"===n[0])for(let e=0;e<t.length;e++)t[e].delivery.id==n[1]&&(i=t[e].delivery);else for(let n=0;n<t.length;n++)t[n].id==a[e].status&&(i=t[n]);let d=Object.keys(i);for(let t=0;t<d.length;t++)null!=i[d[t]]&&"null"!=i[d[t]]||(i[d[t]]="");let s=new Date;a[e].list.unshift(`Код: ${i.id||i.Item_id||i.account.id}`),"client"!==n[0]&&"provider"!==n[0]&&"carrier"!==n[0]||(a[e].list.push(""==i.UTC||null==i.UTC?"Местное время неопределенно":`Местное время: ${i.UTC+s.getUTCHours()<10?"0"+(+i.UTC+ +s.getUTCHours()):i.UTC+s.getUTCHours()}:${s.getMinutes()<10?"0"+s.getMinutes():s.getMinutes()}`),"client"===n[0]&&(a[e].list.push(`<span id="${n[0]}_site">${i.Site}</span>`),a[e].list.push(`<span id="${n[0]}_holding">${i.Holding}</span>`)),"provider"===n[0]&&a[e].list.push(`<span id="${n[0]}_holding">${i.Holding}</span>`)),"account"===n[0]&&a[e].list.push(`Счёт от ${i.items[0].Prefix} (${i.items[0].NDS}%)`)}else{const d=[{id:"client",list:["Name","Rayon","Category","Distance","Segment","UHH","Price","Oblast","Station","Tag","Adress","Fact_address","Site","Holding","Demand_item","Demand_volume","Livestock_all","Livestock_milking","Livestock_milkyield","Bik","kc","rc","kpp","Director"]},{id:"provider",list:["Name","Rayon","Category","Distance","UHH","Price","Oblast","Train","Tag","Adress","NDS","Merc","Volume","Holding"]},{id:"carrier",list:["Name","Address","Area","Capacity","UHH","Region","View","Bik","kc","rc","kpp","Director"]},{id:"delivery",list:["Customer","Start_date","Postponement_date","End_date","Load_type","Type","Comment","Client","Contact_Number","Account_id","Stock","Item_ids","Payment_list","Auto","Passport_data"]}];void 0===dataName[e].link[1][1]&&getTableData(dataName[e].link,!1,!0),a[e].list.unshift("Код: 0");for(let t=0;t<d.length;t++)if(n[0]==d[t].id)for(let e=0;e<d[t].list.length;e++)i[d[t].list[e]]="";if("client"===n[0]&&(a[e].list.push(`<input id="${n[0]}_site" placeholder="Сайт"  value="${i.Site}">`),a[e].list.push(`<input type="text" placeholder="Холдинг" id="${n[0]}_holding" value="${i.Holding}">`)),"provider"===n[0]&&a[e].list.push(`<input type="text" placeholder="Холдинг" id="${n[0]}_holding" value="${i.Holding}">`),"delivery"===n[0]&&null!=t.name&&""!=t.name){let e=t.name.split("_")[1];i.Account_id=categoryInFinanceAccount[1][1][e-1].account.id}}}for(let t=0;t<dataName.length;t++)if(n[0]==dataName[t].name){saveTableAndCard=dataName[t].link,dataName[t].link[0].lastCard[0]=$("<div>",{class:"card_menu",id:"card_menu",append:getTitleInfo(infoElement,i).add(d(infoElement))});break}for(let t=0;t<linkCategoryInfo.length;t++)if(linkCategoryInfo[t].subid.includes(saveTableAndCard[0].id)){$(`#${linkCategoryInfo[t].id}`).addClass("active"),"new"==infoElement.status&&($("div").is("#subcategories")&&$("#subcategories").remove(),addButtonsSubcategory(linkCategoryInfo[t].id[linkCategoryInfo[t].id.length-1]),$(`#${saveTableAndCard[0].id}Button`).addClass("active"),linkField());break}function d(e){let n=$("<div>",{class:"content"});return n.append(e.link(i,t)),n}for(let t=0;t<dataName.length;t++)if(n[0]==dataName[t].name){saveTableAndCard=dataName[t].link,dataName[t].link[0].lastCard[0],$(".info").append(dataName[t].link[0].lastCard[0]);break}if(itemSelection(n[0],i),$(".next .btn, #add_new_comment, #save_new_comment").attr("name",n.join("_")),"stock"===n[0]&&(categoryInStock[0].lastCard[0]=null),"client"==n[0]||"provider"==n[0]||"carrier"==n[0])!function(){!function(t,e){$.ajax({url:"static/js/regions/regions.json",async:!1,success:function(n){let i=null!=t.Oblast?t.Oblast:t.Region,a=null!=t.Rayon?t.Rayon:t.Area,d=$("<select>"),s='<option value="">Не выбран</option>';for(let t=0;t<n.length;t++)n[t].region==i?(s+=`<option selected value="${n[t].region}">${n[t].region}</option>`,d.id=`${e}_select`,d.value=n[t].region):s+=`<option value="${n[t].region}">${n[t].region}</option>`;$(`#${e}_region`).empty(),$(`#${e}_region`).append(s),getListAreas(d,a)}})}(i,n[0]);let t=n[0],e=n[1];"new"==e?(addMember(t),addRow(`${t}-group`),$('[name="remove_last_group"]').fadeOut(0),setTimeout(function(){fadeOutPreloader(preloader)},0)):("client"==t||"provider"==t?$.ajax({url:"/getItems",type:"GET",data:{category:t,id:e},dataType:"html",success:function(t){a(JSON.parse(t))}}):a([]),$.ajax({url:"/getContacts",type:"GET",data:{category:t,id:e},dataType:"html",success:function(e){!function(e){if(0==e.length)addMember(t);else for(let n=0;n<e.length;n++)addMember(t,e[n]);setTimeout(function(){fadeOutPreloader(preloader)},100)}(JSON.parse(e)),getCommentsInfo.getRequest(n)}}));function a(e){if(0==e.length)addRow(`${t}-group`);else for(let n=0;n<e.length;n++)addRow(`${t}-group`,e[n])}}();else if("delivery"==n[0]){let t=i.Payment_list;if(0==t.length)addRow("delivery-group");else{t=JSON.parse(i.Payment_list);for(let e=0;e<t.length;e++)addRow("delivery-group",t[e])}setTimeout(function(){fadeOutPreloader(preloader)},0)}else if("account"==n[0]){let t;t=null!=i.account.Payment_history?JSON.parse(i.account.Payment_history):[{position:"",date:"",sum:""}];for(let e=0;e<t.length;e++)addRow("account-group",t[e]);setTimeout(function(){fadeOutPreloader(preloader)},0)}if("stock"===n[0])$(".info").prepend($("<div>",{class:"overflow"})),$(".overflow").height($(".container")[0].scrollHeight),$("#card_menu").addClass("modal"),setTimeout(function(){fadeOutPreloader(preloader)},0);else try{""!==$("#group").html().trim()&&$("#remove_last_row").fadeIn(0)}catch{}}function deleteItemInFlight(t){if(!confirm("Вы уверены, что хотите удалить этот товар из заявки? После этого действия товар вернуть будет невозможно!"))return;let e=t.id.split("_")[1],n=$(t).attr("name").split("_")[1],i=$(t).attr("name").split("_")[2],a=categoryInDelivery[1][1];$(`#item_${t.id}`).remove();for(let t=0;t<a.length;t++)if(+a[t].delivery.Account_id==+n&&+a[t].delivery.id==+i){let n=JSON.parse(a[t].delivery.Item_ids),d=JSON.parse(a[t].delivery.Amounts);for(let t=0;t<n.length;t++)+n[t]==+e&&(n.splice(t,1),d.splice(t,1));$.ajax({url:"/fixDelivery",type:"GET",data:{id:+i,items_ids:JSON.stringify(n),amounts:JSON.stringify(d)},dataType:"html",success:function(){}})}}function searchItemsInAccount(){let t=$("#invoice_search_items").val(),e=$("#invoice_search_items").attr("name");$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(n){n=JSON.parse(n);for(let t=0;t<categoryInFinanceAccount[1][1].length;t++)if(categoryInFinanceAccount[1][1][t].account.id==e){selectedLine=categoryInFinanceAccount[1][1][t];break}let i=[];for(let t=0;t<selectedLine.items.length;t++)i.push(selectedLine.items[t].Item_id);let a=$("<div>",{class:"info_block full hmax",append:$("<table>",{class:"account_table new_table",id:"output_table",html:"<tr>\n                            <th>Группа товаров</th>\n                            <th>Товар</th>\n                            <th>Юр. лицо</th>\n                            <th>Объем, кг.</th>\n                            <th>Фасовка</th>\n                            <th>НДС</th>\n                            <th>Цена прайса, руб.</th>\n                            <th>Склад</th>\n                        </tr>",append:function(){let e=$("<tbody>",{id:"filter_list"});for(let d=0;d<n.length;d++)if(null!==n[d].stock_address)for(let s=0;s<n[d].items.length;s++)if(n[d].items[s].Name.includes(t)){function a(){for(let t=0;t<i.length;t++)if(i[t]==n[d].items[s].Item_id)return!1;return!0}if(a()){let t=$("<tr>",{onclick:"addItemToAccount(this)",id:`add_${n[d].items[s].Item_id}`});const i=[n[d].items[s].Group_name,n[d].items[s].Name,n[d].items[s].Prefix,n[d].items[s].Volume,n[d].items[s].Packing,n[d].items[s].NDS,n[d].items[s].Cost,n[d].stock_address];for(let e=0;e<i.length;e++)t.append($("<td>",{html:i[e]}));e.append(t)}}return e}()})});$("#row_output_table").empty(),$("#row_output_table").append(a)}})}function deleteProduct(t){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e),$(`#product_${t.split("_")[1]}`).remove();let n=$("<tr>",{onclick:"addItemToAccount(this)",id:t.replace(/product_/g,"add_")});for(let i=0;i<e.length;i++)for(let a=0;a<e[i].items.length;a++){let d=e[i].items[a];if(d.Item_id==t.split("_")[1]){let t=[d.Group_name,d.Name,d.Prefix,d.Volume,d.Packing,d.NDS,d.Cost,e[i].stock_address];for(let e=0;e<t.length;e++)n.append($("<td>",{html:t[e]}));let a=0;$("#exposed_list .invoiled").each(function(t,e){a+=+deleteSpaces($(e).children()[11].innerHTML)}),d.NDS=d.NDS[0]+d.NDS[1];let s=a>0?a-a*+d.NDS/100:0;$("#total").html(Math.round(a)),$("#vat").html(Math.round(a-s)),$("#without-vat").html(Math.round(s));break}}$("#filter_list").append(n);let i=$("<tr>",{class:"product",id:"empty"});for(let t=0;t<12;t++)i.append($("<td>",{html:""}));$("#exposed_list").append(i),calculationIndicators()}})}function getListAreas(t,e=""){let n,i=t.value;try{n=t.id.split("_")[0]}catch{}$.ajax({url:"static/js/regions/regions.json",async:!1,success:function(t){let a='<option value="">Не выбран</option>';for(let n=0;n<t.length;n++)if(t[n].region==i)for(let i=0;i<t[n].areas.length;i++)t[n].areas[i]==e?a+=`<option selected value="${t[n].areas[i]}">${t[n].areas[i]}</option>`:a+=`<option value="${t[n].areas[i]}">${t[n].areas[i]}</option>`;$(`#${n}_area`).empty(),$(`#${n}_area`).append(a),saveCard()}})}function createDocument(t){"Транзит"==$("#delivery_account")[0].value&&(info=$("#transit_info").attr("data-info").split("ç"));let e=$(t).attr("name").split("_");e[1].includes("new")&&(e[1]=e[1].replace(/new/g,saveTableAndCard[1][1].length+1));let n=["carrier",+$("#delivery_carrier_id").val()],i=$("#delivery_customer")[0].value,a=$("#delivery_client")[0].value;if(null==$("#delivery_carrier_id").val())return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 12px; color: #595959;">Выберите перевозчика!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));$.ajax({url:"/getCarriers",type:"GET",dataType:"html",success:function(t){t=JSON.parse(t);for(let d=0;d<t.length;d++)if(t[d].id==n[1]){let s;s="ООО"==i?"ZayavkaOOO":"ZayavkaIP";const l=document.createElement("a");if("Транзит"==$("#delivery_account")[0].value){let t=`${i} ${a}`;l.href=`/downloadDoc?category=${n[0]}&name=transit&card_id=${n[1]}&address=${t}&address2=${info[1]}&delivery=${e[1]}`,l.download=`Транзит с ${i} на ${a}.docx`}else l.href=`/downloadDoc?category=${n[0]}&name=${s}&card_id=${n[1]}&address=${t[d].Address}&delivery=${e[1]}`,l.download=`Заявка ${i}.docx`;l.click()}}})}function makeRequest(t){let e,n=t;e="Транзит"==$("#delivery_account")[0].value?"Транзит":categoryInFinanceAccount[1][1][+$("#delivery_account")[0].value-1];let i={};for(let t=0;t<idCardFields[3].ids.length;t++)if(null!=$("#delivery_stock").val()||"delivery_stock"!=idCardFields[3].ids[t])i[idCardFields[3].ids[t]]=$(`#${idCardFields[3].ids[t]}`).val();else{let t=[];for(let e of $('[name="stock--delivery"]'))t.push($(e).html());i.delivery_stock=t.join("-s!s-")}let a=[],d=[];for(let t of $('#flight [name="item_flight"]'))d.push($(t).attr("id").split("_")[2]);for(let t of $('#flight [name="item_sum"]'))if("not-document"==$(n).attr("data-name"))a.push({sum:0});else{if(""==t.value)return $(".page").append($("<div>",{class:"background"}).add('\n                    <div class="modal_select">\n                        <div class="title">\n                            <span>Ошибка</span>\n                            <img onclick="closeModal()" src="static/images/cancel.png">\n                        </div>\n                        <div class="content">\n                            <div class="message">\n                                <p style="font-size: 14px; color: #595959;">Введите сумму доставки!</p>\n                            </div>\n                        </div>\n                    </div>\n                '));a.push({sum:t.value})}for(let t=0;t<$('#flight [name="item_volume"]').length;t++){if("Транзит"==e)a[t].volume=$('#flight [name="item_volume"]')[0].innerHTML;else{if(""==$('#flight [name="item_volume"]')[t].value||0==$('#flight [name="item_volume"]')[t].value)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px; color: #595959;">Заполните поле "Объем" у всех товаров!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));a[t].volume=$('#flight [name="item_volume"]')[t].value}a[t].id=$('#flight [name="item_flight"]')[t].id.split("_")[2]}i.delivery_carrier_id=+$("#delivery_carrier_id").val();let s=+$("#delivery_carrier_id").val();if("document"==$(t).attr("data-name")){if(null==e)return"Оформить заявку невозможно, т.к вы не выбрали счет!";if(0==i.delivery_carrier_id)return"Оформить заявку невозможно, т.к вы не выбрали перевозчика!"}else if("not-document"==$(t).attr("data-name")){if(null==e)return"Выставить договор невозможно, т.к вы не выбрали счет!";if(0==i.delivery_carrier_id)return"Выставить договор невозможно, т.к вы не выбрали перевозчика!";i.delivery_type="not-document"}else{if(null==e)return confirm("При закрытии карточки данные не сохранятся, т.к вы не выбрали счет!")?closeCardMenu(t.id):void 0;if(0==i.delivery_carrier_id)return confirm("При закрытии карточки данные не сохранятся, т.к вы не выбрали перевозчика!")?closeCardMenu(t.id):void 0}let l=null!=t.name?t.name.split("_"):t.id.split("_"),o="new"==l[l.length-1]?"new":+l[l.length-1],c=getCurrentDateNotComparison("year");for(let t=0;t<categoryInDelivery[1][1].length;t++)categoryInDelivery[1][1][t].delivery.id==o&&(c=categoryInDelivery[1][1][t].delivery.Date);if(i.delivery_id=o,i.delivery_date=c,i.delivery_contact_name=$("#delivery_driver").val(),i.delivery_account_id=+$("#delivery_account")[0].value,i.delivery_client=$("#delivery_client")[0].children[0].innerHTML,i.delivery_car=$("#delivery_car").val(),i.delivery_passport=$("#delivery_passport").val(),i.delivery_contact_end=$("#delivery_contact_name").val(),i.delivery_postponement_date=$("#delivery_postponement_date").val(),"Транзит"!==$("#delivery_account")[0].value){let t=[];for(let e=0;e<categoryInDelivery[1][1].length;e++)if(+categoryInDelivery[1][1][e].delivery.Account_id==+$("#delivery_account")[0].value&&+o!=+categoryInDelivery[1][1][e].delivery.id){let n=JSON.parse(categoryInDelivery[1][1][e].delivery.Amounts);for(let e=0;e<n.length;e++)t.push(n[e])}for(let e=0;e<a.length;e++)t.push(a[e]);for(let e=0;e<t.length-1;e++)for(let n=e+1;n<t.length;n++)+t[e].id==+t[n].id&&(t[e].volume=+deleteSpaces(t[e].volume)+ +deleteSpaces(t[n].volume),t.splice(n,1),n--);let n=0;for(let i=0;i<e.items.length;i++)for(let a=0;a<t.length;a++){if(e.items[i].Item_id==t[a].id&&+deleteSpaces(e.items[i].Transferred_volume)<+deleteSpaces(t[a].volume))return alert(`Товар "${e.items[i].Name}" отгружается на больший объем, чем есть в счете!`);e.items[i].Item_id==t[a].id&&+deleteSpaces(e.items[i].Transferred_volume)==+deleteSpaces(t[a].volume)&&n++}t.length==n?$.ajax({url:"/editAccountShipment",type:"GET",data:{id:e.account.id,shipment:"true"},dataType:"html",success:function(){}}):$.ajax({url:"/editAccountShipment",type:"GET",data:{id:e.account.id,shipment:"polutrue"},dataType:"html",success:function(){}})}"not-document"==$(t).attr("data-name")?(i.delivery_amounts=JSON.stringify([]),i.delivery_item_ids=JSON.stringify([])):(i.delivery_amounts=JSON.stringify(a),i.delivery_item_ids=JSON.stringify(d));let r=[];for(let t of $("#group #delivery_date"))""!=$(t).val()?(r.push({date:$(t).val(),price:""}),i.delivery_payment_date=$(t).val()):r.push({date:"",price:""});for(let t=0;t<$("#group #delivery_price").length;t++)""!=$("#group #delivery_price")[t].value?r[t].price=$("#group #delivery_price")[t].value:""==$("#group #delivery_price")[t].value&&""==$("#group #delivery_date")[t].value&&r.splice(t,1);if(r.length>0?i.payment_list=JSON.stringify(r):i.delivery_payment_date="","Транзит"!==e)i.delivery_prefix=e.items[0].Prefix,i.delivery_price=e.account.Sum,i.delivery_vat=e.items[0].NDS,i.delivery_name=e.account.Name,i.delivery_contact_number="";else{let t=$("#transit_info").attr("data-info").split("ç");i.delivery_prefix=$("#delivery_client").val(),i.delivery_price=t[0],i.delivery_vat="",i.delivery_contact_number=t[1],i.delivery_name="Транзит"}null!=categoryInFinanceAccount[1][1]&&categoryInFinanceAccount[1].pop(),null!=categoryInListCarrier[1][1]&&categoryInListCarrier[1].pop(),$.ajax({url:"/addDelivery",type:"GET",data:i,dataType:"html",success:function(){list_items_acc=null,list_stock_acc=null,"document"==$(t).attr("data-name")&&createDocument(t);let e=[];for(let t=0;t<categoryInDelivery[1][1].length;t++)if(categoryInDelivery[1][1][t].carrier.id==s){let n=JSON.parse(categoryInDelivery[1][1][t].delivery.Amounts);for(let i=0;i<n.length;i++)n[i].date=categoryInDelivery[1][1][t].delivery.Date,n[i].client=categoryInDelivery[1][1][t].delivery.Client,n[i].stock=categoryInDelivery[1][1][t].delivery.Stock,n[i].contact=categoryInDelivery[1][1][t].delivery.Contact_Name,n[i].delivery_id=categoryInDelivery[1][1][t].delivery.id,e.push(n[i])}$.ajax({url:"/editItemDelivery",type:"GET",dataType:"html",data:{id:s,data:JSON.stringify(e)},success:function(){}}),$("#transit_info").remove(),closeCardMenu(t.id)}})}function transferToAccounts(t){$.ajax({url:"/getAccounts",type:"GET",dataType:"html",success:function(e){null==categoryInFinanceAccount[1][1]&&categoryInFinanceAccount[1].push(JSON.parse(e)),createCardMenu(t),categoryInFinanceAccount[0].lastCard[0]=$(".card_menu"),categoryInFinanceAccount[0].active=!0,categoryInFinanceDebit[0].active=!1,$("#debitButton").removeClass("active"),$("#accountButton").addClass("active"),linkField()}})}function transitProduct(t){let e,n=t.name.split("_")[1],i=$("#transit_from_stock").children()[0].value,a=$("#stock_select").val(),d=deleteSpaces($("#volume_transit").val());function s(t){$.ajax({url:"/getCarriers",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e),void 0===categoryInListCarrier[1][1]&&categoryInListCarrier[1].push(e),$.ajax({url:"/getDeliveries",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e),void 0===categoryInDelivery[1][1]&&categoryInDelivery[1].push(e),function(t){let e=null,s=null;$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(l){l=JSON.parse(l);for(let t=0;t<l.length;t++)for(let i=0;i<l[t].items.length;i++)if(+l[t].items[i].Item_id==+n){e=l[t].items[i].Prefix;break}$.ajax({url:"/getProviders",type:"GET",dataType:"html",success:function(l){l=JSON.parse(l);for(let t=0;t<l.length;t++)if(l[t].Adress==a){s=l[t].id;break}$(t).attr("data-name",t.name),$(t).attr("data-info",`${d}ç${s}ç${n}ç${e}ç${i}ç${a}`),t.name="",$(".overflow").remove(),createDelCardMenu(t)}})}})}(t)}})}})}$(t).attr("id","delivery_new"),$.ajax({url:"/getAllItems",type:"GET",dataType:"html",success:function(i){if(e=JSON.parse(i),null==a)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 12px; color: #595959;">Выберите склад!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(1!=Math.sign(d))return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 13px; color: #595959;">Введите корректное значение в поле Объём!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));for(let t=0;t<e.length;t++)if(e[t].Item_id==n&&+deleteSpaces(e[t].Volume)<+deleteSpaces(d))return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 12px; color: #595959;">На складе нет такого объема этого продукта!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));let l={stock_select:a,id_product:+n,product_volume:+deleteSpaces(d)};$.ajax({url:"/stockTransit",type:"GET",data:l,dataType:"html",success:function(){s(t)}})}})}function selectAccount(t){let e,n,i=categoryInFinanceAccount[1][1],a=categoryInListClient[1][1];for(let n=0;n<i.length;n++)if(i[n].account.id==+t){$("#delivery_client").empty(),$("#delivery_client").append(`<option>${i[n].account.Name}</option>`),e=i[n].account.Name;break}for(let t=0;t<a.length;t++)a[t].Name==e&&(n={id:a[t].id,category:"client"});let d="";if($.ajax({url:"/getContacts",type:"GET",async:!1,data:n,dataType:"html",success:function(t){n=JSON.parse(t)}}),0==n.length)d+="<option selected disabled>Контакты не указаны</option>";else for(let t=0;t<n.length;t++)d+=`<option value="${n[t].Contact_id}">${n[t].Position} | ${n[t].Name} | ${n[t].Number}</option>`;$("#delivery_contact_name").empty(),$("#delivery_contact_name").append(d);for(let e=0;e<i.length;e++)if(i[e].account.id==+t){let t,n=[];for(let t=0;t<i[e].items.length;t++)n.push(i[e].items[t].Stock_id);for(let t=0;t<n.length-1;t++)for(let e=t+1;e<n.length;e++)n[t]==n[e]&&(n.splice(e,1),e--);let a="";$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});for(let e=0;e<t.length;e++)for(let i=0;i<n.length;i++)t[e].id==n[i]&&(a+=`<option value="${t[e].Name}">${t[e].Name}</option>`);$("#delivery_stock").empty(),$("#delivery_stock").append(a);break}}function createNewItem(){let t=[{type:1,value:"stock_id"},{type:1,value:"group_id"},{type:1,value:"item_product"},{type:1,value:"item_prefix"},{type:2,value:"item_volume"},{type:1,value:"item_packing"},{type:2,value:"item_weight"},{type:2,value:"item_vat"},{type:2,value:"item_price"},{type:2,value:"item_purchase_price"}],e={};for(let n=0;n<t.length;n++){if(""==$(`#${t[n].value}`).val())return $(".page").append($("<div>",{class:"background"}).add('\n                            <div class="modal_select">\n                                <div class="title">\n                                    <span>Ошибка</span>\n                                    <img onclick="closeModal()" src="static/images/cancel.png">\n                                </div>\n                                <div class="content">\n                                    <div class="message">\n                                        <p style="font-size: 13px; color: #595959;">Все поля обязательно для заполнения!</p>\n                                    </div>\n                                </div>\n                            </div>\n                        '));t[n].type,e[t[n].value]=$(`#${t[n].value}`).val()}e.item_fraction="test",e.item_creator="test",$.ajax({url:"/addItemToStock",type:"GET",data:e,dataType:"html",success:function(){closeCardMenu("stock_new")}})}function createNewStock(){let t={};""!=$("#create_stock").val()&&(t.stock_name=$("#create_stock").val(),$.ajax({url:"/addStock",type:"GET",data:t,dataType:"html",success:function(){createCardMenu($("<div>",{id:"item_add"})[0])}}))}function createNewGroup(){let t={};""!=$("#create_group").val()&&(t.group_name=$("#create_group").val(),$.ajax({url:"/addItemGroup",type:"GET",data:t,dataType:"html",success:function(){createCardMenu($("<div>",{id:"item_add"})[0])}}))}function selectDrivers(t,e={Contact_Name:""}){$.ajax({url:"/getContacts",type:"GET",data:{category:"carrier",id:t},dataType:"html",success:function(t){$("#delivery_driver").empty(),$("#delivery_driver").append('<option value="Не выбран" selected disabled>Не выбран</option>'),t=JSON.parse(t);let n=categoryInListCarrier[1][1];for(let e=0;e<n.length;e++)for(let i=0;i<t.length;i++)if(n[e].id===t[i].Carrier_id){$("#delivery_type option").html(n[e].View);break}for(let n=0;n<t.length;n++)""!=e.Contact_Name&&e.Contact_Name==`${t[n].Position} | ${t[n].Last_name}`?$("#delivery_driver").append(`<option value="${t[n].Position} | ${t[n].Last_name}" selected>${t[n].Position} | ${t[n].Last_name}</option>`):$("#delivery_driver").append(`<option value="${t[n].Position} | ${t[n].Last_name}">${t[n].Position} | ${t[n].Last_name}</option>`)}})}function reloadStockItems(t){list_items_acc=null,list_stock_acc=null,createDelCardMenu(t)}function createDelCardMenu(t){$.ajax({url:"/getCarriers",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e),void 0===categoryInListCarrier[1][1]&&categoryInListCarrier[1].push(e),createCardMenu(t)}})}function comeBack(t){for(let e=0;e<dataName.length;e++){if(dataName[e].name===t){$(".card_menu").remove();for(let t=dataName[e].link[0].lastCard.length-1;t>=0;t--)if(null!==dataName[e].link[0].lastCard[t]){dataName[e].link[0].lastCard[t]=null;break}if($(".info").append(fillingTables(dataName[e].link)),$(".m_comment").is("#comment_content")){$("#comment_content").remove();let t=$(".close").attr("id").split("_"),e=[t[0],t[3]];getCommentsInfo.getRequest(e)}break}if(dataName[e].name+"-inv"===t){for(let e=0;e<linkCategoryInfo[0].subcategories.length;e++)linkCategoryInfo[0].subcategories[e][0].active=!1,linkCategoryInfo[0].subcategories[e][0].id==t.replace(/-inv/g,"")&&(linkCategoryInfo[0].subcategories[e][0].active=!0);categoryInFinanceAccount[0].lastCard[0]=null,$(".card_menu").remove(),linkCategory("category-0");break}}}function contractNext(t){checkEmail()&&(saveInfoCard(t.name,!0,t,"check"),getCommentsInfo.getRequest(t.name),saveCard())}function invoiceCard(t){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e),null==categoryInStock[1][1]&&categoryInStock[1].push(e),$(".card_menu").remove(),categoryInFinanceAccount[0].lastCard[0]=function(e){return $("<div>",{class:"card_menu invoicing",id:`${t.id}_invoicing_card`,append:$("<div>",{class:"content",append:invoicingContentCard(t,e)})})}(e),categoryInFinanceAccount[0].active=!0,categoryInFinanceDebit[0].active=!1,linkCategory("category-1"),linkField()}})}function completionCard(t){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e);let n=[];for(let t of $("#exposed_list .invoiled")){let i=$(t).attr("id").split("_")[1];if(""==$(`#invoiled_volume_${i}`).val()||0==$(`#invoiled_volume_${i}`).val())return $(".page").append($("<div>",{class:"background"}).add('\n                        <div class="modal_select">\n                            <div class="title">\n                                <span>Ошибка</span>\n                                <img onclick="closeModal()" src="static/images/cancel.png">\n                            </div>\n                            <div class="content">\n                                <div class="message">\n                                    <p style="font-size: 13px; color: #595959;">Введите объём для всех товаров!</p>\n                                </div>\n                            </div>\n                        </div>\n                    '));for(let t=0;t<e.length;t++)for(let a=0;a<e[t].items.length;a++){e[t].items[a].Item_id==i&&n.push({id:+i,volume:$(`#invoiled_volume_${i}`).val()})}}if(n.length>0){let e=[],i=[],a=[],d=[];for(let t of $("#exposed_list .invoiled")){let n=$(t).attr("id").split("_")[1];e.push($(t).children()[7].children[0].value),i.push($(t).children()[8].children[0].value),a.push($(t).children()[9].children[0].value),d.push({id:+n,amount:$(t).children()[11].innerHTML})}let s,l="false",o=getCurrentDateNotComparison("year"),c=deleteSpaces($("#total").html()),r="false";for(let e=0;e<dataName.length;e++)if("client"==dataName[e].name){for(let e=0;e<categoryInListClient[1][1].length;e++)categoryInListClient[1][1][e].id==$(t).attr("data_name").split("_")[1]&&(s=categoryInListClient[1][1][e].Name);dataName[e].link[0].lastCard=[null,null]}$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(t){let u=JSON.parse(t);$.ajax({url:"/addAccount",type:"GET",data:{manager_id:u.id,name:s,status:l,date:o,hello:JSON.stringify(i),sale:JSON.stringify(e),shipping:JSON.stringify(a),items_amount:JSON.stringify(d),sum:c,item_ids:JSON.stringify(n),total_costs:deleteSpaces($("#total_costs_inv").val()),sale_costs:deleteSpaces($("#total_discount_inv").val()),hello_costs:deleteSpaces($("#total_privet_inv").val()),delivery_costs:deleteSpaces($("#total_delivery_inv").val()),shipment:r,shipment_hello:""},dataType:"html",success:function(){closeCardMenu("account_new")}})}})}else if(0==n.length)return void alert("Невозможно создать счет, ни один товар не выбран!")}})}function closeCardMenu(t=""){if("user"!=t[1]){if(t.includes("stock")||t.includes("delivery")||t.includes("item"))getTableData(saveTableAndCard);else{saveInfoCard(t);let e=t.split("_"),n=`${e[0]}_${e[e.length-1]}`;t.includes("account")||getCommentsInfo.getRequest(n)}null!==categoryInFinanceAccount[0].lastCard[0]&&t.split("_")[0]===categoryInFinanceAccount[0].lastCard[0][0].id.split("_")[0]&&(categoryInFinanceAccount[0].lastCard[0]=null)}else getTableData(saveTableAndCard)}function closeModalMenu(){$(".modal_search").remove(),$(".overflow").remove(),$(".search #search").val("")}function deleteCard(t){if(!confirm("Удалить карточку?"))return;let e=t.split("_");$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(t){this_user=JSON.parse(t),"admin"==this_user.role&&$.ajax({url:"/deleteCard",type:"GET",data:{category:e[0],id:e[1]},dataType:"html",success:function(){getTableData(saveTableAndCard)}})}})}function getTitleInfo(t,e){let n=$("<div>",{class:"title"}),i=$("<div>",{class:"left_side"});n.append(i);for(let e=0;e<t.list.length;e++)i.append($("<span>",{html:t.list[e]}));return n.append(function(){function n(){return $("<div>",{class:"close",id:`${t.id}_close_card_${t.status}`,name:"account"==t.id?`${t.id}_${t.status}`:"",onclick:"delivery"!==t.id?"closeCardMenu(this.id)":"makeRequest(this)",append:$("<img>",{src:"static/images/cancel.png"})})}if("client"===t.id||"provider"===t.id){let i=$("<div>",{class:"right_side"});return t.status.includes("contract")||t.status.includes("new")||i.append(function(){let n,i;if($.ajax({url:"/getUsers",type:"GET",async:!1,dataType:"html",success:function(t){n=JSON.parse(t)}}),$.ajax({url:"/getThisUser",type:"GET",async:!1,dataType:"html",success:function(t){i=JSON.parse(t)}}),e.Manager_active){let i;for(let t=0;t<n.length;t++)if(+n[t].id==+e.Manager_id){i=convertName(`${n[t].name} ${n[t].second_name}`),username=i;break}return $("<div>",{class:"gray",id:"user",append:$("<div>",{class:"drop_menu",id:`${t.id}_${t.status}`,html:"Открепить карточку от менеджера",onclick:"detachmentCard(this)"}).add($("<div>",{onclick:"unfastenCard(this)",class:"hover",id:`remove-${t.id}-${t.status}`,append:$("<img>",{src:"static/images/dropmenu_black.svg",class:"drop_down_img padl"}).add($("<span>",{html:i,class:"marl"}))}))})}return $("<div>",{class:"gray",id:"user",append:$("<div>",{class:"drop_menu none",id:`${t.id}-user-${t.status}`,html:function(){let e=$("<ul>",{class:"list"});for(let i=0;i<n.length;i++)"manager"==n[i].role&&e.append($("<li>",{html:n[i].second_name,id:n[i].id,card:`${t.id}_${t.status}`,onclick:"selectManagerInCard(this)"}));return"admin"==i.role&&e.append($("<li>",{html:"Удалить карточку",id:`${t.id}_${t.status}`,onclick:"deleteCard(this.id)"})),e}()}).add($("<div>",{onclick:"unfastenCard(this)",class:"hover",id:`remove-${t.id}-${t.status}`,append:$("<img>",{src:"static/images/dropmenu_black.svg",class:"drop_down_img padl"}).add($("<span>",{html:"Прикрепить карточку к менеджеру",class:"marl"}))}))})}()),i.append(n()),i}return $("<div>",{class:"right_side",append:n()})}()),n}$(document).mouseup(function(t){let e=$(".drop_menu");0===e.has(t.target).length&&e.fadeOut(200)});