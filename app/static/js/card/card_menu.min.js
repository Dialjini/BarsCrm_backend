let saveTableAndCard;$(document).mouseup(function(i){let e=$(".drop_menu");0===e.has(i.target).length&&e.fadeOut(200)});function getCurrentTime(){let e=new Date,i=12<e.getHours()?e.getHours():10>e.getHours()?"0"+e.getHours():e.getHours(),t=10>e.getMinutes()?"0"+e.getMinutes():e.getMinutes();return`${i}:${t}`}function getCurrentDate(e="none"){let i=new Date,t=10>+i.getMonth()+1?"0"+(+i.getMonth()+1):+i.getMonth()+1,d=10>i.getDate()?"0"+i.getDate():i.getDate();if("none"!==e){let e=i.getFullYear();return e=(e+"").substring(2,4),`${d}.${t}.${e}`}return`${d}.${t}`}function createCardMenu(e,i=0){function t(){let e=$("<div>",{class:"card_menu",id:"card_menu",append:getTitleInfo(infoElement,m).add(d(infoElement))});return e}function d(e){let i=$("<div>",{class:"content"});return i.append(e.link(m)),i}function n(){function e(e){if(0==e.length)addRow(`${t}-group`);else for(let d=0;d<e.length;d++)addRow(`${t}-group`,e[d])}function i(e){if(0==e.length)addMember(t);else for(let d=0;d<e.length;d++)addMember(t,e[d])}a(m,p[0]);let t=p[0],d=p[1];"new"==d?(addMember(t),addRow(`${t}-group`),$("[name=\"remove_last_group\"]").fadeOut(0)):("client"==t||"provider"==t?$.ajax({url:"/getItems",type:"GET",data:{category:t,id:d},dataType:"html",success:function(i){e(JSON.parse(i))}}):e([]),$.ajax({url:"/getContacts",type:"GET",data:{category:t,id:d},dataType:"html",success:function(e){i(JSON.parse(e)),getCommentsInfo.getRequest(p)}}))}function a(e,t){$.ajax({url:"static/js/regions/regions.json",async:!1,success:function(d){let n=null==e.Oblast?e.Region:e.Oblast,a=null==e.Rayon?e.Area:e.Rayon,s=$("<select>"),l="<option value=\"\">\u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D</option>";for(let e=0;e<d.length;e++)d[e].region==n?(l+=`<option selected value="${d[e].region}">${d[e].region}</option>`,s.id=`${t}_select`,s.value=d[e].region):l+=`<option value="${d[e].region}">${d[e].region}</option>`;$(`#${t}_region`).empty(),$(`#${t}_region`).append(l),getListAreas(s,a)}})}function s(e){let i=$("<div>",{class:"row_card",append:$("<table>",{class:"table_block",append:$("<tr>",{append:$("<td>",{class:"bold",html:"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435"}).add($("<td>",{append:$("<input>",{type:"text",id:"client_name",onchange:"saveCard()",value:e.Name})}))}).add(`<tr>
                            <td>Область/Край</td>
                            <td>
                                <select id="client_region" onchange="getListAreas(this)"></select>
                            </td>
                        </tr>
                        <tr>
                            <td>Район</td>
                            <td><select id="client_area" onchange="saveCard()"></select></td>
                        </tr>
                        <tr>
                            <td>Адрес</td>
                            <td><input type="text" id="client_address" onchange="saveCard()" value="${e.Adress}"></td>
                        </tr>
                        <tr>
                            <td>ИНН</td>
                            <td><input type="text" id="client_inn" onchange="saveCard()" value="${e.UHH}"></td>
                        </tr>
                        <tr>
                            <td>БИК</td>
                            <td><input type="text" id="client_bik" onchange="saveCard()" value="${e.Bik}"></td>
                        </tr>
                        <tr>
                            <td>К/С</td>
                            <td><input type="text" id="client_kc" onchange="saveCard()" value="${e.kc}"></td>
                        </tr>
                        <tr>
                            <td>Р/С</td>
                            <td><input type="text" id="client_rc" onchange="saveCard()" value="${e.rc}"></td>
                        </tr>`)}).add(`<table class="table_block">
                        <tr>
                            <td>Тег</td>
                            <td><input type="text" id="client_tag" onchange="saveCard()" class="string" value="${e.Tag}"></td>
                        </tr>
                        <tr>
                            <td>Категория</td>
                            <td>
                                <select id="client_category" onchange="itemSelection(this)">
                                    <option value="disabled" selected disabled>Выбрать</option>
                                    <option value="category_0">Клиент</option>
                                    <option value="category_1">Потенциальный клиент</option>
                                    <option value="category_2">Лидер</option>
                                    <option value="category_3">Неперспективный клиент</option>
                                    <option value="category_4">Конкурент</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Ж/Д Станция</td>
                            <td> <input type="text" id="client_station" onchange="saveCard()" class="string" value="${e.Station}"></td>
                        </tr>
                        <tr>
                            <td>Цена вагона</td>
                            <td><input type="text" id="client_price" onchange="saveCard()" class="string" value="${e.Price}"></td>
                        </tr>
                        <tr>
                            <td>км от НСК</td>
                            <td><input type="text" id="client_distance" onchange="saveCard()" class="string" value="${e.Distance}"></td>
                        </tr>
                    </table>
                    <div class="info_block">
                        <span class="lightgray">Отрасль</span>
                        <select id="client_industry" onchange="itemSelection(this)">
                            <option value="disabled" selected disabled>Выбрать</option>
                            <option value="industry_0">Животноводство</option>
                            <option value="industry_1">Птицеводство</option>
                            <option value="industry_2">Свиноводство</option>
                            <option value="industry_3">Растениеводство</option>
                            <option value="industry_4">Рыбоводство</option>
                            <option value="industry_5">Комбикормовый</option>
                        </select>
                        <span class="lightgray" style="margin-top: 17px;">Поголовье</span>
                        <table>
                            <tr>
                                <td>Общее</td>
                                <td>Дойного</td>
                                <td>Надои</td>
                            </tr>
                            <tbody id="livestock">
                                <tr>
                                    <td><input id="livestock_general" type="text" style="width: 75px" value="${e.Livestock_all}"></td>
                                    <td><input id="livestock_milking" type="text" style="width: 75px" value="${e.Livestock_milking}"></td>
                                    <td><input id="livestock_milkyield" type="text" style="width: 75px" value="${e.Livestock_milkyield}"></td>
                                </tr>
                            </tbody>
                        </table>
                        <span class="lightgray" style="margin-top: 17px;">Спрос</span>
                        <table>
                            <tr>
                                <td>Товар</td>
                                <td>Объем</td>
                            </tr>
                            <tbody id="demand">
                                <tr>
                                    <td>
                                        <select id="demand_product" style="width: 196px" onchange="itemSelection(this)">
                                            ${getItemsList("demand_product",e,p[0])}
                                        </select>
                                    </td>
                                    <td><input id="demand_volume" type="number" style="width: 50px" value="${e.Demand_volume}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>`)}).add(`<div class="row_card" id="media">
                    <div class="left_side">
                        <div class="hmax" id="member"></div>
                        <div class="events">
                            <img class="add_something" src="static/images/add.png" onclick="addMember()">
                        </div>
                    </div>
                    <div class="info_block" style="width: fit-content">
                        <span class="lightgray">Группа товаров</span>
                        <div class="hmax">
                            <table>
                                <tr>
                                    <td>Товар</td>
                                    <td>Объем</td>
                                    <td>У кого</td>
                                    <td>Цена</td>
                                </tr>
                                <tbody id="group"></tbody>
                            </table>
                        </div>
                        <div class="events">
                            <img class="add_something" id="client-group" src="static/images/add.png" onclick="addRow(this.id)">
                            <img name="remove_last_group" class="add_something" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">
                        </div>
                    </div>
                </div>
                <div class="area">
                    <div class="history">
                        <div class="title">
                            <div>История обращений</div>
                            <img id="add_new_comment" onclick="addComment()" class="add_something" src="static/images/add.png">
                        </div>
                        <div class="messages">
                            <table class="message">
                                <tbody id="messages"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="last_comment">
                        <div class="title">Последние комментарии</div>
                        <div class="messages">
                            <table class="message">
                                <tbody id="comments"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="next">
                    <button class="btn btn-main" id="client" onclick="contractNext(this)">Оформить Договор</button>
                </div>`);return i}function l(e){let i=$("<div>",{class:"row_card",append:$("<table>",{class:"table_block",append:$("<tr>",{append:$("<td>",{class:"bold",html:"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435"}).add($("<td>",{append:$("<input>",{type:"text",id:"provider_name",value:e.Name,onchange:"saveCard()"})}))}).add(`<tr>
                            <td>Область/Край</td>
                            <td>
                                <select id="provider_region" onchange="getListAreas(this)"></select>
                            </td>
                        </tr>
                        <tr>
                            <td>Район</td>
                            <td><select id="provider_area" onchange="saveCard()"></select></td>
                        </tr>
                        <tr>
                            <td>Адрес</td>
                            <td>
                                <input type="text" id="provider_address" onchange="saveCard()" value="${e.Adress}">
                            </td>
                        </tr>
                        <tr>
                            <td>ИНН</td>
                            <td>
                                <input type="text" id="provider_inn" onchange="saveCard()" value="${e.UHH}">
                            </td>
                        </tr>`)}).add(`<table class="table_block">
                        <tr>
                            <td>Тег</td>
                            <td>
                                <input type="text" id="provider_tag" class="string" onchange="saveCard()" value="${e.Tag}">
                            </td>
                        </tr>
                        <tr>
                            <td>Категория</td>
                            <td>
                                <select id="provider_category" onchange="itemSelection(this)">
                                    <option value="disabled" selected disabled>Выбрать</option>
                                    <option value="category_0">Клиент</option>
                                    <option value="category_1">Потенциальный клиент</option>
                                    <option value="category_2">Лидер</option>
                                    <option value="category_3">Неперспективный клиент</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>Ж/Д Станция</td>
                            <td>
                                <input type="text" id="provider_station" class="string" onchange="saveCard()" value="${e.Train}">
                            </td>
                        </tr>
                        <tr>
                            <td>Цена вагона</td>
                            <td>
                                <input type="text" id="provider_price" class="string" onchange="saveCard()" value="${e.Price}">
                            </td>
                        </tr>
                        <tr>
                            <td>км от НСК</td>
                            <td>
                                <input type="text" id="provider_distance" class="string" onchange="saveCard()" value="${e.Distance}">
                            </td>
                        </tr>
                    </table>
                    <table class="table_block">
                        <tr>
                            <td>Объем про-ва</td>
                            <td>
                                <input type="text" id="provider_volume" class="string" onchange="saveCard()" value="${e.Volume}">
                            </td>
                        </tr>
                        <tr>
                            <td>НДС</td>
                            <td>
                                <input type="text" id="provider_vat" class="string" onchange="saveCard()" value="${e.NDS}">
                            </td>
                        </tr>
                        <tr>
                            <td>Меркурий</td>
                            <td>
                                <input type="text" id="provider_merc" class="string" onchange="saveCard()" value="${e.Merc}">
                            </td>
                        </tr>
                    </table>`)}).add(`<div class="row_card" id="media">
                    <div class="left_side">
                        <div class="hmax" id="member"></div>
                        <div class="events">
                            <img class="add_something" src="static/images/add.png" onclick="addMember()">
                        </div>
                    </div>
                    <div class="info_block" style="width: fit-content">
                        <span class="lightgray">Группа товаров</span>
                        <div class="hmax">
                            <table>
                                <tr><td>Товар</td><td>Цена</td><td>Дата</td><td>НДС</td><td>Упаковка</td><td>Вес</td><td>Фракция</td></tr>
                                <tbody id="group"></tbody>
                            </table>
                        </div>
                        <div class="events">
                            <img class="add_something" id="provider-group" src="static/images/add.png" onclick="addRow(this.id)">
                            <img name="remove_last_group" class="add_something" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">
                        </div>
                    </div>
                </div>
                <div class="area">
                    <div class="history">
                        <div class="title">
                            <div>История обращений</div>
                            <img id="add_new_comment" onclick="addComment()" class="add_something" src="static/images/add.png">
                        </div>
                        <div class="messages">
                            <table class="message">
                                <tbody id="messages"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="last_comment">
                        <div class="title">Последние комментарии</div>
                        <div class="messages">
                            <table class="message">
                                <tbody id="comments"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="next">
                    <button class="btn btn-main" id="provider" onclick="closeCardMenu(this.name)">Сохранить</button> 
                </div>`);return i}function r(e){let i=$("<div>",{class:"row_card",css:{"justify-content":"flex-start"},append:$("<table>",{class:"table_block",css:{"margin-right":"50px"},append:$("<tr>",{append:$("<td>",{class:"bold",html:"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435"}).add($("<td>",{append:$("<input>",{type:"text",id:"carrier_name",value:e.Name,onchange:"saveCard()"})}))}).add(`<tr>
                            <td>Область/Край</td>
                            <td>
                                <select id="carrier_region" onchange="getListAreas(this)"></select>
                            </td>
                        </tr>
                        <tr>
                            <td>Район</td>
                            <td><select id="carrier_area" onchange="saveCard()"></select></td>
                        </tr>
                        <tr>
                            <td>Адрес</td>
                            <td>
                                <input type="text" id="carrier_address" onchange="saveCard()" class="string" value="${e.Address}">
                            </td>
                        </tr>`)}).add(`<table class="table_block">
                        <tr>
                            <td>ИНН</td>
                            <td>
                                <input type="text" id="carrier_inn" onchange="saveCard()" class="string" value="${e.UHH}">
                            </td>
                        </tr>
                        <tr>
                            <td>БИК</td>
                            <td><input type="text" id="carrier_bik" onchange="saveCard()" value="${e.Bik}"></td>
                        </tr>
                        <tr>
                            <td>К/С</td>
                            <td><input type="text" id="carrier_kc" onchange="saveCard()" value="${e.kc}"></td>
                        </tr>
                        <tr>
                            <td>Р/С</td>
                            <td><input type="text" id="carrier_rc" onchange="saveCard()" value="${e.rc}"></td>
                        </tr>
                    </table>`).add(`
                    <table class="table_block">
                        <tr>
                            <td>Грузоподъемность</td>
                            <td>
                                <input type="text" id="carrier_capacity" onchange="saveCard()" value="${e.Capacity}" class="string">
                            </td>
                        </tr>
                        <tr>
                            <td>Вид перевозки</td>
                            <td>
                                <select id="carrier_view">
                                    ${function(){return""==e.View?`
                    <option selected disabled value="">Не выбран</option>
                    <option value="Авто">Авто</option>
                    <option value="Ж/Д">Ж/Д</option>
                `:"\u0410\u0432\u0442\u043E"==e.View?`
                        <option selected value="Авто">Авто</option>
                        <option value="Ж/Д">Ж/Д</option>
                    `:"\u0416/\u0414"==e.View?`
                        <option value="Авто">Авто</option>
                        <option selected value="Ж/Д">Ж/Д</option>
                    `:void 0}()}
                                </select>
                            </td>
                        </tr>
                    </table>
                    `)}).add(`<div class="row_card" id="media">
                    <div class="left_side">
                        <div class="hmax" id="member"></div>
                        <div class="events">
                            <img class="add_something" src="static/images/add.png" onclick="addMember('carrier')">
                        </div>
                    </div>
                    <div class="info_block" style="width: fit-content">
                        <span class="lightgray">Рейсы</span>
                        <div class="hmax">
                            <table>
                                <tr>
                                    <td>Дата</td>
                                    <td>Клиент</td>
                                    <td>Склад</td>
                                    <td>Водитель</td>
                                    <td>Цена</td>
                                </tr>
                                <tbody id="group"></tbody>
                            </table>
                        </div>
                        <div class="events">
                            <img class="add_something" id="carrier-group" src="static/images/add.png" onclick="addRow(this.id)">
                            <img class="add_something" name="remove_last_group" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">
                        </div>
                    </div>
                </div>
                <div class="area">
                    <div class="history">
                        <div class="title">
                            <div>История обращений</div>
                            <img id="add_new_comment" onclick="addComment()" class="add_something" src="static/images/add.png">
                        </div>
                        <div class="messages">
                            <table class="message">
                                <tbody id="messages"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="last_comment">
                        <div class="title">Последние комментарии</div>
                        <div class="messages">
                            <table class="message">
                                <tbody id="comments"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="next">
                    <button class="btn btn-main" id="carrier" onclick="contractNext(this)">Оформить Договор</button>
                </div>`);return i}function c(e){function i(){let r=e.items,c="",u=[],o=[];for(let e=0;e<r.length;e++)u.push(r[e].Stock_id),o.push(r[e].Item_id),t+=+l[e].amount,c=c.concat(`
                    <tr class="product" id="product_${r[e].Item_id}">
                        <td>${r[e].Name}</td>
                        <td>${r[e].Packing}</td>
                        <td>${r[e].Weight}</td>
                        <td>${Math.round(r[e].Transferred_volume/r[e].Weight)}</td>
                        <td>${r[e].Transferred_volume}</td>
                        <td>${r[e].Cost}</td>
                        <td>${+n[e]}</td>
                        <td>${+a[e]}</td>
                        <td>${+s[e]}</td>
                        <td>${Math.round(r[e].Cost/r[e].Transferred_volume)}</td>
                        <td>${+l[e].amount}</td>
                    </tr>
                `);for(let e=0;e<u.length-1;e++)for(let i=e+1;i<u.length;i++)u[e]==u[i]&&(u.splice(i,1),i--);if(c=c.concat(`
                <div id="stock_items_list" style="display: none" data-stock="${u}" data-items="${o}"></div>
            `),r[0].NDS=r[0].NDS[0]+r[0].NDS[1],d=0<t?t-t*+r[0].NDS/100:0,0<5-r.length)for(let e=0;e<5-r.length;e++)c=c.concat(`
                        <tr class="product">
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    `);return c}let t=0,d=0,n=JSON.parse(e.account.Sale),a=JSON.parse(e.account.Hello),s=JSON.parse(e.account.Shipping),l=JSON.parse(e.account.Items_amount);for(let d=0;d<n;d++)t+=+n[d]+ +a[d]+ +s[d];return` <div class="row_card">
                    <div class="info_block full">
                        <table class="account_table">
                            <tr>
                                <th rowspan="2">Товар</th>
                                <th colspan="2">Фасовка</th>
                                <th colspan="2">Количество</th>
                                <th colspan="5">Цена</th>
                                <th style="width: 90px;" rowspan="2">Сумма</th>
                            </tr>
                            <tr>
                                <th>Тара</th>
                                <th>Вес</th>
                                <th>В тарах</th>
                                <th>Объем</th>
                                <th>Цена прайса</th>
                                <th>Скидка</th>
                                <th>Привет</th>
                                <th>Доставка</th>
                                <th>За единицу</th>
                            </tr>
                            ${i()}
                            <tr>
                                <td colspan="9" style="border: none; border-top: 1px solid #e9e9e9"></td>
                                <td colspan="2" class="fz10">
                                    <div class="flex jc-sb"><span class="gray">НДС</span><span>${Math.round(t-d)}</span></div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="9" style="border: none;"></td>
                                <td colspan="2" class="fz10">
                                    <div class="flex jc-sb"><span class="gray">Без НДС</span><span>${Math.round(d)}</span></div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="9" style="border: none;"></td>
                                <td colspan="2" class="fz10">
                                    <div class="flex jc-sb"><span class="gray">Общая</span><span>${Math.round(t)}</span></div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row_card">
                    <div class="info_block">
                        <span class="lightgray">Оплата</span>
                        <div class="hmax">
                            <table>
                                <tr>
                                    <th>Дата</th>
                                    <th>Сумма</th>
                                </tr>
                                <tbody id="group"></tbody>
                            </table>
                        </div>
                        <div class="events">
                            <img class="add_something" id="account-group" src="static/images/add.png" onclick="addRow(this.id)">
                            <img name="remove_last_group" class="add_something" src="static/images/remove.png" onclick="removeMemberOrRow(this.name)">
                        </div>
                    </div>
                </div>
                <div class="next">
                    <div style="display:none" id="list_stock" data-stock=""></div>
                    <button class="btn btn-main" id="delivery_new" onclick="checkStocks(this)">Оформить Доставку</button>
                </div>`}function u(e){return`<div class="row_card">
                    <div class="info_block full">
                        <div class="mb">
                            <span class="bold">Транзит со склада</span>
                            <select class="margin">
                                <option selected disabled value="${e.stock_address}">${e.stock_address}</option>
                            </select>
                        </div>
                        <div>
                            <table class="full">
                                <tr>
                                    <td>Группа товаров</td>
                                    <td>Товар</td>
                                    <td>Юр. лицо</td>
                                    <td>Объем</td>
                                    <td>Фасовка</td>
                                    <td>Цена прайса</td>
                                </tr>
                                <tbody>
                                    <tr>
                                        <td>${e.Group_name}</td>
                                        <td>${e.Name}</td>
                                        <td>${e.Prefix}</td>
                                        <td id="from">${e.Volume}</td>
                                        <td>${e.Packing}</td>
                                        <td>${e.Cost}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div> 
                    </div>
                </div>
                <div class="row_card">
                    <div class="info_block full">
                        <div>
                            <span class="bold">На склад</span>
                            <select id="stock_select" class="margin">
                                ${function(){let t=categoryInStock[1][1],d=[];for(let n=0;n<t.length;n++)d.push(t[n].stock_address),d[n]==e.stock_address&&d.splice(n,1);let n="<option disabled selected>\u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D</option>";for(let e=0;e<d.length;e++)n+=`<option value="${d[e]}">${d[e]}</option>`;return 0==d.length&&(n=`<option value="null" disabled selected>Нет другого склада</option>`),n}()}
                            </select>
                        </div>
                        <div class="mb">
                            <span class="bold">Объем</span>
                            <input style="width: 60px" type="number" id="volume_transit" class="margin" oninput="fillVolume(this.value)">
                        </div>
                        <div>
                            <table class="full">
                                <tr>
                                    <td>Группа товаров</td>
                                    <td>Товар</td>
                                    <td>Юр. лицо</td>
                                    <td>Объем</td>
                                    <td>Фасовка</td>
                                    <td>Цена прайса</td>
                                </tr>
                                <tbody>
                                    <tr>
                                        <td>${e.Group_name}</td>
                                        <td>${e.Name}</td>
                                        <td>${e.Prefix}</td>
                                        <td id="volume_goods"></td>
                                        <td>${e.Packing}</td>
                                        <td>${e.Cost}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>     
                </div>
                <div class="next">
                    <button class="btn btn-main" id="transit" onclick="transitProduct(this)">Оформить</button>
                </div>
                `}function o(e){return`<div class="row_card">
                        <table class="table_block">
                            <tr>
                                <td>Заказчик</td>
                                <td>
                                    <select id="delivery_customer">
                                        ${function(){let i="";return i+="\u0418\u041F"==e.Customer?`
                    <option selected>ИП</option>
                    <option>ООО</option>
                `:`
                    <option>ИП</option>
                    <option selected>ООО</option>
                `,i}()}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Дней отсрочки</td>
                                <td>
                                    <input type="number" style="width: 200px" id="delivery_postponement_date" value="${e.Postponement_date}">
                                </td>
                            </tr>
                            <tr>
                                <td>Дата отгрузки</td>
                                <td>
                                    <input type="text" style="width: 200px" id="delivery_start_date" value="${e.Start_date}">
                                </td>
                            </tr>
                            <tr>
                                <td>Дата разгрузки</td>
                                <td>
                                    <input type="text" style="width: 200px" id="delivery_end_date" value="${e.End_date}">
                                </td>
                            </tr>
                            <tr>
                                <td>Способ погрузки</td>
                                <td>
                                    <input type="text" style="width: 200px" id="delivery_load_type" value="${e.Load_type}">
                                </td>
                            </tr>
                        </table>
                        <table class="table_block">
                            <tr>
                                <td>Счёт</td>
                                <td>
                                    <select id="delivery_account" onchange="selectAccount(this.value)">
                                        ${function(){let t="";return $.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",success:function(d){if(d=JSON.parse(d),null==categoryInFinanceAccount[1][1]&&categoryInFinanceAccount[1].push(d),""==e.Account_id){t+=`<option disabled selected>Не выбран</option>`;for(let e=0;e<d.length;e++)t+=`<option value="${d[e].account.id}">Счёт ${d[e].account.id}</option>`}else t+=`<option disabled selected value="${e.Account_id}">Счёт ${e.Account_id}</option>`}}),t}()}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Клиент</td>
                                <td>
                                    <select id="delivery_client">
                                        ${function(){let t="",d=categoryInFinanceAccount[1][1];for(let n=0;n<d.length;n++)if(d[n].account.id==e.Account_id){""==e.Account_id?t+=`<option selected disabled>Не выбран</option>`:(e.Name=d[n].account.Name,t+=`<option disabled selected value="${d[n].account.Name}">${d[n].account.Name}</option>`);break}return""==e.Account_id&&(t+=`<option selected disabled>Выберите счёт</option>`),t}()}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Контакт на выгрузке</td>
                                <td>
                                    <select id="delivery_contact_name">
                                        ${function(){let t,d,n=categoryInListClient[1][1],a="";for(let t=0;t<n.length;t++)if(n[t].Name==e.Name){d={id:n[t].id,category:"client"};break}if(null==d)return`<option selected disabled>Выберите счёт</option>`;if($.ajax({url:"/getContacts",type:"GET",async:!1,data:d,dataType:"html",success:function(e){t=JSON.parse(e)}}),0==t.length)a+="<option selected disabled>\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u044B</option>";else for(let d=0;d<t.length;d++)a+=+e.Contact_End==+t[d].Contact_id?`<option selected value="${t[d].Contact_id}">${t[d].Position} | ${t[d].Name} | ${t[d].Number}</option>`:`<option value="${t[d].Contact_id}">${t[d].Position} | ${t[d].Name} | ${t[d].Number}</option>`;return a}()}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Склад</td>
                                <td>
                                    <select id="delivery_stock">
                                        ${function(){return null==list_stock_acc?""==e.Stock?`<option selected value="null">Выберите счёт</option>`:`<option selected value="${e.Stock}">${e.Stock}</option>`:`<option selected value="${list_stock_acc}">${list_stock_acc}</option>`}()}
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Комментарий</td>
                                <td>
                                    <input type="text" style="width: 200px" id="delivery_comment" value="${e.Comment}">
                                </td>
                            </tr>
                        </table>
                        <table class="table_block">
                            <tr>
                                <td>Перевозчик</td>
                                <td>
                                    ${function(){let t=categoryInListCarrier[1][1],d=[],n="<select id=\"delivery_carrier_id\" onchange=\"selectDrivers(this.value)\">";n+="<option value=\"disabled\" selected disabled>\u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D</option>";for(let a=0;a<t.length;a++)""!=e.Carrier_id&&e.Carrier_id==t[a].id?(n+=`<option value="${t[a].id}" selected>${t[a].Name}</option>`,selectDrivers(t[a].id,e)):n+=`<option value="${t[a].id}">${t[a].Name}</option>`,d.push({name:t[a].Name,id:t[a].id});return n+="</select>",n}()}
                                </td>
                            </tr>
                            <tr>
                                <td>Вид перевозки</td>
                                <td>
                                    <select id="delivery_type" disabled>
                                        <option selected disabled></option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>Водитель</td>
                                <td>
                                    <select id="delivery_driver"></select>
                                </td>
                            </tr>
                            <tr>
                                <td>Марка авто</td>
                                <td>
                                    <input type="text" style="width: 200px" value="${e.Auto}" id="delivery_car">
                                </td>
                            </tr>
                            <tr>
                                <td>Паспортные данные</td>
                                <td>
                                    <input type="text" style="width: 200px" value="${e.Passport_data}" id="delivery_passport">
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="row_card">
                        <div class="info_block">
                            <div>
                                <span class="lightgray">Рейс</span>
                                <table>
                                    <tr>
                                        <th>Товар</th>
                                        <th>Склад</th>
                                        <th>Вес</th>
                                        <th>Вид упаковки</th>
                                        <th>Сумма</th>
                                    </tr>
                                    <tbody id="flight">
                                        ${function(){let t,d=[];$.ajax({url:"/getAllItems",type:"GET",async:!1,dataType:"html",success:function(e){d=JSON.parse(e)}}),$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});let n="",a=categoryInFinanceAccount[1][1];for(let s=0;s<d.length;s++){if(null==list_items_acc)if(""!=e.Item_ids)list_items_acc=JSON.parse(e.Item_ids);else return"";let i;null!=e.Amounts&&(i=JSON.parse(e.Amounts));for(let r=0;r<list_items_acc.length;r++)for(let c=0;c<t.length;c++)for(let u,o=0;o<a.length;o++){u=JSON.parse(a[o].account.Item_ids);for(let l=0;l<u.length;l++)+list_items_acc[r]==+d[s].Item_id&&+d[s].Stock_id==t[c].id&&a[o].account.id==e.Account_id&&+d[s].Item_id==u[l].id&&(n+=null==i?`
                                        <tr id="item_flight_${d[s].Item_id}" name="item_flight">
                                            <td>${d[s].Name}</td>
                                            <td>${t[c].Name}</td>
                                            <td>${u[l].volume}</td>
                                            <td>${d[s].Packing}</td>
                                            <td><input id="item_sum" type="number"></td>
                                        </tr>
                                        `:`
                                        <tr id="item_flight_${d[s].Item_id}" name="item_flight">
                                            <td>${d[s].Name}</td>
                                            <td>${t[c].Name}</td>
                                            <td>${u[l].volume}</td>
                                            <td>${d[s].Packing}</td>
                                            <td><input id="item_sum" value="${i[s]}" type="number"></td>
                                        </tr>
                                        `)}}return n}()}
                                    </tbody>
                                </table>
                            </div>
                            <div class="info_block fit" style="margin-top: 15px;">
                                <span class="lightgray" style="margin-top: 10px;">Оплата</span>
                                <div class="hmax">
                                    <table style="width: fit-content">
                                        <tr>
                                            <th>Дата</th>
                                            <th>Сумма</th>
                                        </tr>
                                        <tbody id="group"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="next">
                        <button class="btn" style="margin-right: 10px" id="delivery_new" onclick="closeCardMenu(this.id)">Забирает сам</button>
                        <button class="btn btn-main" id="delivery_new" onclick="createDocument(this)">Оформить Заявку</button>
                    </div>`}sortStatus={product:{status:!1,filter:null,last:null},price:{status:!1,filter:null},area:{status:!1,filter:null},category:{status:!1,filter:null,last:null},manager:{status:!1,filter:null,last:null}},0==i?($(".table, .blockCreateEmptyCard").remove(),$("[name=\"linkCategory\"]").removeClass("active")):$(".overflow").remove(),$(".card_menu").remove();let p=e.id.split("_"),m={};const _=[{id:"client",list:[],link:s,status:p[1]},{id:"provider",list:[],link:l,status:p[1]},{id:"carrier",list:[],link:r,status:p[1]},{id:"debit",list:[""],link:function(){return`Секретное место. Если вы видите это сообщение, то что-то пошло не так. Сообщите об этом вашему непосредственному руководству.`},status:p[1]},{id:"account",list:[],link:c,status:p[1]},{id:"delivery",list:[`Оформить заявку на Доставку`],link:o,status:p[1]},{id:"stock",list:[""],link:u,status:p[1]},{id:"item",list:["\u0414\u043E\u0431\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0442\u043E\u0432\u0430\u0440\u0430","* \u0412\u0441\u0435 \u043F\u043E\u043B\u044F \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u044B \u043A \u0437\u0430\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044E"],link:function(){return`
            <div class="row_card">
                <table class="table_block">
                    <tr>
                        <td>Склад</td>
                        <td>
                            <select type="text" id="stock_id">${function(){let e;$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(i){e=JSON.parse(i)}});let t="";t+=`<option value="0">Не выбран</option>`;for(let d=0;d<e.length;d++)t+=`<option value="${e[d].id}">${e[d].Name}</option>`;return t}()}</select>
                        </td>
                    </tr>
                    <tr>
                        <td>Группа товаров</td>
                        <td>
                            <select type="text" id="group_id">${function(){let e;$.ajax({url:"/getItemGroup",type:"GET",async:!1,dataType:"html",success:function(i){e=JSON.parse(i)}});let t="";for(let d=0;d<e.length;d++)t+=`<option value="${e[d].id}">${e[d].Group}</option>`;return t}()}</select>
                        </td>
                    </tr>
                    <tr>
                        <td>Товар</td>
                        <td><input type="text" id="item_product" onchange="saveCard()" class="string"></td>
                    </tr>
                </table>
                <table class="table_block">
                    <tr>
                        <td>Юр. лицо</td>
                        <td>
                            <select type="text" id="item_prefix">
                                <option value="ООО">ООО</option>
                                <option value="ИП">ИП</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>Объем</td>
                        <td><input type="number" id="item_volume" onchange="saveCard()" class="string"></td>
                    </tr>
                    <tr>
                        <td>Фасовка</td>
                        <td><input type="text" id="item_packing" onchange="saveCard()" class="string"></td>
                    </tr>
                </table>
                <table class="table_block">
                    <tr>
                        <td>Вес</td>
                        <td><input type="number" id="item_weight" onchange="saveCard()" class="string"></td>
                    </tr>
                    <tr>
                        <td>НДС</td>
                        <td><input type="number" id="item_vat" onchange="saveCard()" class="string"></td>
                    </tr>
                    <tr>
                        <td>Цена прайса</td>
                        <td><input type="number" id="item_price" onchange="saveCard()" class="string"></td>
                    </tr>
                    <tr>
                        <td>Закупочная цена</td>
                        <td><input type="number" id="item_purchase_price" onchange="saveCard()" class="string"></td>
                    </tr>
                </table> 
            </div>
            <div> 
                <table class="table_block" style="margin-bottom: 15px;">
                    <tr>
                        <td><input id="create_stock" type="text" style="width: 240px; margin-right: 15px;" placeholder="Адрес склада"></td>
                        <td><button class="btn btn-main" onclick="createNewStock()">Создать</button></td>
                    </tr>
                </table>
                <table class="table_block">
                    <tr>
                        <td><input id="create_group" type="text" style="width: 240px; margin-right: 15px;" placeholder="Группа товаров"></td>
                        <td><button class="btn btn-main" onclick="createNewGroup()">Создать</button></td>
                    </tr>
                </table>
            </div>
            <div class="next">
                <button class="btn btn-main" id="item_new" onclick="createNewItem()">Добавить товар</button>
            </div>
        `},status:p[1]}];for(let t=0;t<_.length;t++)if(_[t].id.includes(p[0])){if(infoElement=_[t],"add"==p[1])break;if("new"!==p[1]){let e=dataName[t].link[1][1];if("stock"===p[0]){for(let i=0;i<e.length;i++)for(let t=0;t<e[i].items.length;t++)if(e[i].items[t].Item_id==p[1]){m=e[i].items[t],m.stock_address=e[i].stock_address;break}}else if("account"===p[0])for(let i=0;i<e.length;i++)e[i].account.id==p[1]&&(m=e[i]);else if("delivery"===p[0])for(let i=0;i<e.length;i++)e[i].delivery.id==p[1]&&(m=e[i].delivery);else for(let i=0;i<e.length;i++)e[i].id==_[t].status&&(m=e[i]);let i=Object.keys(m);for(let e=0;e<i.length;e++)(null==m[i[e]]||"null"==m[i[e]])&&(m[i[e]]="");let d=new Date;_[t].list.unshift(`Код: ${m.id||m.Item_id||m.account.id}`),"client"===p[0]&&(_[t].list.push(""==m.UTC?"\u041C\u0435\u0441\u0442\u043D\u043E\u0435 \u0432\u0440\u0435\u043C\u044F \u043D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u043E":`Местное время: ${m.UTC+d.getUTCHours()}:${d.getMinutes()}`),_[t].list.push(`<span id="${p[0]}_site">${m.Site}</span>`),_[t].list.push(`<span id="${p[0]}_holding">${m.Holding}</span>`)),"provider"===p[0]&&(_[t].list.push(""==m.UTC?"\u041C\u0435\u0441\u0442\u043D\u043E\u0435 \u0432\u0440\u0435\u043C\u044F \u043D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u043E":`Местное время: ${m.UTC+d.getUTCHours()}:${d.getMinutes()}`),_[t].list.push(`<span id="${p[0]}_holding">${m.Holding}</span>`)),"account"===p[0]&&(_[t].list.push(""==m.UTC?"\u041C\u0435\u0441\u0442\u043D\u043E\u0435 \u0432\u0440\u0435\u043C\u044F \u043D\u0435\u043E\u043F\u0440\u0435\u0434\u0435\u043B\u0435\u043D\u043D\u043E":`Местное время: ${m.UTC+d.getUTCHours()}:${d.getMinutes()}`),_[t].list.push(`Счета от ${m.items[0].Prefix}`))}else{const d=[{id:"client",list:["Name","Rayon","Category","Distance","Segment","UHH","Price","Oblast","Station","Tag","Adress","Site","Holding","Demand_item","Demand_volume","Livestock_all","Livestock_milking","Livestock_milkyield","Bik","kc","rc"]},{id:"provider",list:["Name","Rayon","Category","Distance","UHH","Price","Oblast","Train","Tag","Adress","NDS","Merc","Volume","Holding"]},{id:"carrier",list:["Name","Address","Area","Capacity","UHH","Region","View","Bik","kc","rc"]},{id:"delivery",list:["Customer","Start_date","Postponement_date","End_date","Load_type","Type","Comment","Client","Contact_Number","Account_id","Stock","Item_ids","Payment_list","Auto","Passport_data"]}];void 0===dataName[t].link[1][1]&&getTableData(dataName[t].link,!1,!0),_[t].list.unshift(`Код: 0`);for(let e=0;e<d.length;e++)if(p[0]==d[e].id)for(let i=0;i<d[e].list.length;i++)m[d[e].list[i]]="";if("client"===p[0]&&(_[t].list.push(`<input id="${p[0]}_site" placeholder="Сайт"  value="${m.Site}">`),_[t].list.push(`<input type="text" placeholder="Холдинг" id="${p[0]}_holding" value="${m.Holding}">`)),"provider"===p[0]&&_[t].list.push(`<input type="text" placeholder="Холдинг" id="${p[0]}_holding" value="${m.Holding}">`),"delivery"===p[0]&&void 0!==e.name){let i=e.name.split("_")[1];m.Account_id=categoryInFinanceAccount[1][1][i-1].account.id}}}for(let d=0;d<dataName.length;d++)if(p[0]==dataName[d].name){"stock"!==p[0]&&(saveTableAndCard=dataName[d].link,dataName[d].link[0].lastCard[0]=t());break}for(let t=0;t<linkCategoryInfo.length;t++)if(linkCategoryInfo[t].subid.includes(saveTableAndCard[0].id)){$(`#${linkCategoryInfo[t].id}`).addClass("active"),"new"==infoElement.status&&($("div").is("#subcategories")?$("#subcategories").remove():"",addButtonsSubcategory(linkCategoryInfo[t].id[linkCategoryInfo[t].id.length-1]),$(`#${saveTableAndCard[0].id}Button`).addClass("active"),linkField());break}if($(".info").append(t()),$(".next .btn, #add_new_comment").attr("name",p.join("_")),"client"!==p[0]&&itemSelection(p[0],m),"stock"===p[0]&&(categoryInStock[0].lastCard[0]=null),"client"==p[0]||"provider"==p[0]||"carrier"==p[0])n();else if("delivery"==p[0]){let e=m.Payment_list;if(0==e.length)addRow(`delivery-group`);else{e=JSON.parse(m.Payment_list);for(let t=0;t<e.length;t++)addRow(`delivery-group`,e[t])}}else if("account"==p[0]){let e=null==m.account.Payment_history?[{position:"",date:"",sum:""}]:JSON.parse(m.account.Payment_history);for(let t=0;t<e.length;t++)addRow("account-group",e[t])}if("stock"===p[0])$(".info").prepend($("<div>",{class:"overflow"})),$(".overflow").height($(".container")[0].scrollHeight),$("#card_menu").addClass("modal");else try{""!==$("#group").html().trim()&&$("#remove_last_row").fadeIn(0)}catch{}}function getListAreas(e,t=""){let d,n=e.value;try{d=e.id.split("_")[0]}catch{}$.ajax({url:"static/js/regions/regions.json",async:!1,success:function(e){let a="<option value=\"\">\u041D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D</option>";for(let d=0;d<e.length;d++)if(e[d].region==n)for(let i=0;i<e[d].areas.length;i++)a+=e[d].areas[i]==t?`<option selected value="${e[d].areas[i]}">${e[d].areas[i]}</option>`:`<option value="${e[d].areas[i]}">${e[d].areas[i]}</option>`;$(`#${d}_area`).empty(),$(`#${d}_area`).append(a),saveCard()}})}function createDocument(e){let t=$(e).attr("name").split("_");t[1].includes("new")&&(t[1]=t[1].replace(/new/g,saveTableAndCard[1][1].length+1));let d=["carrier",+$("#delivery_carrier_id").val()],n=$("#delivery_customer").val();return null==$("#delivery_carrier_id").val()?alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043F\u0435\u0440\u0435\u0432\u043E\u0437\u0447\u0438\u043A\u0430!"):void $.ajax({url:"/getCarriers",type:"GET",dataType:"html",success:function(e){e=JSON.parse(e);for(let a=0;a<e.length;a++)if(e[a].id==d[1]){let i="\u041E\u041E\u041E"==n?"ZayavkaOOO":"ZayavkaIP";const s=document.createElement("a");s.href=`/downloadDoc?category=${d[0]}&name=${i}&card_id=${d[1]}&address=${e[a].Address}&delivery=${t[1]}`,s.download="\u041E\u041E\u041E"==n?"\u0417\u0430\u044F\u0432\u043A\u0430 \u041E\u041E\u041E.docx":"\u0417\u0430\u044F\u0432\u043A\u0430 \u0418\u041F.docx",s.click()}}})}function makeRequest(e){let i=categoryInFinanceAccount[1][1][+$("#delivery_account")[0].value-1],t={};for(let d=0;d<idCardFields[3].ids.length;d++)t[idCardFields[3].ids[d]]=$(`#${idCardFields[3].ids[d]}`).val();if(t.delivery_carrier_id=+$("#delivery_carrier_id").val(),null==i){var d=confirm("\u041F\u0440\u0438 \u0437\u0430\u043A\u0440\u044B\u0442\u0438\u0438 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0434\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0442\u0441\u044F, \u0442.\u043A \u0432\u044B \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043B\u0438 \u0441\u0447\u0435\u0442!");return d?closeCardMenu(e.id):void 0}if(0==t.delivery_carrier_id){var d=confirm("\u041F\u0440\u0438 \u0437\u0430\u043A\u0440\u044B\u0442\u0438\u0438 \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0438 \u0434\u0430\u043D\u043D\u044B\u0435 \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0442\u0441\u044F, \u0442.\u043A \u0432\u044B \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043B\u0438 \u043F\u0435\u0440\u0435\u0432\u043E\u0437\u0447\u0438\u043A\u0430!");return d?closeCardMenu(e.id):void 0}let n=null==e.name?e.id.split("_"):e.name.split("_");t.delivery_id="new"==n[n.length-1]?"new":+n[n.length-1],t.delivery_date=getCurrentDate("year"),t.delivery_contact_end=+$("#delivery_contact_name").val(),t.delivery_contact_number="",t.delivery_contact_name=$("#delivery_driver").val(),t.delivery_account_id=+$("#delivery_account")[0].value,t.delivery_client=$("#delivery_client")[0].value,t.delivery_car=$("#delivery_car").val(),t.delivery_passport=$("#delivery_passport").val(),t.delivery_postponement_date=$("#delivery_postponement_date").val();let a=[];for(let i of $("#flight #item_sum"))a.push(i.value);t.delivery_amounts=JSON.stringify(a);let s=[];for(let i of $("#group #delivery_date"))""==$(i).val()?s.push({date:"",price:""}):(s.push({date:$(i).val(),price:""}),t.delivery_payment_date=$(i).val());for(let t=0;t<$("#group #delivery_price").length;t++)""==$("#group #delivery_price")[t].value?""==$("#group #delivery_price")[t].value&&""==$("#group #delivery_date")[t].value&&s.splice(t,1):s[t].price=$("#group #delivery_price")[t].value;0<s.length?t.payment_list=JSON.stringify(s):t.delivery_payment_date="",t.delivery_prefix=i.items[0].Prefix,t.delivery_price=i.account.Sum,t.delivery_vat=i.items[0].NDS,t.delivery_name=i.account.Name;let l=[];for(let i of $("#flight [name=\"item_flight\"]"))l.push($(i).attr("id").split("_")[2]);t.delivery_item_ids=JSON.stringify(l),$.ajax({url:"/addDelivery",type:"GET",data:t,dataType:"html",success:function(){list_items_acc=null,list_stock_acc=null,closeCardMenu(e.id)}})}function transferToAccounts(e){$.ajax({url:"/getAccounts",type:"GET",dataType:"html",success:function(i){categoryInFinanceAccount[1][1]==null&&categoryInFinanceAccount[1].push(JSON.parse(i)),createCardMenu(e),categoryInFinanceAccount[0].lastCard[0]=$(".card_menu"),categoryInFinanceAccount[0].active=!0,categoryInFinanceDebit[0].active=!1,linkCategory("category-1"),linkField()}})}function transitProduct(e){let t;$.ajax({url:"/getAllItems",type:"GET",dataType:"html",success:function(i){t=JSON.parse(i);let d=e.name.split("_")[1],n=$("#stock_select").val(),a=$("#volume_transit").val();if(null==n)return alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043A\u043B\u0430\u0434!");if(1!=Math.sign(a))return alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043F\u043E\u043B\u043E\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u0447\u0438\u0441\u043B\u043E!");for(let e=0;e<t.length;e++)if(t[e].Item_id==d&&+t[e].Volume<+a)return alert("\u041D\u0430 \u0441\u043A\u043B\u0430\u0434\u0435 \u043D\u0435\u0442 \u0442\u0430\u043A\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043C\u0430 \u044D\u0442\u043E\u0433\u043E \u043F\u0440\u043E\u0434\u0443\u043A\u0442\u0430!");$.ajax({url:"/stockTransit",type:"GET",data:{stock_select:n,id_product:+d,product_volume:+a},dataType:"html",success:function(){closeCardMenu("stock_new")}})}})}function selectAccount(e){let t,d,n=categoryInFinanceAccount[1][1],a=categoryInListClient[1][1];for(let d=0;d<n.length;d++)if(n[d].account.id==+e){$("#delivery_client").empty(),$("#delivery_client").append(`<option>${n[d].account.Name}</option>`),t=n[d].account.Name;break}for(let n=0;n<a.length;n++)a[n].Name==t&&(d={id:a[n].id,category:"client"});let s="";if($.ajax({url:"/getContacts",type:"GET",async:!1,data:d,dataType:"html",success:function(e){d=JSON.parse(e)}}),0==d.length)s+="<option selected disabled>\u041A\u043E\u043D\u0442\u0430\u043A\u0442\u044B \u043D\u0435 \u0443\u043A\u0430\u0437\u0430\u043D\u044B</option>";else for(let e=0;e<d.length;e++)s+=`<option value="${d[e].Contact_id}">${d[e].Position} | ${d[e].Name} | ${d[e].Number}</option>`;$("#delivery_contact_name").empty(),$("#delivery_contact_name").append(s);for(let t=0;t<n.length;t++)if(n[t].account.id==+e){let e=[];for(let i=0;i<n[t].items.length;i++)e.push(n[t].items[i].Stock_id);for(let i=0;i<e.length-1;i++)for(let t=i+1;t<e.length;t++)e[i]==e[t]&&(e.splice(t,1),t--);let i,d="";$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(e){i=JSON.parse(e)}});for(let t=0;t<i.length;t++)for(let n=0;n<e.length;n++)i[t].id==e[n]&&(d+=`<option value="${i[t].Name}">${i[t].Name}</option>`);$("#delivery_stock").empty(),$("#delivery_stock").append(d);break}}function createNewItem(){let e=["stock_id","group_id","item_product","item_prefix","item_volume","item_packing","item_weight","item_vat","item_price","item_purchase_price"],t={};for(let d=0;d<e.length;d++)t[e[d]]=$(`#${e[d]}`).val();t.item_fraction="test",t.item_creator="test",$.ajax({url:"/addItemToStock",type:"GET",data:t,dataType:"html",success:function(){closeCardMenu("stock_new")}})}function createNewStock(){let e={};""==$("#create_stock").val()||(e.stock_name=$("#create_stock").val(),$.ajax({url:"/addStock",type:"GET",data:e,dataType:"html",success:function(){getTableData(categoryInStock)}}))}function createNewGroup(){let e={};""==$("#create_group").val()||(e.group_name=$("#create_group").val(),$.ajax({url:"/addItemGroup",type:"GET",data:e,dataType:"html",success:function(){getTableData(categoryInStock)}}))}function selectDrivers(e,t={Contact_Name:""}){$.ajax({url:"/getContacts",type:"GET",data:{category:"carrier",id:e},dataType:"html",success:function(e){$("#delivery_driver").empty(),$("#delivery_driver").append(`<option value="Не выбран" selected disabled>Не выбран</option>`),e=JSON.parse(e);let d=categoryInListCarrier[1][1];for(let t=0;t<d.length;t++)for(let i=0;i<e.length;i++)if(d[t].id===e[i].Carrier_id){$("#delivery_type option").html(d[t].View);break}for(let d=0;d<e.length;d++)""!=t.Contact_Name&&t.Contact_Name==e[d].Position?$("#delivery_driver").append(`<option value="${e[d].Position}" selected>${e[d].Position} | ${e[d].Last_name}</option>`):$("#delivery_driver").append(`<option value="${e[d].Position}">${e[d].Position} | ${e[d].Last_name}</option>`)}})}function reloadStockItems(e){list_items_acc=null,list_stock_acc=null,createDelCardMenu(e)}function createDelCardMenu(e){$.ajax({url:"/getCarriers",type:"GET",dataType:"html",success:function(i){i=JSON.parse(i),categoryInListCarrier[1][1]===void 0&&categoryInListCarrier[1].push(i),createCardMenu(e)}})}function comeBack(e){for(let t=0;t<dataName.length;t++)if(dataName[t].name===e){$(".card_menu").remove();for(let e=dataName[t].link[0].lastCard.length-1;0<=e;e--)if(null!==dataName[t].link[0].lastCard[e]){dataName[t].link[0].lastCard[e]=null;break}if($(".info").append(fillingTables(dataName[t].link)),$(".m_comment").is("#comment_content")){$("#comment_content").remove();let e=$(".close").attr("id").split("_"),i=[e[0],e[3]];getCommentsInfo.getRequest(i)}break}else if(dataName[t].name+"-inv"===e){for(let t=0;t<linkCategoryInfo[0].subcategories.length;t++)linkCategoryInfo[0].subcategories[t][0].active=!1,linkCategoryInfo[0].subcategories[t][0].id==e.replace(/-inv/g,"")&&(linkCategoryInfo[0].subcategories[t][0].active=!0);categoryInFinanceAccount[0].lastCard[0]=null,$(".card_menu").remove(),linkCategory("category-0");break}}function contractNext(e){checkEmail()&&(saveInfoCard(e.name,!0,e,"check"),getCommentsInfo.getRequest(e.name),saveCard())}function invoiceCard(e){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(i){function t(i){return $("<div>",{class:"card_menu invoicing",id:`${e.id}_invoicing_card`,append:$("<div>",{class:"content",append:invoicingContentCard(e,i)})})}i=JSON.parse(i),categoryInStock[1][1]==null&&categoryInStock[1].push(i),$(".card_menu").remove(),categoryInFinanceAccount[0].lastCard[0]=t(i),categoryInFinanceAccount[0].active=!0,categoryInFinanceDebit[0].active=!1,linkCategory("category-1"),linkField()}})}function completionCard(e){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(t){t=JSON.parse(t);let d=[];for(let e of $("#exposed_list .invoiled")){let n=$(e).attr("id").split("_")[1];for(let e=0;e<t.length;e++)for(let i,a=0;a<t[e].items.length;a++)i=t[e].items[a],i.Item_id==n&&d.push({id:+n,volume:$(`#invoiled_volume_${n}`).val()})}if(0<d.length){let i=[],t=[],n=[],a=[];for(let e of $("#exposed_list .invoiled")){let d=$(e).attr("id").split("_")[1];i.push($(e).children()[7].children[0].value),t.push($(e).children()[8].innerHTML),n.push($(e).children()[9].innerHTML),a.push({id:+d,amount:$(e).children()[11].innerHTML})}let s,l=getCurrentDate("year"),r=$("#total").html();for(let t=0;t<dataName.length;t++)e.name===dataName[t].name&&(s=dataName[t].link[0].lastCard[0].children()[1].children[0].children[0].children[0].children[1].children[0].value,dataName[t].link[0].lastCard=[null,null]);$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(e){let c=JSON.parse(e);$.ajax({url:"/addAccount",type:"GET",data:{manager_id:c.id,name:s,status:"false",date:l,hello:JSON.stringify(t),sale:JSON.stringify(i),shipping:JSON.stringify(n),items_amount:JSON.stringify(a),sum:r,item_ids:JSON.stringify(d)},dataType:"html",success:function(){closeCardMenu("account_new")}})}})}else if(0==d.length)return void alert("\u041D\u0435\u0432\u043E\u0437\u043C\u043E\u0436\u043D\u043E \u0441\u043E\u0437\u0434\u0430\u0442\u044C \u0441\u0447\u0435\u0442, \u043D\u0438 \u043E\u0434\u0438\u043D \u0442\u043E\u0432\u0430\u0440 \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D!")}})}function closeCardMenu(e=""){if("user"==e[1])return void getTableData(saveTableAndCard);if(!e.includes("stock")&&!e.includes("delivery")&&!e.includes("item")){saveInfoCard(e);let i=e.split("_"),t=`${i[0]}_${i[i.length-1]}`;e.includes("account")||getCommentsInfo.getRequest(t)}else getTableData(saveTableAndCard);null!==categoryInFinanceAccount[0].lastCard[0]&&e.split("_")[0]===categoryInFinanceAccount[0].lastCard[0][0].id.split("_")[0]&&(categoryInFinanceAccount[0].lastCard[0]=null)}function closeModalMenu(){$(".modal_search").remove(),$(".overflow").remove(),$(".search #search").val("")}function getTitleInfo(e,t){let d=$("<div>",{class:"title"}),n=$("<div>",{class:"left_side"});d.append(n);for(let d=0;d<e.list.length;d++)n.append($("<span>",{html:e.list[d]}));return d.append(function(){function i(){return $("<div>",{class:"close",id:`${e.id}_close_card_${e.status}`,onclick:"delivery"===e.id?"makeRequest(this)":"closeCardMenu(this.id)",append:$("<img>",{src:"static/images/cancel.png"})})}function d(){let d;if($.ajax({url:"/getUsers",type:"GET",async:!1,dataType:"html",success:function(e){d=JSON.parse(e)}}),!t.Manager_active){function i(){let t=$("<ul>",{class:"list"});for(let n=0;n<d.length;n++)"manager"==d[n].role&&t.append($("<li>",{html:d[n].second_name,id:d[n].id,card:`${e.id}_${e.status}`,onclick:"selectManagerInCard(this)"}));return t}return $("<div>",{class:"gray",id:"user",append:$("<div>",{class:"drop_menu none",id:`${e.id}-user-${e.status}`,html:i()}).add($("<div>",{onclick:"unfastenCard(this)",class:"hover",id:`remove-${e.id}-${e.status}`,append:$("<img>",{src:"static/images/dropmenu_black.svg",class:"drop_down_img padl"}).add($("<span>",{html:"\u041F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0443 \u043A \u043C\u0435\u043D\u0435\u0434\u0436\u0435\u0440\u0443",class:"marl"}))}))})}else{let n;for(let e=0;e<d.length;e++)if(+d[e].id==+t.Manager_id){n=convertName(`${d[e].name} ${d[e].second_name}`),username=n;break}return $("<div>",{class:"gray",id:"user",append:$("<div>",{class:"drop_menu",id:`${e.id}_${e.status}`,html:"\u041E\u0442\u043A\u0440\u0435\u043F\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u043E\u0447\u043A\u0443 \u043E\u0442 \u043C\u0435\u043D\u0435\u0434\u0436\u0435\u0440\u0430",onclick:"detachmentCard(this)"}).add($("<div>",{onclick:"unfastenCard(this)",class:"hover",id:`remove-${e.id}-${e.status}`,append:$("<img>",{src:"static/images/dropmenu_black.svg",class:"drop_down_img padl"}).add($("<span>",{html:n,class:"marl"}))}))})}}if("client"===e.id||"provider"===e.id){let t=$("<div>",{class:"right_side"});return e.status.includes("contract")||e.status.includes("new")||t.append(d()),t.append(i()),t}return $("<div>",{class:"right_side",append:i()})}()),d}