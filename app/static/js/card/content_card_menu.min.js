function analyticsContent(){return`<table class="table analytics"><tr><th>Товар</th><th>Клиент</th><th>Объем</th><th>Цена</th><th>Доставка</th><th>Привет</th><th>Себестоимость</th><th>Купили</th><th>Заработали</th><th>Прибыль</th></tr><tr><td rowspan="2">Жмых</td><td>Лютик</td><td>7904</td><td>109</td><td>2</td><td>6</td><td>101</td><td>80</td><td>21</td><td>166000</td></tr><tr><td>Ромашка</td><td>7904</td><td>89</td><td>3</td><td>8</td><td>104</td><td>65</td><td>43</td><td>122300</td></tr></table><table class="table analytics"><tr><th>Товар</th><th>Клиент</th><th>Объем</th><th>Цена</th><th>Доставка</th><th>Привет</th><th>Себестоимость</th><th>Купили</th><th>Заработали</th><th>Прибыль</th></tr><tr><td rowspan="2">Барда</td><td>Лютик</td><td>7904</td><td>109</td><td>2</td><td>6</td><td>101</td><td>80</td><td>21</td><td>166000</td></tr><tr><td>Ромашка</td><td>7904</td><td>89</td><td>3</td><td>8</td><td>104</td><td>65</td><td>43</td><td>122300</td></tr></table`}let list_items_acc,list_stock_acc;function checkStocks(a){let b=a.name.split("_")[1],c=[];for(let b of $("#group tr")){let a=$(b)[0].children[0].children[0].value,d=$(b)[0].children[1].children[0].value;c.push({date:a,sum:d})}0==c.length&&c.push({date:"",sum:""}),$.ajax({url:"/addAccountPaymentHistory",data:{account_id:+b,account_payment_history:JSON.stringify(c)},type:"GET",dataType:"html",success:function(){function b(){let b="";for(let d=0;d<c.length;d++)for(let f=0;f<e.length;f++)if(c[d].id==e[f].stock){b+=`<button class="selectStock" name="${a.name}" id="${a.id}" onclick="arrangeDelivery(this)" data-items="${e[f].items}" data-stock="${c[d].Name}">${c[d].Name}</button>`;break}return b}list_stock_acc=$("#stock_items_list").attr("data-stock").split(","),list_items_acc=$("#stock_items_list").attr("data-items").split(",");let c,d,e=[];$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(a){c=JSON.parse(a)}}),$.ajax({url:"/getAllItems",type:"GET",async:!1,dataType:"html",success:function(a){d=JSON.parse(a)}});for(let a=0;a<c.length;a++)for(let b=0;b<list_stock_acc.length;b++)list_stock_acc[b]==c[a].id&&e.push({stock:c[a].id,items:[]});for(let a=0;a<e.length;a++)for(let b=0;b<d.length;b++)e[a].stock==d[b].Stock_id&&e[a].items.push(d[b].Item_id);if(1<list_stock_acc.length)$(".page").prepend($("<div>",{class:"background"})),$(".page").prepend($("<div>",{class:"modal_select",append:`<div class="title"><span>Выбор склада</span><img onclick="closeModal()" src="static/images/cancel.png"></div><div class="content"><div class="message"><p>В счёте присутствуют несколько складов. <br> Выберите склад, чтобы создать доставку товаров выбранного склада <br>(Доставка будет только на те товары, которые находятся в выбранном складе)</p></div><div class="list_stock">${b()}</div></div>`}));else{for(let a=0;a<c.length;a++)for(let b=0;b<list_stock_acc.length;b++)c[a].id==list_stock_acc[b]&&(list_stock_acc[b]=c[a].Name);$(a).attr("data-stock",list_stock_acc),$(a).attr("data-items",list_items_acc),arrangeDelivery(a)}}})}function closeModal(){$(".background").remove(),$(".modal_select").remove()}function arrangeDelivery(a){list_stock_acc=$(a).attr("data-stock"),list_items_acc=$(a).attr("data-items").split(","),closeModal(),categoryInFinanceAccount[0].lastCard[0]=null,categoryInFinanceAccount[1].pop(),$.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",success:function(a){a=JSON.parse(a),categoryInFinanceAccount[1][1]==null&&categoryInFinanceAccount[1].push(a)}}),createDelCardMenu(a)}function fillVolume(a){if(a.trim(),!(4<a.length)){let b=a.indexOf(" ");0<b&&(a=a.substring(0,b)),$("#volume_goods").html(a)}}function contractContentCard(a){return`<div class="row_card column"><table class="fit gray"><tr><td class="bold" style="padding-right: 10px;">Договор от</td><td>${getCurrentDate("currentYear")}</td></tr><tr><td class="bold">Юр. лицо</td><td><select id="select_cusmoter"><option selected value="ООО">ООО</option><option value="ИП">ИП</option></select></td></tr></table><div class="list" id="list_contract">${function(){let b,c="";$.ajax({url:"/getDocs",type:"GET",async:!1,dataType:"html",success:function(a){b=JSON.parse(a)}});let d=[{category:"client",name:"\u0414\u043E\u0433\u043E\u0432\u043E\u0440 \u043F\u043E\u0441\u0442\u0430\u0432\u043A\u0438 \u043E\u0442"},{category:"carrier",name:"\u0414\u043E\u0433\u043E\u0432\u043E\u0440 \u043E\u0431 \u043E\u043A\u0430\u0437\u0430\u043D\u0438\u0438 \u0443\u0441\u043B\u0443\u0433 \u043F\u0435\u0440\u0435\u0432\u043E\u0437\u043A\u0438 \u0433\u0440\u0443\u0437\u043E\u0432 \u043E\u0442"}];a.name.includes("new")&&(a.name=a.name.replace(/new/g,saveTableAndCard[1][1].length+1));let e=0;for(let f=0;f<b.length;f++)for(let g=0;g<d.length;g++)b[f].Owner_type==a.id&&a.id==d[g].category&&b[f].Owner_id==a.name.split("_")[1]&&(e++,c+=`<div style="background-color: #E8E8E8" class="contract flex" name="${d[g].name} ${b[f].Prefix}" id="${b[f].id}" onclick="downloadOldDocument(this)"><span style="text-align: center">${d[g].name} ${b[f].Prefix}</span></div>`);return 2>e&&(c+=`<div class="contract flex" name="${a.name}" onclick="downloadDocument(this)"><span>Новый договор</span></div>`),c}()}</div></div><div class="next">${function(){if(a.name.includes("client"))return`<button class="btn" style="margin-right: 10px" id="${a.id}" onclick="comeBack(this.id)">Назад</button> <button class="btn btn-main" id="${a.id}" onclick="invoiceCard(this)">Выставить счёт</button> `;if(a.name.includes("carrier")){let b=$(a).attr("name").split("_");return`<button class="btn" style="margin-right: 10px" id="${a.id}" onclick="comeBack(this.id)">Назад</button> <button class="btn btn-main" name="${b[0]}_close_card_${b[1]}_contract" onclick="closeCardMenu(this.name)">Закрыть</button> `}}()}</div>`}function downloadOldDocument(a){const b=document.createElement("a");b.href=`/downloadOldDoc?id=${a.id}`,b.download=$(a).attr("name")+".docx",b.click()}function downloadDocument(a){let b=$(a).attr("name").split("_"),c=$("#select_cusmoter").val();for(let b=0;b<$("#list_contract").children().length;b++)if($("#list_contract").children()[b].children[0].innerHTML.includes(c))return void alert(`Договор от ${c} уже существует!`);"client"==b[0]?$.ajax({url:"/getClients",type:"GET",dataType:"html",success:function(a){a=JSON.parse(a);for(let d=0;d<a.length;d++)if(a[d].id==b[1]){let e="\u041E\u041E\u041E"==c?"Dogovor_na_tovari_ooo":"Dogovor_na_tovari_ip";const f=document.createElement("a");f.href=`/downloadDoc?category=${b[0]}&name=${e}&card_id=${b[1]}&address=${a[d].Adress}&delivery=no`,f.download="\u041E\u041E\u041E"==c?"\u0414\u043E\u0433\u043E\u0432\u043E\u0440 \u043F\u043E\u0441\u0442\u0430\u0432\u043A\u0438 \u041E\u041E\u041E.docx":"\u0414\u043E\u0433\u043E\u0432\u043E\u0440 \u043F\u043E\u0441\u0442\u0430\u0432\u043A\u0438 \u0418\u041F.docx",f.click()}}}):"carrier"==b[0]&&$.ajax({url:"/getCarriers",type:"GET",dataType:"html",success:function(a){a=JSON.parse(a);for(let d=0;d<a.length;d++)if(a[d].id==b[1]){let e="\u041E\u041E\u041E"==c?"DogovorNaDostavkuOOO":"DogovorNaDostavkuIP";const f=document.createElement("a");f.href=`/downloadDoc?category=${b[0]}&name=${e}&card_id=${b[1]}&address=${a[d].Address}&delivery=no`,f.download="\u041E\u041E\u041E"==c?"\u0414\u043E\u0433\u043E\u0432\u043E\u0440 \u043D\u0430 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0443 \u041E\u041E\u041E.docx":"\u0414\u043E\u0433\u043E\u0432\u043E\u0440 \u043D\u0430 \u0434\u043E\u0441\u0442\u0430\u0432\u043A\u0443 \u0418\u041F.docx",f.click()}}})}function invoicingContentCard(a,b){function c(a,b,c){let d=$("<div>",{class:"row_card",append:$("<div>",{class:"info_block full "+c,append:$("<table>",{class:"account_table",id:b,html:a[0](),append:a[1]()})})});return d}return function(){let a=$("<div>",{class:"row_card",append:$("<div>",{class:"costs gray",html:` <div class="costs_element"><span>Всего затраты</span><input type="number" onkeyup="all_costs()"  id="total_costs_inv" class="total_count red bold mrl"><div name="unlock" class="lock_input" id="mode_costs" onclick="switchMode(this)"></div></div> <div class="costs_element"><span>Скидка</span> <input type="number" onkeyup="calculationIndicators()" value="" onblur="dataСalculation(this)" id="total_discount_inv" class="total_count bold mrl"><div name="unlock" class="lock_input" id="mode_discount" onclick="switchMode(this)"></div></div><div class="costs_element"><span>Привет</span> <input type="number" onkeyup="calculationIndicators()" value="" onblur="dataСalculation(this)" id="total_privet_inv" class="total_count bold mrl"><div name="unlock" class="lock_input" id="mode_privet" onclick="switchMode(this)"></div></div><div class="costs_element"><span>Доставка</span> <input type="number" onkeyup="calculationIndicators()" value="" onblur="dataСalculation(this)" id="total_delivery_inv" class="total_count bold mrl"><div name="unlock" class="lock_input" id="mode_delivery" onclick="switchMode(this)"></div></div>`})});return a}().add(c([function(){return`<tr><th width="15" rowspan="2"></th><th width="150" rowspan="2">Товар</th><th colspan="2">Фасовка</th><th colspan="2">Количество</th><th colspan="5">Цена</th><th style="width: 90px;" rowspan="2">Сумма</th></tr><tr><th>Тара</th><th width="55">Вес</th><th width="55">В тарах</th><th width="55">Объем</th><th width="85">Цена прайса</th><th width="55">Скидка</th><th width="55">Привет</th><th width="55">Доставка</th><th width="85">За единицу</th></tr>`},function(a=""){let b=$("<tbody>",{id:"exposed_list"});for(let c,d=0;5>d;d++){c=$("<tr>",{class:"product",id:"empty"});for(let b=0;12>b;b++)c.append($("<td>",{html:a}));b.append(c)}const c=["\u041D\u0414\u0421","\u0411\u0435\u0437 \u041D\u0414\u0421","\u041E\u0431\u0449\u0430\u044F"],d=["vat","without-vat","total"];for(let e=0;3>e;e++)b=b.add($("<tr>",{prepend:$("<td>",{colspan:10,css:{border:"none"}}),append:$("<td>",{colspan:2,class:"fz10",append:$("<div>",{class:"flex jc-sb",prepend:$("<span>",{class:"gray",html:c[e]}),append:$("<span>",{id:d[e]})})})}));return b}],"input_table")).add(c([function(){return`<tr><th>Группа товаров</th><th>Товар</th><th>Юр. лицо</th><th>Объем</th><th>Фасовка</th><th>НДС</th><th>Цена прайса</th><th>Склад</th></tr>`},function(){let a=$("<tbody>",{id:"filter_list"});for(let c=0;c<b.length;c++)if(null!==b[c].stock_address)for(let d,e=0;e<b[c].items.length;e++){d=$("<tr>",{onclick:"invoiceInTable(this)",id:`invoice_${b[c].items[e].Item_id}`});const f=[b[c].items[e].Group_name,b[c].items[e].Name,b[c].items[e].Prefix,b[c].items[e].Volume,b[c].items[e].Packing,b[c].items[e].NDS,b[c].items[e].Cost,b[c].stock_address];for(let a=0;a<f.length;a++)d.append($("<td>",{html:f[a]}));a.append(d)}return a}],"output_table","hmax")).add(function(){let b=$("<div>",{class:"next",prepend:$("<button>",{class:"btn",id:a.id+"-inv",onclick:"comeBack(this.id)",html:"\u041D\u0430\u0437\u0430\u0434"}),append:$("<button>",{class:"btn btn-main",id:"account",name:a.id,onclick:"completionCard(this)",html:"\u0412\u044B\u0441\u0442\u0430\u0432\u0438\u0442\u044C"})});return b}())}function invoiceInTable(a){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(b){b=JSON.parse(b);let c=null,d=$("#exposed_list .invoiled").attr("id");if(d!=null){d=d.split("_")[1];for(let a=0;a<b.length;a++)for(let e,f=0;f<b[a].items.length;f++)e=b[a].items[f],e.Item_id==d&&(c=e.Prefix)}else for(let d=0;d<b.length;d++)for(let e,f=0;f<b[d].items.length;f++)e=b[d].items[f],e.Item_id==a.id.split("_")[1]&&(c=e.Prefix);let e=$("<tr>",{class:"product invoiled",id:`invoiled_${a.id.split("_")[1]}_product`});for(let d=0;d<b.length;d++)for(let f,g=0;g<b[d].items.length;g++)if(f=b[d].items[g],f.Prefix==c&&f.Item_id==a.id.split("_")[1]){e.append($("<td>",{id:`invoiled_${a.id.split("_")[1]}`,onclick:"returnBack(this)",append:$("<img>",{src:"../static/images/returnBack.png",width:12})}));let b=a.id.split("_")[1],c=[{id:``,html:f.Name},{id:``,html:f.Packing},{id:`product_weight_${b}`,html:f.Weight},{id:`product_containers_${b}`,html:""},{id:`invoiled_volume_${b}`,html:""},{id:`product_cost_${b}`,html:f.Cost},{id:`calcSale_${b}`,html:""},{id:`calcPrivet_${b}`,html:""},{id:`calcDelivery_${b}`,html:""},{id:`product_unit_${b}`,html:""},{id:`calcSum_${b}`,html:""}];for(let a=0;a<c.length;a++)c[a].id.includes("invoiled_volume")?e.append($("<td>",{append:$("<input>",{type:"number",onkeyup:"tarCalculation(this.id)",id:c[a].id,max:f.Volume})})):c[a].id.includes("calcSale")?e.append($("<td>",{append:$("<input>",{type:"number",id:c[a].id,onkeyup:"recountPrice(this.id)"})})):e.append($("<td>",{id:c[a].id,html:c[a].html}));$(`#${a.id}`).remove(),$(`#empty`).last().remove(),$("#exposed_list").prepend(e);let d=0;$("#exposed_list .invoiled #amount_product").each(function(a,b){d+=+$(b).html()}),f.NDS=f.NDS[0]+f.NDS[1];let g=0<d?d-d*+f.NDS/100:0;$("#total").html(Math.round(d)),$("#vat").html(Math.round(d-g)),$("#without-vat").html(Math.round(g));break}calculationIndicators()}})}function dataСalculation(a){for(let b=0;b<list_inv.length;b++)list_inv[b].id==a.id&&(list_inv[b].value=$(a).val());let b=$("#total_costs_inv").val(),c=Math.abs($("#total_discount_inv").val()),d=$("#total_privet_inv").val(),e=$("#total_delivery_inv").val();$("#total_costs_inv").val(+c+ +d+ +e);let f=$("#total_costs_inv").val(),g=0;for(let b of $("#exposed_list .invoiled"))g++;for(let b of $("#exposed_list .invoiled"))$(b).children()[11].innerHTML=+$(b).children()[5].children[0].value*+$(b).children()[6].innerHTML+Math.ceil(f/g);calculationIndicators()}let currentVatValue=0;function calculationIndicators(){let a=[{id:"total_discount_inv",tr:"calcSale"},{id:"total_privet_inv",tr:"calcPrivet"},{id:"total_delivery_inv",tr:"calcDelivery"}],b=0;$("#exposed_list .invoiled").each(function(){b++});for(let c,d=0;d<a.length;d++){c=categoryInStock[1][1];for(let a=0;a<c.length;a++)for(let d=0;d<c[a].items.length;d++)$("#exposed_list .invoiled").each(function(e,f){if($(f).attr("id").split("_")[1]==c[a].items[d].Item_id){let e=Math.abs((+$("#total_discount_inv").val()/$(`#invoiled_volume_${c[a].items[d].Item_id}`).val()/b).toFixed(2)),f=(+$("#total_privet_inv").val()/$(`#invoiled_volume_${c[a].items[d].Item_id}`).val()/b).toFixed(2),g=(+$("#total_delivery_inv").val()/$(`#invoiled_volume_${c[a].items[d].Item_id}`).val()/b).toFixed(2);$(`#calcSale_${c[a].items[d].Item_id}`).val(isNaN(e)||e==1/0||e==-Infinity?"":-e),$(`#calcPrivet_${c[a].items[d].Item_id}`).html(isNaN(f)||f==1/0||f==-Infinity?"":f),$(`#calcDelivery_${c[a].items[d].Item_id}`).html(isNaN(g)||g==1/0||g==-Infinity?"":g);let h=(+$(`#calcDelivery_${c[a].items[d].Item_id}`).html()+ +$(`#calcPrivet_${c[a].items[d].Item_id}`).html()+ +$(`#calcSale_${c[a].items[d].Item_id}`).val())*+$(`#invoiled_volume_${c[a].items[d].Item_id}`).val(),i=Math.round(+$(`#product_cost_${c[a].items[d].Item_id}`).html()*+$(`#invoiled_volume_${c[a].items[d].Item_id}`).val()).toFixed(2);$(`#calcSum_${c[a].items[d].Item_id}`).html(+i+h);let j=0;for(let a of $("#exposed_list .invoiled"))j+=+$(a).children()[11].innerHTML;c[a].items[d].NDS=c[a].items[d].NDS[0]+c[a].items[d].NDS[1];let k=0<j?j-j*+c[a].items[d].NDS/100:0;currentVatValue=+c[a].items[d].NDS,$("#total").html(Math.round(j)),$("#vat").html(Math.round(j-k)),$("#without-vat").html(Math.round(k))}})}}function tarCalculation(a){let b=a.split("_")[2],c=+$(`#${a}`).val(),d=+$(`#product_weight_${b}`).html(),e=Math.round(+$(`#product_cost_${b}`).html()/c).toFixed(2);$(`#product_containers_${b}`).html(Math.floor(c/d)),$(`#product_unit_${b}`).html(e==1/0||isNaN(e)?"0":e),calculationIndicators()}function recountPrice(a){let b=a.split("_")[1],c=$(`#exposed_list #invoiled_${b}_product`);c.children().last().html(+c.children()[5].children[0].value*+c.children()[6].innerHTML+(+c.children()[7].children[0].value*+c.children()[5].children[0].value+ +c.children()[8].innerHTML*+c.children()[5].children[0].value+ +c.children()[9].innerHTML*+c.children()[5].children[0].value));let d=0;$("#exposed_list .invoiled").each(function(a,b){d+=+$(b).children()[11].innerHTML}),$("#total").html(Math.round(d));let e=0<d?d-d*currentVatValue/100:0;$("#total").html(Math.round(d)),$("#vat").html(Math.round(d-e)),$("#without-vat").html(Math.round(e))}function all_costs(){let a=3,b=0;for(let c=0;c<list_inv.length;c++)list_inv[c].disable&&(a--,b+=+$(`#${list_inv[c].id}`).val());let c=$("#total_costs_inv").val()-b;if("string"!=typeof c){let b=Math.round(c/a);for(let a=0;a<list_inv.length;a++)list_inv[a].disable||$(`#${list_inv[a].id}`).val(b);for(let a of $("#exposed_list .invoiled"))$(a).children()[11].innerHTML=+$(a).children()[5].children[0].value*+$(a).children()[6].innerHTML+(+$(a).children()[7].children[0].value*+$(a).children()[5].children[0].value+ +$(a).children()[8].innerHTML*+$(a).children()[5].children[0].value+ +$(a).children()[9].innerHTML*+$(a).children()[5].children[0].value);calculationIndicators()}}function returnBack(a){$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(b){b=JSON.parse(b),$(`#${a.id}_product`).remove();let c=$("<tr>",{onclick:"invoiceInTable(this)",id:a.id.replace(/invoiled_/g,"invoice_")});for(let d=0;d<b.length;d++)for(let e,f=0;f<b[d].items.length;f++)if(e=b[d].items[f],e.Item_id==a.id.split("_")[1]){let a=[e.Group_name,e.Name,e.Prefix,e.Volume,e.Packing,e.NDS,e.Cost,b[d].stock_address];for(let b=0;b<a.length;b++)c.append($("<td>",{html:a[b]}));let f=0;$("#exposed_list .invoiled").each(function(a,b){f+=+$(b).children()[11].innerHTML}),e.NDS=e.NDS[0]+e.NDS[1];let g=0<f?f-f*+e.NDS/100:0;$("#total").html(Math.round(f)),$("#vat").html(Math.round(f-g)),$("#without-vat").html(Math.round(g));break}$("#filter_list").append(c);let d=$("<tr>",{class:"product",id:"empty"});for(let a=0;12>a;a++)d.append($("<td>",{html:""}));$("#exposed_list").append(d),calculationIndicators()}})}let list_inv=[{disable:!1,id:"total_discount_inv",value:0},{disable:!1,id:"total_privet_inv",value:0},{disable:!1,id:"total_delivery_inv",value:0}];function switchMode(a){let b=$(`#${a.id.replace(/mode_/g,"total_")}_inv`);if("lock"==$(a).attr("name")){$(a).css("background-image","url(static/images/unlc.svg)"),$(a).attr("name","unlock"),b.removeAttr("disabled"),b.removeClass("disable");for(let a=0;a<list_inv.length;a++)list_inv[a].id==b[0].id&&(list_inv[a].disable=!1)}else if("unlock"==$(a).attr("name"))if($(a).css("background-image","url(static/images/lock.svg)"),$(a).attr("name","lock"),b.attr("disabled","disabled"),b.addClass("disable"),""==$("#total_costs_inv").val()){let a=0;for(let b=0;b<list_inv.length;b++)a+=+$(`#${list_inv[b].id}`).val();$("#total_costs_inv").val(a)}else{let a=0;for(let a=0;a<list_inv.length;a++)list_inv[a].id==b[0].id&&(list_inv[a].disable=!0);let c=3;for(let b=0;b<list_inv.length;b++)list_inv[b].disable&&(c--,a+=+$(`#${list_inv[b].id}`).val());let d=$("#total_costs_inv").val()-a;if("string"==typeof d)return;let e=Math.round(d/c);for(let a=0;a<list_inv.length;a++)list_inv[a].disable||$(`#${list_inv[a].id}`).val(e)}for(let b=0;b<list_inv.length;b++)list_inv[b].value=$(`#${list_inv[b].id}`).val();calculationIndicators()}function addComment(a="",b){if(""===a){$(`#messages`).empty(),$(`#comments`).empty();let a=[];$("#member .member").each(function(b,c){""!=$(c).children()[0].children[0].children[0].value&&a.push({role:$(c).children()[0].children[0].children[0].value,surname:$(c).children()[0].children[1].children[0].value})}),$("#messages").append($("<tr>",{id:"message",append:`<td><input type="text" onchange="saveCard()" value="${getCurrentDate("year")}" id="comment_date" class="m_date"></td><td><select onselect="saveCard()" id="comment_role" class="m_role"><option value="Не указано" selected disabled>Не указано</option>${function(){let b="";for(let b=0;b<a.length-1;b++)for(let c=b+1;c<a.length;c++)a[b].role===a[c].role&&a[b].surname==a[c].surname&&(a.splice(c,1),c--);for(let c=0;c<a.length;c++)b=b.concat(`<option value="${a[c].role} | ${a[c].surname}">${a[c].role} | ${a[c].surname}</option>`);return b}()}<select></td>`})),$("#comments").append($("<tr>",{id:"comment",append:`<td><textarea class="m_comment" id="comment_content" onchange="saveCard()"></textarea></td>`})),$("#comment_date").datepicker({minDate:new Date,position:"right bottom",autoClose:!0}),$("#add_new_comment").attr("onclick","getCommentsInfo.getRequest(this.name)")}else $("#messages").append($("<tr>",{id:"message",append:`<td><div type="text" id="message_date" class="m_date">${a.date}</div></td><td><div type="text" onclick="showComments(this)" id="comments_${b[0]}_${b[1]}" class="m_role static">${a.name}</div></td>`}))}function showComments(a){function b(a,b){for(let c=0;c<a.length;c++)if(b===a[c].Manager){let b={date:a[c].Date.split(" ")[0],comment:a[c].Note};$("#comments").prepend($("<tr>",{id:"comment",append:`<td width="70px">${b.date}</td><td><div class="done"><p>${b.comment}</p></div></td>`}))}}$(`#comments`).empty();let c=a.id.split("_"),d=$(a).html();$.ajax({url:"/getMessages",type:"GET",data:{category:c[1],id:c[2]},dataType:"html",success:function(a){b(JSON.parse(a),d)}})}function addMember(a="client",b=""){function c(){let a=`<option disabled selected value="Не выбрана">Должность</option>`,c=["\u0421\u043E\u0431\u0441\u0442\u0432\u0435\u043D\u043D\u0438\u043A","\u0414\u0438\u0440\u0435\u043A\u0442\u043E\u0440","\u0413\u0435\u043D\u0435\u0440\u0430\u043B\u044C\u043D\u044B\u0439 \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440","\u0417\u0430\u043C\u0435\u0441\u0442\u0438\u0442\u0435\u043B\u044C \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0430","\u041F\u0440\u0435\u0434\u0441\u0435\u0434\u0430\u0442\u0435\u043B\u044C","\u0413\u043B\u0430\u0432\u043D\u044B\u0439 \u0431\u0443\u0445\u0433\u0430\u043B\u0442\u0435\u0440","\u0411\u0443\u0445\u0433\u0430\u043B\u0442\u0435\u0440","\u0421\u043D\u0430\u0431\u0436\u0435\u043D\u0438\u0435","\u0417\u043E\u043E\u0442\u0435\u0445\u043D\u0438\u043A","\u0410\u0433\u0440\u043E\u043D\u043E\u043C","\u0421\u0435\u043A\u0440\u0435\u0442\u0430\u0440\u044C","\u041B\u043E\u0433\u0438\u0441\u0442","\u0417\u0430\u0432. \u0433\u0430\u0440\u0430\u0436\u043E\u043C","\u0412\u043E\u0434\u0438\u0442\u0435\u043B\u044C"];for(let d=0;d<c.length;d++)a+=b.Position==c[d]?`<option selected value="${c[d]}">${c[d]}</option>`:`<option value="${c[d]}">${c[d]}</option>`;return a}category="carrier"===a?{class:"car",member:"delivery",placeholder:"\u0422\u0440\u0430\u043D\u0441\u043F\u043E\u0440\u0442"}:{class:"phone",member:"",placeholder:"\u0422\u0435\u043B\u0435\u0444\u043E\u043D"},""==b&&(b={role:"",phone:"",last_name:"",first_name:"",email:"",visible:!0});let d=0;$("#member .member").each(function(){d++}),$("#member").append($("<div>",{class:`member ${category.member}`,id:`member_${d}`,append:$("<div>",{class:"m_info",append:$("<div>",{class:"top",append:$("<select>",{append:c()}).add("<input>",{placeholder:category.placeholder,class:category.class,id:category.class,onchange:"saveCard()",value:b.Number})}).add($("<div>",{class:"bottom",append:$("<input>",{placeholder:"\u0424\u0430\u043C\u0438\u043B\u0438\u044F",class:"last_name",id:"last_name",onchange:"saveCard()",value:b.Last_name,type:"text"}).add("<input>",{placeholder:"\u0418\u043C\u044F \u041E\u0442\u0447\u0435\u0441\u0442\u0432\u043E",class:"first_name",id:"first_name",onchange:"saveCard()",value:b.Name,type:"name"}).add("<input>",{placeholder:"\u041F\u043E\u0447\u0442\u0430",class:"email",id:"email",onchange:"saveCard()",onblur:"checkEmail()",value:b.Email,type:"email"})}))}).add($("<div>",{class:"visible",id:`visible_${d}`,onclick:"visOrHidContact(this.id)",append:$("<img>",{src:"../static/images/visible.png"})}))})),null==b.Visible&&(b.Visible=!0),b.Visible||visOrHidContact(`visible_${d}`);for(let c of $("#member .member #phone"))$(c).mask("89999999999");saveCard()}function visOrHidContact(a){let b=a.split("_");if("visible"==b[0]){$(`#${a}`).attr("id",`hidden_${b[1]}`),$(`#member_${b[1]}`).addClass("hidden"),$(`#member_${b[1]} #role`).attr("disabled","disabled"),$(`#member_${b[1]} #phone`).attr("disabled","disabled"),$(`#member_${b[1]} #car`).attr("disabled","disabled"),$(`#member_${b[1]} #last_name`).attr("disabled","disabled"),$(`#member_${b[1]} #first_name`).attr("disabled","disabled"),$(`#member_${b[1]} #email`).attr("disabled","disabled"),$(`#hidden_${b[1]}`).empty(),$(`#hidden_${b[1]}`).append($("<img>",{src:"../static/images/hidden.png"}));let c=$(`#member_${b[1]}`).remove();$("#member").append(c)}else{$(`#${a}`).attr("id",`visible_${b[1]}`),$(`#member_${b[1]}`).removeClass("hidden"),$(`#member_${b[1]} #role`).removeAttr("disabled"),$(`#member_${b[1]} #car`).removeAttr("disabled"),$(`#member_${b[1]} #phone`).removeAttr("disabled"),$(`#member_${b[1]} #last_name`).removeAttr("disabled"),$(`#member_${b[1]} #first_name`).removeAttr("disabled"),$(`#member_${b[1]} #email`).removeAttr("disabled"),$(`#visible_${b[1]}`).empty(),$(`#visible_${b[1]}`).append($("<img>",{src:"../static/images/visible.png"}));let c=$(`#member_${b[1]}`).remove();$("#member").prepend(c)}}function checkEmail(){let a=[];$("#member .member").each(function(b,c){let d=$(c).children()[0].children[1].children[2],e=d.value;if(""==e)return a.push("true"),!1;let f=e.match(/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/);null==f?($(d).addClass("wrong_input"),setTimeout(function(){$(d).removeClass("wrong_input")},2250),a.push("false")):a.push("true")});for(let b=0;b<a.length;b++)if("false"==a[b])return!1;return!0}function removeMemberOrRow(a){a=a.split("_")[2],$(`#${a}`).children().last().remove(),1>=$(`#${a}`).children().length&&$(`[name="remove_last_${a}"]`).fadeOut(0)}function addRow(a,b=""){function c(c){function d(a){$.ajax({url:"/getClients",type:"GET",dataType:"html",success:function(c){c=JSON.parse(c);let d=[],e="";for(let a=0;a<c.length;a++)if("\u041A\u043E\u043D\u043A\u0443\u0440\u0435\u043D\u0442"==c[a].Category){let b=c[a].Name;d.push(b)}e+=`<option disabled selected>Не выбран</option>`;for(let a=0;a<d.length;a++)e+=`<option value='${d[a]}'>${d[a]}</option>`;0==d.length&&(e=`<option disabled selected>Конкурентов нет</option>`),$(`#${a}`).empty(),$(`#${a}`).append(e);let f=0;$(".hmax #group [name=\"items_creator\"]").each(function(){""==b.Creator?$(`#${a} option:contains('Выбрать')`).attr("selected",!0):($(`#${a} option`).each(function(a,c){$(c).html()==b.Creator&&$(c).attr("selected",!0)}),$(`#${a} :selected`).val($(`#${a} :selected`).html())),f++})}})}let e=$("<tr>");for(let f=0;f<c.count;f++)if("item_product"==c.widthInput[f].id){let d=0;$(".hmax #group [name=\"items_list\"]").each(function(){d++}),e.append($("<td>",{append:$("<select>",{css:{width:c.widthInput[f].width+"px",padding:"0"},id:"item_product_"+d,name:"items_list",append:getItemsList("item_product_"+d,b,a.split("-")[0])})}))}else if("item_creator"==c.widthInput[f].id){let a=0;$(".hmax #group [name=\"items_creator\"]").each(function(){a++}),e.append($("<td>",{append:$("<select>",{css:{width:c.widthInput[f].width+"px",padding:"0"},id:"item_creator_"+a,name:"items_creator",append:d("item_creator_"+a)})}))}else e.append($("<td>",{append:$("<input>",{css:{width:c.widthInput[f].width+"px",padding:"0"},id:c.widthInput[f].id,value:b[c.html[f]],type:c.widthInput[f].type})}));return e}const d=[{id:"client-group",tbody:"group",count:4,widthInput:[{id:"item_product",width:100,type:"text"},{id:"item_volume",width:60,type:"number"},{id:"item_creator",width:180,type:"text"},{id:"item_price",width:65,type:"number"}],html:["Name","Volume","Creator","Cost"]},{id:"provider-group",tbody:"group",count:7,widthInput:[{id:"item_product",width:100,type:"text"},{id:"item_price",width:65,type:"number"},{id:"item_date",width:60,type:"text"},{id:"item_vat",width:28,type:"number"},{id:"item_packing",width:60,type:"text"},{id:"item_weight",width:30,type:"text"},{id:"item_fraction",width:60,type:"text"}],html:["Name","Cost","Date","NDS","Packing","Weight","Fraction"]},{id:"carrier-group",tbody:"group",count:5,widthInput:[{id:"carrier_date",width:50,type:"text"},{id:"carrier_client",width:100,type:"text"},{id:"carrier_stock",width:160,type:"text"},{id:"carrier_driver",width:90,type:"text"},{id:"carrier_price",width:65,type:"number"}],html:[]},{id:"account-group",tbody:"group",count:2,widthInput:[{id:"account_date",width:70,type:"text"},{id:"account_price",width:65,type:"number"}],html:["date","sum"]},{id:"delivery-group",tbody:"group",count:2,widthInput:[{id:"delivery_date",width:60,type:"text"},{id:"delivery_price",width:65,type:"number"}],html:["date","price"]},{id:"flight-group",tbody:"flight",count:6,widthInput:[{id:"delivery_flight_product",width:100,type:"text"},{id:"delivery_flight_stock",width:160,type:"text"},{id:"delivery_flight_weight",width:30,type:"number"},{id:"delivery_flight_type",width:160,type:"text"},{id:"delivery_flight_sum",width:70,type:"number"}],html:[]}];for(let e=0;e<d.length;e++)a==d[e].id&&($(`#${d[e].tbody}`).append(c(d[e])),$(`[name="remove_last_group"]`).fadeIn(0),"provider-group"===a&&$("#group #item_date").last().datepicker({minDate:new Date,position:"right bottom",autoClose:!0}),"delivery-group"===a&&($("#delivery_start_date").datepicker({minDate:new Date,position:"right top",autoClose:!0}),$("#delivery_end_date").datepicker({minDate:new Date,position:"right top",autoClose:!0}),$("#group #delivery_date").last().datepicker({minDate:new Date,position:"right bottom",autoClose:!0})),"account-group"===a&&$("#group #account_date").last().datepicker({minDate:new Date,position:"right bottom",autoClose:!0}));1>=$(`#group`).children().length&&$(`[name="remove_last_group"]`).fadeOut(0),saveCard()}function getItemsList(a,b,c){$.ajax({url:"/getAllItems",type:"GET",dataType:"html",success:function(d){d=JSON.parse(d);let e="<option value=\"disabled\" selected disabled>\u0412\u044B\u0431\u0440\u0430\u0442\u044C</option>",f=[];for(let a=0;a<d.length;a++)f.push(d[a].Name);for(let a=0;a<f.length-1;a++)for(let b=a+1;b<f.length;b++)f[a]==f[b]&&(f.splice(b,1),b--);for(let a=0;a<f.length;a++)e+=`<option value="${f[a]}">${f[a]}</option>`;if($(`#${a}`).empty(),$(`#${a}`).append(e),!a.includes("item_product"))itemSelection(c,b);else{let c=0;$(".hmax #group [name=\"items_list\"]").each(function(){""==b.Name?$(`#${a} option:contains('Выбрать')`).attr("selected",!0):($(`#${a} option`).each(function(a,c){$(c).html()==b.Name&&$(c).attr("selected",!0)}),$(`#${a} :selected`).val($(`#${a} :selected`).html())),c++})}}})}function itemSelection(a,b){if("client"===a||"provider"===a)""==b.Category?$(`#${a}_category option:contains('Выбрать')`).attr("selected",!0):($(`#${a}_category option:contains('${b.Category}')`).attr("selected",!0),$(`#${a}_category :selected`).val($(`#${a}_category :selected`).html())),""==b.Segment?$(`#${a}_industry option:contains('Выбрать')`).attr("selected",!0):($(`#${a}_industry option:contains('${b.Segment}')`).attr("selected",!0),$(`#${a}_industry :selected`).val($(`#${a}_industry :selected`).html())),""==b.Demand_item?$(`#demand_product option:contains('Выбрать')`).attr("selected",!0):($("#demand_product option").each(function(a,c){$(c).html()==b.Demand_item&&$(c).attr("selected",!0)}),$(`#demand_product :selected`).val($(`#demand_product :selected`).html()));else{let b=$(`#${a.id} :selected`);b.val(b.html())}saveCard()}function selectManagerInCard(a){let b=a.id,c=$(a).attr("card");closeCardMenu(c),c=c.split("_"),$.ajax({url:"/addManagerToCard",type:"GET",data:{category:c[0],card_id:+c[1],manager_id:b},dataType:"html",success:function(){}})}function unfastenCard(){$(".drop_menu").fadeIn(200)}function detachmentCard(a){let b=a.id.split("_");closeCardMenu(a.id),$.ajax({url:"/deleteManagerFromCard",type:"GET",data:{category:b[0],card_id:b[1],date:getCurrentDate("year")},dataType:"html",success:function(){}}),$("#empty_customer_cards").append($("<div>",{class:"fieldInfo padd",id:`${b[0]}_${b[1]}`,onclick:"createCardMenu(this)",append:$("<div>",{class:"name",html:$(`#${b[0]}_name`).val()}).add($("<div>",{class:"row",append:$("<div>",{class:"descr",html:`Снято с ${username}`}).add($("<div>",{class:"time",html:`Свободна с <span id="free_card_date" class="bold">${getCurrentDate()}</span>`}))}))}));for(let c=0;c<dataName.length;c++)dataName[c].name===b[0]&&getTableData(dataName[c].link)}function saveCard(){$("#card_menu").html()!=null&&(saveTableAndCard[0].lastCard[0]=$("#card_menu"))}