function profileMenu(){$(".profile_menu_l").hasClass("active")?($(".profile_menu_l").removeClass("active"),$(".profile_menu_l").fadeOut(100)):($(".profile_menu_l").fadeIn(100),$(".profile_menu_l").addClass("active"))}function createContactsFormTask(e){const t=[{id:"task_type",html:"Тип задачи",type:"text",element:"select"},{id:"task_whom",html:"Кому",type:"text",element:"select"},{id:"task_date",html:"Дата",type:"text",element:"input"},{id:"task_time",html:"Время",type:"text",element:"input"},{id:"task_comment",html:"Комментарий",type:"text",element:"input"}];return $("<div>",{class:"create_empty_card mr",append:$("<div>",{class:"title mra",html:"Новая задача"}).add(function(){let a=$("<table>",{class:"inputs"});for(let s=0;s<t.length;s++)a.append($("<tr>",{class:"element",append:$("<td>",{html:t[s].html}).add($("<td>",{append:$(`<${t[s].element}>`,{class:"task_input",id:t[s].id,type:t[s].type,value:e[t[s].id]})}))})),"task_whom"==t[s].id&&$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(e){let t=JSON.parse(e);$.ajax({url:"/getUsers",type:"GET",dataType:"html",success:function(e){if(e=JSON.parse(e),"admin"==t.role)for(let t=0;t<e.length;t++)$("#task_whom").append(`\n                                            <option value="${e[t].id}">${e[t].second_name}</option>\n                                        `);else for(let t=0;t<e.length;t++)"manager"==e[t].role&&$("#task_whom").append(`\n                                                <option value="${e[t].id}">${e[t].second_name}</option>\n                                            `);$("#task_whom").append('\n                                    <option value="all">Всем</option>\n                                ')}})}});return a}())}).add($("<div>",{class:"buttons",append:$("<button>",{onclick:"createCTButtons()",html:"Отменить",class:"btn"}).add("<button>",{class:"btn btn-main",html:"Добавить",onclick:"taskCreate()"})}))}function taskCreate(e="new"){let t;$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(a){if(a=JSON.parse(a),"new"!=e){e=JSON.parse(e),$("#tasks_list .empty").remove(),$("#current_tasks").empty(),$("#expired_tasks").empty();for(let t=0;t<e.length;t++){function s(){return"phone"==e[t].Type?"Звонок":"email"==e[t].Type?"Письмо":"other"==e[t].Type?"Другое":void 0}let a=e[t].Date.split(".");2==a[2].length&&(a[2]="20"+a[2]);let n=getCurrentDate("year").split(".");n[2]="20"+n[2];let i=`${a.join(".")} ${e[t].Time}`,d=`${n.join(".")} ${getCurrentTime()}`,l=/(\d\d)\.(\d\d)\.(\d\d\d\d)\s(\d\d):(\d\d)/,c=l.exec(i),o=new Date(c[3],+c[2]-1,c[1],c[4],c[5]),p=l.exec(d),r=new Date(p[3],p[2],p[1],p[4],p[5]);if(o.getTime()>r.getTime()){let a=e[t].Admin?"mark":"";$("#tasks_list .empty").remove(),$("#current_tasks").prepend($("<div>",{class:"item "+a,name:`task_${e[t].Task_id}`,onclick:"completeTask(this)",append:$("<img>",{src:`static/images/${e[t].Type}.svg`,class:"importance"}).add($("<div>",{class:"fieldInfo",append:$("<div>",{class:"row",append:$("<div>",{class:"name",html:s()}).add($("<div>",{class:"time",html:e[t].Time}))}).add($("<div>",{class:"row",append:$("<div>",{class:"descr",html:e[t].Comment}).add($("<div>",{class:"time",append:$("<span>",{class:"bold",html:e[t].Date})}))}))}))}))}else $("#tasks_list_e .empty").remove(),$("#expired_tasks").prepend($("<div>",{class:"item",name:`task_${e[t].Task_id}`,onclick:"completeTask(this)",append:$("<img>",{src:`static/images/${e[t].Type}.svg`,class:"importance"}).add($("<div>",{class:"fieldInfo",append:$("<div>",{class:"row",append:$("<div>",{class:"name",html:s()}).add($("<div>",{class:"time",html:e[t].Time}))}).add($("<div>",{class:"row",append:$("<div>",{class:"descr",html:e[t].Comment}).add($("<div>",{class:"time",append:$("<span>",{class:"bold",html:e[t].Date})}))}))}))}))}}else{t={task_type:$("#task_type").val(),task_whom:[$("#task_whom").val()],task_who:a.id,task_date:$("#task_date").val(),task_time:$("#task_time").val(),task_comment:""==$("#task_comment").val()?"Без комментария":$("#task_comment").val()};let e=$("#task_date").val(),n=$("#task_time").val();try{if(3!=e.split(".").length)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px;">Введите дату в формате дд.мм.гггг или дд.мм.гг!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(""==n)t.task_time="00:00";else{let e=n.split(":");if(+e[0]>23||+e[1]>59)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px;">Некорректное время!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '))}}catch{return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px;">Проверьте корректность введенных данных!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '))}function s(){return"phone"==t.task_type?"Звонок":"email"==t.task_type?"Письмо":"other"==t.task_type?"Другое":void 0}$("#tasks_list .empty").remove(),$("#current_tasks").empty(),$("#expired_tasks").empty(),socket.emit("addTask",{data:t}),$("#task_whom").val()==a.id&&$("#current_tasks").append($("<div>",{class:"item",name:"task_new",onclick:"completeTask(this)",append:$("<img>",{src:`static/images/${t.task_type}.svg`,class:"importance"}).add($("<div>",{class:"fieldInfo",append:$("<div>",{class:"row",append:$("<div>",{class:"name",html:s()}).add($("<div>",{class:"time",html:t.task_time}))}).add($("<div>",{class:"row",append:$("<div>",{class:"descr",html:t.task_comment}).add($("<div>",{class:"time",append:$("<span>",{class:"bold",html:t.task_date})}))}))}))})),createCTButtons()}0==$("#current_tasks").children().length&&($("#tasks_list .empty").remove(),$("#tasks_list").append('<div class="empty">Нет задач</div>')),0==$("#expired_tasks").children().length&&($("#tasks_list_e .empty").remove(),$("#tasks_list_e").append('<div class="empty">Нет просроченных задач</div>'))}})}function createContactsForm(){return $("<div>",{class:"create_empty_card",append:$("<div>",{class:"title",html:"Новый контакт"}).add($("<div>",{class:"radio_boxs",append:function(){let e=$("<div>",{class:"radio_boxs"});for(let t=0;t<contactsFormInfo.length;t++)e.append($("<div>",{class:"element",append:$("<input>",{type:"radio",id:contactsFormInfo[t].id,name:"createEmptyCard"}).add($("<label>",{for:contactsFormInfo[t].id,html:contactsFormInfo[t].name}))}));return e}()}))}).add($("<div>",{class:"buttons",append:$("<button>",{onclick:"createCTButtons()",html:"Отменить",class:"btn"}).add("<button>",{class:"btn btn-main",html:"Добавить",onclick:"сheckSelectedRadioBox()"})}))}function сheckSelectedRadioBox(){for(let e=0;e<contactsFormInfo.length;e++)$(`#${contactsFormInfo[e].id}`).prop("checked")&&(createCardMenu(contactsFormInfo[e]),createCTButtons())}function completeTask(e){createCT("completeTask",$(e).attr("name").split("_")[1])}function createCompleteForm(e){return`\n        <div class="create_empty_card mr">\n            <div class="title mra">Задача выполнена?</div>\n            <div class="select">\n                <button class="btn" id="${e}" onclick="removeTask(this.id)">Да</button>\n                <button class="btn btn-main" id="${e}" onclick="createCTButtons()">Нет</button>\n            </div>\n        </div>\n    `}function removeTask(e){for(let e of $("#current_tasks .item")){$("#current_tasks").empty();break}for(let e of $("#expired_tasks .item")){$("#expired_tasks").empty();break}socket.emit("delete_task",{data:e}),0==$("#current_tasks").children().length&&($("#tasks_list .empty").remove(),$("#tasks_list").append('<div class="empty">Нет задач</div>')),0==$("#expired_tasks").children().length&&($("#tasks_list_e .empty").remove(),$("#tasks_list_e").append('<div class="empty">Нет просроченных задач</div>')),createCTButtons()}function createCT(e,t="empty"){$("#createCT").empty(),"addContact"==e?($("#createCT").append(createContactsForm()),$("#client_new").prop("checked",!0)):"addTask"==e?("empty"===t&&(t={task_type:"",task_whom:"",task_who:"",task_date:"",task_time:"",task_comment:""}),$("#createCT").append(createContactsFormTask(t)),$("#task_date").datepicker({position:"left top",autoClose:!0}),$("#task_time").mask("99:99")):"completeTask"==e&&$("#createCT").append(createCompleteForm(t)),$("#task_type").append('\n        <option selected value="email">Письмо</option>\n        <option value="phone">Звонок</option>\n        <option value="other">Другое</option>\n    ')}function createCTButtons(){$("#createCT").empty(),$("#createCT").append($("<div>",{class:"buttons",append:$("<button>",{id:"addContact",name:"addBtn",class:"btn",html:"Добавить контакт",onclick:"createCT(this.id)"}).add("<button>",{id:"addTask",name:"addBtn",class:"btn btn-main",html:"Добавить задачу",onclick:"createCT(this.id)"})}))}function createCategoryMenu(){for(let e=0;e<linkCategoryInfo.length;e++)$("#nav_bar").append($("<div>",{id:linkCategoryInfo[e].id,class:"block",name:"linkCategory",onclick:"linkCategory(this.id)",append:$("<img>",{class:"img_category",src:linkCategoryInfo[e].src}).add($("<span>",{html:linkCategoryInfo[e].name}))}))}function convertName(e){return(e=e.split(" "))[0]=e[0][0],e[0]+=".",e.reverse().join(" ")}$("#search_dropMenu").click(function(){this.classList.contains("active")?($(".drop-down, #search_dropMenu").removeClass("active"),$(".drop_down_search").remove()):($(".drop-down, #search_dropMenu").addClass("active"),createRegionMenu())}),$("input, textarea").focus(function(){$(this).data("placeholder",$(this).attr("placeholder")),$(this).attr("placeholder","")}),$("input, textarea").blur(function(){$(this).attr("placeholder",$(this).data("placeholder"))});