let user,socket=io(),preloader=document.getElementById("preloader_preload");function fadeOutPreloader(e){e.style.opacity=1;let t=setInterval(function(){e.style.opacity=e.style.opacity-.05,e.style.opacity<=.05&&(clearInterval(t),preloader.style.display="none")},16);$("#preloader").remove()}function getUserInfo(){$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(e){let t=(e=JSON.parse(e)).role,a=e.second_name;user=e,t="admin"==t?"Администратор":"Менеджер",null==a&&(a=""),$("#username").append(`\n                <div class="name">${a} ${e.name}</div>\n            `),$("#username").append(`\n                <div class="descr">${t}</div>\n            `),socket.emit("add user",a)}})}function getTableData(e,t=!1,a=!1){({getRequest:function(e,t,a){const n=[{table:categoryInListClient,request:"/getClients"},{table:categoryInListProvider,request:"/getProviders"},{table:categoryInListCarrier,request:"/getCarriers"},{table:categoryInFinanceDebit,request:"/getAccounts"},{table:categoryInFinanceAccount,request:"/getAccounts"},{table:categoryInDelivery,request:"/getDeliveries"},{table:categoryInStock,request:"/getStockTable"},{table:categoryInAnalytics,request:"/getClients"}];for(let t=0;t<n.length;t++)n[t].table===e&&$.ajax({url:n[t].request,type:"GET",dataType:"html",beforeSend:function(){$(".info").append($("<div>",{class:"table",id:"loading"})),$("#loading").fadeIn(100),$("body").append('\n                                    <div id="preloader">\n                                        <div id="preloader_preload"></div>\n                                    </div>\n                                '),preloader=document.getElementById("preloader_preload")},success:function(e){i(JSON.parse(e))},complete:function(){$("#loading").remove(),setTimeout(function(){fadeOutPreloader(preloader)},0)}});function i(n){if($("table").is(".table")&&!a||$("div").is(".card_menu")&&!a){$(".table").remove();for(let t=e[0].lastCard.length-1;t>=0;t--)null!=e[0].lastCard[t]&&(e[0].lastCard[t]=null);e[1].pop(),setTimeout(()=>{$(".card_menu, .overflow").remove()},0)}"debit"===e[0].id&&(void 0!==e[1][1]&&e[1].pop(n),e[1].push(n)),"analytics"!==e[0].id&&void 0===e[1][1]&&e[1].push(n),t||$(".info").append(fillingTables(e)),"analytics"==saveTableAndCard[0].id&&"manager"==user.role&&($("#analytics_reports .field_with_modal")[0].children[0].innerHTML="Сводный по объёмам",$(".table").width("fit-content")),"client"!=e[0].id&&"carrier"!=e[0].id&&"provider"!=e[0].id||sortTableByArea("min",!1),$(".drop-down, #search_dropMenu").removeClass("active"),$(".drop_down_search").remove(),$.ajax({url:"/getUsers",type:"GET",dataType:"html",success:function(t){$("#empty_customer_cards").empty(),"client"==e[0].id?fillingDisableCardClient(JSON.parse(t)):"provider"==e[0].id&&fillingDisableCardProvider(JSON.parse(t))}}),$("#find_competitor").remove(),$("#amount_cards").remove(),"client"==saveTableAndCard[0].id&&$(".fields").append('<div class="btn btn-main btn-div" id="find_competitor" onclick="searchByCompetitor()">Поиск по конкурентам</div>'),"client"!=saveTableAndCard[0].id&&"carrier"!=saveTableAndCard[0].id&&"account"!=saveTableAndCard[0].id||$("#info_in_accounts").remove(),"Список"==saveTableAndCard[0].name&&$(".fields").append(`<div id="amount_cards"><span>${saveTableAndCard[1][1].length}</span></div>`),"provider"==saveTableAndCard[0].id&&$("#amount_cards").remove()}}}).getRequest(e,t,a)}function fillingDisableCardClient(e){let t=categoryInListClient[1][1];function a(t){for(let a=0;a<e.length;a++)if(e[a].id==t)return`Снято с ${e[a].second_name}`;return""}for(let e=0;e<t.length;e++)t[e].Manager_active||$("#empty_customer_cards").prepend($("<div>",{class:"fieldInfo padd",id:`client_${t[e].id}`,onclick:"createCardMenu(this)",append:$("<div>",{class:"name",html:t[e].Name}).add($("<div>",{class:"row",append:$("<div>",{class:"descr",html:a(t[e].Manager_id)}).add($("<div>",{class:"time",html:(n=t[e].Manager_date,null==n||""==n?"За этой карточкой ни разу не был закреплен менеджер":`Свободна с <span id="free_card_date" class="bold">${n}</span>`)}))}))}));var n}function fillingDisableCardProvider(e){let t=categoryInListProvider[1][1];function a(t){for(let a=0;a<e.length;a++)if(e[a].id==t)return`Снято с ${e[a].second_name}`;return""}for(let e=0;e<t.length;e++)t[e].Manager_active||$("#empty_customer_cards").prepend($("<div>",{class:"fieldInfo padd",id:`provider_${t[e].id}`,onclick:"createCardMenu(this)",append:$("<div>",{class:"name",html:t[e].Name}).add($("<div>",{class:"row",append:$("<div>",{class:"descr",html:a(t[e].Manager_id)}).add($("<div>",{class:"time",html:(n=t[e].Manager_date,null==n?"За этой карточкой ни разу не был закреплен менеджер":`Свободна с <span id="free_card_date" class="bold">${n}</span>`)}))}))}));var n}function saveInfoCard(e,t=!1,a=null,n="none"){let i={getRequest:function(e,n){$.ajax({url:n,type:"GET",data:e,dataType:"html",success:function(){!function(){let e=[];"new"==d&&(d=saveTableAndCard[1][1].length+1),$("#group tr").each(function(t,a){if("client"==r[0])e.push({item_product:$(a).children()[0].children[0].value,item_volume:$(a).children()[1].children[0].value,item_creator:$(a).children()[2].children[0].value,item_price:$(a).children()[3].children[0].value});else{if("provider"!=r[0])return;e.push({item_product:$(a).children()[0].children[0].value,item_price:$(a).children()[1].children[0].value,item_date:$(a).children()[2].children[0].value,item_vat:$(a).children()[3].children[0].value,item_packing:$(a).children()[4].children[0].value,item_weight:$(a).children()[5].children[0].value,item_fraction:$(a).children()[6].children[0].value})}let n=Object.keys(e[e.length-1]),i=0;for(let t=0;t<n.length;t++)""==e[e.length-1][n[t]]&&i++;i==n.length&&e.pop()}),$.ajax({url:"/addItems",type:"GET",data:{category:r[0],id:d,item:JSON.stringify(e)},dataType:"html",success:function(){}})}(),function(e){let t=[];"new"==d&&(d=saveTableAndCard[1][1].length+1),$("#member .member").each(function(e,a){let n=!!$(a).children()[1].id.includes("visible");"carrier"==s?t.push({role:$(a).children()[0].children[0].children[0].value,last_name:$(a).children()[0].children[0].children[1].value,first_name:$(a).children()[0].children[0].children[2].value,car:$(a).children()[0].children[0].children[3].value,phone:$(a).children()[0].children[0].children[4].value,phone_two:$(a).children()[0].children[0].children[5].value,email:$(a).children()[0].children[0].children[6].value,visible:n}):t.push({role:$(a).children()[0].children[0].children[0].value,last_name:$(a).children()[0].children[0].children[1].value,first_name:$(a).children()[0].children[0].children[2].value,car:"null",phone:$(a).children()[0].children[0].children[3].value,phone_two:$(a).children()[0].children[0].children[4].value,email:$(a).children()[0].children[0].children[5].value,visible:n});let i=Object.keys(t[0]),l=0;for(let e=0;e<i.length-1;e++)""==t[t.length-1][i[e]]&&l++;l==i.length-1&&t.pop()}),$.ajax({url:"/addContacts",type:"GET",data:{category:r[0],id:d,contacts:JSON.stringify(t)},dataType:"html",success:function(){null!==a&&function(e){$(".close").is(`#${saveTableAndCard[0].id}_close_card_new`)&&$(`#${saveTableAndCard[0].id}_close_card_new`).attr("id",`${saveTableAndCard[0].id}_close_card_${saveTableAndCard[1][1].length+1}`),$(".card_menu").remove(),$(".info").append($("<div>",{class:"card_menu",id:"contract-decor",append:getTitleInfo({id:`${e.id}`,list:["Оформление договора"],status:`${e.name.split("_")[1]}_contract`}).add($("<div>",{class:"content",append:contractContentCard(e)}))}));for(let t=0;t<dataName.length;t++)if(e.id==dataName[t].name){dataName[t].link[0].lastCard[1]=$(".card_menu");break}}(a),getTableData(saveTableAndCard,!1,e)}})}(t)}})}},l={};const r=e.split("_");let d=r[r.length-1];if("account"==r[0]&&"new"==d&&(d=categoryInFinanceAccount[1][1].length+1),"contract"!==d&&!checkEmail())return;if("account"==r[0]){let e=d,t=[];for(let e of $("#group tr")){let a=$(e)[0].children[0].children[0].value,n=$(e)[0].children[1].children[0].value;t.push({date:a,sum:n})}0==t.length&&t.push({date:"",sum:""}),$.ajax({url:"/addAccountPaymentHistory",data:{account_id:+e,account_payment_history:JSON.stringify(t)},type:"GET",dataType:"html",success:function(){if("new"==r[r.length-1])return getTableData(saveTableAndCard);$.ajax({url:"/getStockTable",type:"GET",dataType:"html",success:function(t){let a,n;t=JSON.parse(t);let i=[];for(let e of $("#exposed_list .invoiled")){let a=$(e).attr("id").split("_")[1];for(let e=0;e<t.length;e++)for(let n=0;n<t[e].items.length;n++){t[e].items[n].Item_id==a&&i.push({id:+a,volume:$(`#invoiled_volume_${a}`).val()})}}for(let t=0;t<categoryInFinanceAccount[1][1].length;t++)categoryInFinanceAccount[1][1][t].account.id==e&&(a=categoryInFinanceAccount[1][1][t].account.Name,n=categoryInFinanceAccount[1][1][t].account.Date,shipment=categoryInFinanceAccount[1][1][t].account.Shipment);if(i.length>0){let t=[],l=[],r=[],d=[];for(let e of $("#exposed_list .invoiled")){let a=$(e).attr("id").split("_")[1];t.push($(e).children()[7].children[0].value),l.push($(e).children()[8].children[0].value),r.push($(e).children()[9].children[0].value),d.push({id:+a,amount:$(e).children()[11].innerHTML})}let c=$("#total").html();$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(s){let o=JSON.parse(s);$.ajax({url:"/editAccount",type:"GET",data:{account_id:+e,status:String($("#account_status").prop("checked")),manager_id:o.id,name:a,date:n,hello:JSON.stringify(l),sale:JSON.stringify(t),shipping:JSON.stringify(r),items_amount:JSON.stringify(d),sum:c,item_ids:JSON.stringify(i),total_costs:$("#total_costs_inv").val(),sale_costs:$("#total_discount_inv").val(),hello_costs:$("#total_privet_inv").val(),delivery_costs:$("#total_delivery_inv").val(),shipment:shipment,shipment_hello:$("#shipment_date").val()},dataType:"html",success:function(){getTableData(categoryInFinanceAccount)}})}})}else if(0==i.length)return void alert("Невозможно отредактировать счет, ни один товара нет в счете!")}})}})}if("contract"===d||"stock"==r[0]||"debit"==r[0])return void getTableData(saveTableAndCard);for(let e=0;e<idCardFields.length;e++)if(r[0]==idCardFields[e].name){const t=idCardFields[e].request;for(let t=0;t<idCardFields[e].ids.length;t++)l[idCardFields[e].ids[t]]=$(`#${idCardFields[e].ids[t]}`).val();if("provider"===r[0]){let e=[];for(let t of $("#group tr"))e.push({item_product:$(t).children()[0].children[0].value,item_price:$(t).children()[1].children[0].value,item_date:$(t).children()[2].children[0].value,item_vat:$(t).children()[3].children[0].value,item_packing:$(t).children()[4].children[0].value,item_weight:$(t).children()[5].children[0].value,item_fraction:$(t).children()[6].children[0].value});l.provider_item_list=JSON.stringify(e)}if(c(e),"check"==n&&("client"==r[0]||"carrier"==r[0])){if(isNaN(+l[`${r[0]}_address`].slice(0,6)))return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 13px; color: #595959;">В начале адреса нужно указать почтовый индекс, содержащий 6 цифр</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(""==l[`${r[0]}_inn`])return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px; color: #595959;">Введите ИНН</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(l[`${r[0]}_inn`].length<10||l[`${r[0]}_inn`].length>12)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 13px; color: #595959;">ИНН должен содержать от 10 до 12 цифр</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(9!=l[`${r[0]}_bik`].length)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px; color: #595959;">БИК должен содержать 9 цифр</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(20!=l[`${r[0]}_kc`].length)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px; color: #595959;">Корреспондентский счёт должен содержать 20 цифр</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));if(20!=l[`${r[0]}_rc`].length)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px; color: #595959;">Расчётный счёт должен содержать 20 цифр</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '))}i.getRequest(l,t);break}function c(e){let t;$.ajax({url:"/getThisUser",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}}),"client"==r[0]&&(l.livestock_general=$("#livestock_general").val(),l.livestock_milking=$("#livestock_milking").val(),l.livestock_milkyield=$("#livestock_milkyield").val(),"new"==r[r.length-1]&&(l.manager_id="manager"==t.role?t.id:"admin",l.manager_active=!0,l.manager_date=getCurrentDateNotComparison("year"))),"provider"==r[0]&&(l.provider_create_date=getCurrentDateNotComparison("year"),"new"==r[r.length-1]&&(l.manager_id="manager"==t.role?t.id:"admin",l.manager_active=!0,l.manager_date=getCurrentDateNotComparison("year"))),"carrier"==r[0]&&(l.items_delivery=JSON.stringify([])),l[`${r[0]}_data`]=d,l[`${r[0]}_site`]=""!==$(`#${r[0]}_site`).val()?$(`#${r[0]}_site`).val():$(`#${r[0]}_site`).html(),l[`${r[0]}_holding`]=""!==$(`#${r[0]}_holding`).val()?$(`#${r[0]}_holding`).val():$(`#${r[0]}_holding`).html()}let s=r[0]}$(document).ready(function(){addButtonsSubcategory(0),getTableData(categoryInListClient),createCategoryMenu(),createCTButtons(),linkField(),getUserInfo(),$("#clientButton, #category-0").addClass("active"),socket.emit("connection"),socket.emit("showTasks")}),socket.on("showTasks",function(e){$("#current_tasks").empty(),$("#expired_tasks").empty(),taskCreate(e)}),socket.on("refreshTasks",function(){socket.emit("showTasks")}),socket.on("user joined",function(){});let getCommentsInfo=function(){return{getRequest:function(e){function t(){$.ajax({url:"/getMessages",type:"GET",data:{category:e[0],id:e[1]},dataType:"html",success:function(t){!function(e,t){if(0==e.length)addComment();else{$("#messages, #comments").empty();let a=[];for(let t=0;t<e.length;t++)a.push({name:e[t].Manager,date:e[t].Date.split(" ")[0],note:e[t].Note,id:e[t].NoteId,creator:e[t].Creator});for(let e=0;e<a.length-1;e++)addComment(a[e],t);addComment(a[a.length-1],t,!0)}$("#messages").children().length<=1&&$('[name="remove_last_comment"]').fadeOut(0);"search"==t[2]&&("client"==t[0]?(categoryInListClient[0].lastCard[0]=$(".card_menu"),categoryInListClient[0].active=!0,categoryInListProvider[0].active=!1,categoryInListCarrier[0].active=!1):"provider"==t[0]?(categoryInListProvider[0].lastCard[0]=$(".card_menu"),categoryInListProvider[0].active=!0,categoryInListClient[0].active=!1,categoryInListCarrier[0].active=!1):"carrier"==t[0]?(categoryInListCarrier[0].lastCard[0]=$(".card_menu"),categoryInListCarrier[0].active=!0,categoryInListClient[0].active=!1,categoryInListProvider[0].active=!1):alert("Что-то пошло не так!"),linkCategory("category-0"),linkField())}(JSON.parse(t),e)}})}"string"==typeof e?$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(a){let n=JSON.parse(a),i={comment_date:$("#comment_date").val(),comment_role:$("#comment_role").val(),comment_content:$("#comment_content").val(),comment_creator:n.second_name,comment_creator_id:n.id};if(e=e.split("_"),null==i.comment_role||""==i.comment_content)return void t();let l=0,r=Object.keys(i);for(let e=1;e<3;e++)""!=i[r[e]]&&null!=i[r[e]]||l++;if(2==l)return t();$.ajax({url:"/addMessages",type:"GET",data:{category:e[0],id:e[1],comments:JSON.stringify(i)},dataType:"html",success:function(e){t()}})}}):t()}}}();function cancelSearch(){for(let e=0;e<dataName.length;e++)if(saveTableAndCard[0].id==dataName[e].name){"stock"==saveTableAndCard[0].id&&($(".row").remove(),addButtonsSubcategory(3),linkField()),getTableData(dataName[e].link);break}$(".centerBlock .header .cancel").remove(),$("#search").val(""),$(".modal_search").remove(),$(".overflow").remove(),lastData={last_id:"",last_table:""},filter_parameters=[{name:"Group_name",filter:""},{name:"Name",filter:""}],categoryInFilterStock[1][1]=[],sortStatus={product:{status:!1,filter:null,last:null},price:{status:!1,filter:null},area:{status:!1,filter:null},category:{status:!1,filter:null,last:null},manager:{status:!1,filter:null,last:null},customer:{status:!1,filter:null,last:null},status:{status:!1,filter:null,last:null},date:{status:!1,filter:null,last:null},search_on_regions:{status:!1,filter:null,last:null}}}function searchRegionFill(e){$(".centerBlock .header .cancel").remove();let t=$(e).html(),a=saveTableAndCard[1][1],n=[{id:"client",list:"Oblast",filter:filterClient},{id:"provider",list:"Oblast",filter:filterProvider},{id:"carrier",list:"Region",filter:filterCarrier}],i=[];for(let e=0;e<n.length;e++)if(n[e].id==saveTableAndCard[0].id){for(let l=0;l<a.length;l++){String(a[l][n[e].list]).toLowerCase().includes(t.toLowerCase())&&i.push(a[l])}let l=[];for(let e=0;e<i.length;e++)"Клиент"===i[e].Category&&(l.push(i[e]),i.splice(e,1),e--);for(let e=0;e<l.length;e++)i.push(l[e]);sortStatus.search_on_regions.status=!0,n[e].filter[1][1]=i,$(".table").remove(),$(".info").append(fillingTables(n[e].filter,!0));break}$(".centerBlock .header .cancel").remove(),$(".centerBlock .header").append('\n        <div class="cancel">\n            <button class="btn btn-main" onclick="cancelSearch()">Отменить поиск</button>\n        </div>\n    ')}function searchFill(e){$(".centerBlock .header .cancel").remove();let t=$(e).html(),a=saveTableAndCard[1][1],n=[{id:"client",list:"Rayon",filter:filterClient},{id:"provider",list:"Rayon",filter:filterProvider},{id:"carrier",list:"Area",filter:filterCarrier}],i=[];for(let e=0;e<n.length;e++)if(n[e].id==saveTableAndCard[0].id){for(let l=0;l<a.length;l++){String(a[l][n[e].list]).toLowerCase().includes(t.toLowerCase())&&i.push(a[l])}let l=[];for(let e=0;e<i.length;e++)"Клиент"===i[e].Category&&(l.push(i[e]),i.splice(e,1),e--);for(let e=0;e<l.length;e++)i.push(l[e]);n[e].filter[1][1]=i.reverse(),$(".table").remove(),$(".info").append(fillingTables(n[e].filter,!0));break}$(".centerBlock .header .cancel").remove(),$(".centerBlock .header").append('\n        <div class="cancel">\n            <button class="btn btn-main" onclick="cancelSearch()">Отменить поиск</button>\n        </div>\n    ')}function openCardMenu(e){$(".modal_select").remove(),$(".overflow").remove(),$(".background").remove(),createCardMenu(e)}function searchCategoryInfo(){$(".centerBlock .header .cancel").remove();let e=$("#search").val();if($("#active_comment_seach").prop("checked"))$.ajax({url:"/findComments",type:"GET",data:{data:e},dataType:"html",success:function(e){$(".modal_search").remove(),$(".overflow").remove();let t=JSON.parse(e);function a(){let e=$("<table>",{class:"table_search"});e.append('\n                        <tr>\n                            <th>Должность</th>\n                            <th>Имя Отчество</th>\n                            <th width="300">Организация</th>\n                            <th>Дата создания</th>\n                            <th width="200">Комментарий</th>\n                        </tr>\n                    ');for(let a=0;a<t.length;a++){let n,i,l;null!=t[a].Client_id?(l=$("<tr>",{id:`client_${t[a].Client_id}_search`,onclick:"openCardMenu(this)"}),i={request:"/getClients",id:t[a].Client_id,mainTable:categoryInListClient}):null!=t[a].Provider_id?(l=$("<tr>",{id:`provider_${t[a].Provider_id}_search`,onclick:"openCardMenu(this)"}),i={request:"/getProviders",id:t[a].Provider_id,mainTable:categoryInListProvider}):null!=t[a].Carrier_id&&(l=$("<tr>",{id:`carrier_${t[a].Carrier_id}_search`,onclick:"openCardMenu(this)"}),i={request:"/getCarriers",id:t[a].Carrier_id,mainTable:categoryInListCarrier}),$.ajax({url:i.request,type:"GET",dataType:"html",success:function(e){n=JSON.parse(e),null==i.mainTable[1][1]&&i.mainTable[1].push(n);for(let e=0;e<n.length;e++)if(i.id==n[e].id){let i=t[a].Manager.split("|");l.append(`\n                                            <td>${null==i[0]?"":i[0]}</td>\n                                            <td>${null==i[1]?i[0]:i[1]}</td>\n                                            <td>${n[e].Name}</td>\n                                            <td>${t[a].Date}</td>\n                                            <td><p style="width: 200px" class="clip">${t[a].Note}</p></td>\n                                        `);break}}}),e.append(l)}return e}$(".info").prepend($("<div>",{class:"overflow"})),$(".overflow").height($(".container")[0].scrollHeight),$(".info").append($("<div>",{class:"modal_select modal_search",append:$("<div>",{class:"title",html:'\n                            <span>Поиск</span>\n                            <div class="close" onclick="closeModalMenu()">\n                                <img src="static/images/cancel.png">\n                            </div>\n                        '}).add($("<div>",{class:"content",append:a()}))}))}});else if($("#active_comment_seach_name").prop("checked")){$(".modal_search").remove(),$(".overflow").remove();let a=[{id:"client",filter_table:filterClient},{id:"prodiver",filter_table:filterProvider},{id:"carrier",filter_table:filterCarrier},{id:"debit",filter_table:filterAccount},{id:"account",filter_table:filterAccount},{id:"delivery",filter_table:filterDelivery}];for(let n=0;n<a.length;n++)if(saveTableAndCard[0].id==a[n].id){let i=saveTableAndCard[1][1],l=[];for(let a=0;a<i.length;a++){function t(){return"account"==saveTableAndCard[0].id?i[a].account.Name.toLowerCase():"delivery"==saveTableAndCard[0].id?i[a].delivery.Name.toLowerCase():i[a].Name.toLowerCase()}t().includes(e.toLowerCase())&&l.push(i[a])}a[n].filter_table[1][1]=l,$(".table").remove(),$(".info").append(fillingTables(a[n].filter_table));break}$(".centerBlock .header .cancel").remove(),$(".centerBlock .header").append('\n            <div class="cancel">\n                <button class="btn btn-main" onclick="cancelSearch()">Отменить поиск</button>\n            </div>\n        ')}else $.ajax({url:"/findContacts",type:"GET",data:{data:e},dataType:"html",success:function(e){$(".modal_search").remove(),$(".overflow").remove();let t=JSON.parse(e);function a(){let e=$("<table>",{class:"table_search"});e.append('\n                        <tr>\n                            <th>Телефон</th>\n                            <th>ФИО</th>\n                            <th width="300">Организация</th>\n                            <th>Должность</th>\n                            <th>Статус</th>\n                        </tr>\n                    ');for(let a=0;a<t.length;a++){let n,i,l;null!=t[a].Client_id?(l=$("<tr>",{id:`client_${t[a].Client_id}_search`,onclick:"openCardMenu(this)"}),i={request:"/getClients",id:t[a].Client_id,mainTable:categoryInListClient}):null!=t[a].Provider_id?(l=$("<tr>",{id:`provider_${t[a].Provider_id}_search`,onclick:"openCardMenu(this)"}),i={request:"/getProviders",id:t[a].Provider_id,mainTable:categoryInListProvider}):null!=t[a].Carrier_id&&(l=$("<tr>",{id:`carrier_${t[a].Carrier_id}_search`,onclick:"openCardMenu(this)"}),i={request:"/getCarriers",id:t[a].Carrier_id,mainTable:categoryInListCarrier}),$.ajax({url:i.request,type:"GET",dataType:"html",success:function(e){n=JSON.parse(e),null==i.mainTable[1][1]&&i.mainTable[1].push(n);for(let e=0;e<n.length;e++)if(i.id==n[e].id){let i=t[a].Visible?"Активен":"Архив";l.append(`\n                                            <td>${t[a].Number}</td>\n                                            <td>${t[a].Last_name} ${t[a].Name}</td>\n                                            <td>${n[e].Name}</td>\n                                            <td>${t[a].Position}</td>\n                                            <td>${i}</td>\n                                        `);break}}}),e.append(l)}return e}$(".info").prepend($("<div>",{class:"overflow"})),$(".overflow").height($(".container")[0].scrollHeight),$(".info").append($("<div>",{class:"modal_select modal_search",append:$("<div>",{class:"title",html:'\n                            <span>Поиск по номеру телефона/фамилии/почте</span>\n                            <div class="close" onclick="closeModalMenu()">\n                                <img src="static/images/cancel.png">\n                            </div>\n                        '}).add($("<div>",{class:"content",append:a()}))}))}})}$("#search").keydown(function(e){13===e.keyCode&&searchCategoryInfo()}),$("#search_button").click(function(){searchCategoryInfo()});