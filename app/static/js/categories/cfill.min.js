function linkField(){$(".field").click(function(){function e(e){for(let t=1;t<e.length;t++)e[t].objectName[0].active=!1}sortStatus={product:{status:!1,filter:null,last:null},price:{status:!1,filter:null},area:{status:!1,filter:null},category:{status:!1,filter:null,last:null},manager:{status:!1,filter:null,last:null},customer:{status:!1,filter:null,last:null},status:{status:!1,filter:null,last:null},date:{status:!1,filter:null,last:null},search_on_regions:{status:!1,filter:null,last:null}},$(".table").remove(),$(".field").removeClass("active"),$(`#${this.id}`).addClass("active"),$("div").is("#card_menu, #contract-decor, #invoicing, .invoicing")&&$(".card_menu").remove();for(let t=0;t<subcategoryButtons.length;t++)for(let n=1;n<subcategoryButtons[t].length;n++)if(this.id==subcategoryButtons[t][n].id){e(subcategoryButtons[t]),getTableData(subcategoryButtons[t][n].objectName);break}}),$(".list").click(function(){let e;$.ajax({url:"/getThisUser",type:"GET",async:!1,dataType:"html",success:function(t){e=JSON.parse(t)}});const t=[{width:161.125,id:"stock_group",list:[]},{width:90.656,id:"stock_product",list:[]},{width:220,id:"analytics_reports",list:"admin"==e.role?["Прибыль по клиентам","Сводный по объёмам","По клиентам","По приветам","Отгрузки менеджеров","Проделанная работа"]:["Сводный по объёмам","По клиентам","По приветам","Отгрузки менеджеров"]}];let n,i=this.id,a=categoryInStock[1][1],l=["Group_name","Name"];if(!i.includes("analytics")&&!$(".report_list").is(`#${i}`))for(let e=0;e<l.length;e++)for(let n=0;n<a.length;n++)for(let i=0;i<a[n].items.length;i++)t[e].list.push(a[n].items[i][l[e]]);for(let e=0;e<t.length;e++)t[e].id===i&&(n=e);let d,s=t[n].list;for(let e=0;e<s.length-1;e++)for(let t=e+1;t<s.length;t++)s[e].toLowerCase()===s[t].toLowerCase()&&(s.splice(t,1),t--);if($(`#${i} .drop_down_img`).hasClass("drop_active"))return $(`#${i} .drop_down_img`).removeClass("drop_active"),$(`#${i} .report_list`).fadeOut(200),void setTimeout(()=>{$(`#${i} .report_list`).remove()},300);for(let e=0;e<t.length;e++)$(`#${t[e].id}`).width("auto");$(".report_list").remove(),$(".drop_down_img").removeClass("drop_active"),$(".field_with_modal").removeClass("active"),$(this).append($("<div>",{class:"report_list",id:i})),$(".report_list").append(function(){for(let n=0;n<t.length;n++)if(t[n].id==i){d=t[n].list;let a=$("<ul>");if("admin"==e.role)for(let e=0;e<t[n].list.length;e++)a.append(`<li id="${i}_${e}">${t[n].list[e]}</li>`);else if("analytics_reports"==i)for(let e=0;e<t[n].list.length;e++)a.append(`<li id="${i}_${e+1}">${t[n].list[e]}</li>`);else for(let e=0;e<t[n].list.length;e++)a.append(`<li id="${i}_${e}">${t[n].list[e]}</li>`);return a}}()),function(){let e=$(`#${i} .report_list`).width();for(let n=0;n<t.length;n++)if(t[n].id==i)if(e>t[n].width){$(`#${i}`).width(+e+20);for(let t=0;t<$(`#${i} .report_list`).children()[0].children.length;t++)$(`#${i} .report_list`).children()[0].children[t].style.width=+e+20+"px"}else{$(`#${i}`).width(t[n].width),$(`#${i} .report_list`).width(t[n].width);for(let e=0;e<$(`#${i} .report_list`).children()[0].children.length;e++)$(`#${i} .report_list`).children()[0].children[e].style.width=t[n].width+"px"}}(),$(".report_list").fadeIn(400),$(`#${i} .field_with_modal`).addClass("active"),$(`#${i} .drop_down_img`).addClass("drop_active"),$("li").click(function(){$("#not_found").remove();let t=this.id;$("table").remove(),$(`#${i}`).width("auto"),$(`#${i} #active_field`).html(function(){if("admin"==e.role)return d[t.split("_")[2]];if("manager"==e.role)return d[+t.split("_")[2]-1]}()),$(`#${i} .field_with_modal`).addClass("active");$(".info").append((()=>{if(i.includes("analytics_reports")){let e=[analyticsFilterTable_0,analyticsFilterTable_1,analyticsFilterTable_2,analyticsFilterTable_3,analyticsFilterTable_4,analyticsFilterTable_5];return $("#analytics_block_hidden").remove(),$('[name="unload_table"]').remove(),$("#info_in_accounts").remove(),e[t.split("_")[2]](datePeriod("month"))}{$(".centerBlock .header .cancel").remove(),$(".centerBlock .header").append('\n                        <div class="cancel">\n                            <button class="btn btn-main" onclick="cancelSearch()">Отменить поиск</button>\n                        </div>\n                    ');const e=[{id:"stock_group",filterName:"Group_name",name:"Группа товаров"},{id:"stock_product",filterName:"Name",name:"Товар"}];for(let t=0;t<e.length;t++)if($(`#${e[t].id}`).children().children()[0].innerHTML!=e[t].name)for(let n=0;n<filter_parameters.length;n++)filter_parameters[n].name==e[t].filterName&&(filter_parameters[n].filter=$(`#${e[t].id}`).children().children()[0].innerHTML);categoryInFilterStock[1][1]=[];let t=[];for(let e=0;e<a.length;e++)for(let n=0;n<a[e].items.length;n++)a[e].items[n][filter_parameters[0].name]!=filter_parameters[0].filter&&""!=filter_parameters[0].filter||a[e].items[n][filter_parameters[1].name]!=filter_parameters[1].filter&&""!=filter_parameters[1].filter||t.push({stock_address:a[e].stock_address,items:[a[e].items[n]]});for(let e=0;e<t.length-1;e++)for(let n=e+1;n<t.length;n++)if(t[e].stock_address===t[n].stock_address){for(let i=0;i<t[n].items.length;i++)t[e].items.push(t[n].items[i]);t.splice(n,1),n--}return categoryInFilterStock[1][1]=t,fillingTables(categoryInFilterStock)}})()),0!=categoryInFilterStock[1][1].length||i.includes("analytics")||$(".info").append('\n                    <div id="not_found" class="row">\n                        <span style="margin-left: 10px; margin-top: -20px;">Ничего не найдено</span>\n                    </div>\n                '),"Сводный по объёмам"!=$("#active_field").html()&&"Отгрузки менеджеров"!=$("#active_field").html()||$(".table").width("max-content")})})}let lastData={last_id:"",last_table:""};function linkCategory(e){$(".info").empty(),$('[name="linkCategory"], .mini_logo').removeClass("active"),$(`#${e}`).addClass("active"),lastData={last_id:"",last_table:""},sortStatus={product:{status:!1,filter:null,last:null},price:{status:!1,filter:null},area:{status:!1,filter:null},category:{status:!1,filter:null,last:null},manager:{status:!1,filter:null,last:null},customer:{status:!1,filter:null,last:null},status:{status:!1,filter:null,last:null},date:{status:!1,filter:null,last:null},search_on_regions:{status:!1,filter:null,last:null}},categoryInFilterStock[1][1]=[];for(let t=0;t<linkCategoryInfo.length;t++)if(e==linkCategoryInfo[t].id)for(let e=0;e<linkCategoryInfo[t].subcategories.length;e++)if(linkCategoryInfo[t].subcategories[e][0].active){addButtonsSubcategory(t),getTableData(linkCategoryInfo[t].subcategories[e]),t<=1&&$(`#${linkCategoryInfo[t].subcategories[e][0].id}Button`).addClass("active");break}linkField()}function addButtonsSubcategory(e){$(".info").append($("<div>",{class:"row",id:"subcategories",append:$("<div>",{class:"fields"}).add($("<div>",{class:"category",html:subcategoryButtons[e][0].toUpperCase()}))}));for(let t=1;t<subcategoryButtons[e].length;t++){let n;$(".fields").append(()=>"Склад"===subcategoryButtons[e][0]||"Аналитика"===subcategoryButtons[e][0]?$("<div>",{class:"list",id:subcategoryButtons[e][t].id,append:$("<div>",{class:subcategoryButtons[e][t].class,append:$("<span>",{html:subcategoryButtons[e][t].name,id:"active_field"}).add($("<img>",{src:"static/images/dropmenu_black.svg",class:"drop_down_img"}))})}):n=$("<div>",{class:subcategoryButtons[e][t].class,html:subcategoryButtons[e][t].name,id:subcategoryButtons[e][t].id})),$("#delivery_new").attr("onclick","reloadStockItems(this)")}}function closePersonCard(){$(".card_menu").remove(),adminPanel()}function userInfo(e){$("#addNewPerson").remove(),$.ajax({url:"/getUsers",type:"GET",dataType:"html",success:function(t){t=JSON.parse(t);for(let i=0;i<t.length;i++)t[i].id==e.id&&($(".table, .card_menu").remove(),$(".info").append(`\n                        <div class="card_menu" id="card_menu">\n                            <div class="title">\n                                <div class="left_side">\n                                    <span>Редактирование сотрудника</span>\n                                </div>\n                                <div class="right_side">\n                                    <div class="close" onclick="closePersonCard()">\n                                        <img src="static/images/cancel.png">\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="content">\n                                <div class="row_card">\n                                    <table class="table_block">\n                                        <tr>\n                                            <td>Фамилия</td>\n                                            <td>\n                                                <input type="text" value="${t[i].second_name}" id="edit_surname">\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>Имя</td>\n                                            <td>\n                                                <input type="name" value="${t[i].name}" id="edit_name">\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>Отчество</td>\n                                            <td>\n                                                <input type="text" value="${t[i].third_name}" id="edit_patronymic">\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>Должность</td>\n                                            <td>\n                                                <select type="text" id="edit_role">\n                                                    ${n=t[i].role,"admin"==n?'\n                <option selected value="admin">Администратор</option>\n                <option value="manager">Менеджер</option>\n            ':'\n                <option value="admin">Администратор</option>\n                <option selected value="manager">Менеджер</option>\n            '}\n                                                </select>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                    <table class="table_block">\n                                        <tr>\n                                            <td>Email</td>\n                                            <td>\n                                                <input type="email" value="${t[i].email}" id="edit_email">\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>Логин</td>\n                                            <td>\n                                                <input type="login" value="${t[i].login}" id="edit_login">\n                                            </td>\n                                        </tr>\n                                        <tr>\n                                            <td>Пароль</td>\n                                            <td>\n                                                <input type="text" value="${t[i].password}" id="edit_password">\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </div>\n                                <div class="next">\n                                    <button class="btn btn-main" id="${t[i].id}" onclick="deleteMember(this.id)">Удалить</button>\n                                    <button class="btn btn-main" id="${t[i].id}" onclick="editMember(this.id)">Изменить</button>\n                                </div>\n                            </div>\n                        </div>`));var n}})}function deleteMember(e){$.ajax({url:"/deleteMember",type:"GET",data:{id:e},dataType:"html",success:function(){$(".card_menu").remove(),adminPanel()}})}function editMember(e){$.ajax({url:"/getUsers",type:"GET",dataType:"html",success:function(t){t=JSON.parse(t);for(let n=0;n<t.length;n++)if(t[n].id==+e){let t={};t.create_first_name=$("#edit_name").val(),t.create_last_name=$("#edit_surname").val(),t.create_patronymic=$("#edit_patronymic").val(),t.create_email=$("#edit_email").val(),t.create_login=$("#edit_login").val(),t.create_role=$("#edit_role").val(),t.create_password=$("#edit_password").val(),t.id=+e,$.ajax({url:"/addUser",type:"GET",data:t,dataType:"html",success:function(){$(".card_menu").remove(),adminPanel()}})}}})}function persons(){$("#filter_admin").remove(),adminPanel()}function items(){$("._block").remove(),$.ajax({url:"/getStockTable",type:"GET",dataType:"html",beforeSend:function(){$("body").append('\n                <div id="preloader">\n                    <div id="preloader_preload"></div>\n                </div>\n            '),preloader=document.getElementById("preloader_preload")},success:function(e){e=JSON.parse(e),$(".table").remove(),$("#addNewPerson").remove(),activeThisField("items"),$(".info").append('\n                    <div class="row" id="filter_admin" style="margin-bottom: 20px;">\n                        <div class="fields">\n                        <div class="list_admin" id="stock_group">\n                            <div class="field_with_modal">\n                                <span id="active_field">Группа товаров</span>\n                                <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                            </div>\n                        </div>\n                        <div class="list_admin" id="stock_product">\n                            <div class="field_with_modal">\n                                <span id="active_field">Товар</span>\n                                <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                            </div>\n                        </div>\n                    </div>\n                    </div>\n                ').append(function(){let t=$("<table>",{class:"table"});t.append(function(){let e=categoryInStock[1][0],t=$("<tr>");for(let n=0;n<e.length;n++)t.append(`<th width="${e[n].width}%">${e[n].name}</th>`);return t}());for(let n=e.length-1;n>=0;n--)for(let i=e[n].items.length-1;i>=0;i--)if(null!=e[n].stock_address){let a=$("<tr>",{id:`stock_${e[n].items[i].Item_id}`,onclick:"editItem(this.id)"});const l=[e[n].items[i].Prefix,e[n].items[i].Group_name,e[n].items[i].Name,returnSpaces(e[n].items[i].Weight),e[n].items[i].Packing,returnSpaces(e[n].items[i].Volume),returnSpaces(e[n].items[i].Cost),e[n].items[i].NDS,e[n].stock_address];for(let e=0;e<l.length;e++){let t=$("<td>",{html:l[e]});a.append(t)}t.append(a)}return t}()),activeAdmin()},complete:function(){$("#loading").remove(),setTimeout(function(){fadeOutPreloader(preloader)},0)}})}function activeAdmin(){$(".list_admin").click(function(){let e;$.ajax({url:"/getThisUser",type:"GET",async:!1,dataType:"html",success:function(t){e=JSON.parse(t)}});const t=[{width:161.125,id:"stock_group",list:[]},{width:90.656,id:"stock_product",list:[]}];$.ajax({url:"/getStockTable",type:"GET",async:!1,dataType:"html",success:function(e){filter_table=JSON.parse(e)}});let n,i=this.id,a=["Group_name","Name"];if(!i.includes("analytics")&&!$(".report_list").is(`#${i}`))for(let e=0;e<a.length;e++)for(let n=0;n<filter_table.length;n++)for(let i=0;i<filter_table[n].items.length;i++)t[e].list.push(filter_table[n].items[i][a[e]]);for(let e=0;e<t.length;e++)t[e].id===i&&(n=e);let l,d=t[n].list;for(let e=0;e<d.length-1;e++)for(let t=e+1;t<d.length;t++)d[e].toLowerCase()===d[t].toLowerCase()&&(d.splice(t,1),t--);if($(`#${i} .drop_down_img`).hasClass("drop_active"))return $(`#${i} .drop_down_img`).removeClass("drop_active"),$(`#${i} .report_list`).fadeOut(200),void setTimeout(()=>{$(`#${i} .report_list`).remove()},300);for(let e=0;e<t.length;e++)$(`#${t[e].id}`).width("auto");$(".report_list").remove(),$(".drop_down_img").removeClass("drop_active"),$(".field_with_modal").removeClass("active"),$(this).append($("<div>",{class:"report_list",id:i})),$(".report_list").append(function(){for(let n=0;n<t.length;n++)if(t[n].id==i){l=t[n].list;let a=$("<ul>");if("admin"==e.role)for(let e=0;e<t[n].list.length;e++)a.append(`<li id="${i}_${e}">${t[n].list[e]}</li>`);else for(let e=0;e<t[n].list.length;e++)a.append(`<li id="${i}_${e}">${t[n].list[e]}</li>`);return a}}()),function(){let e=$(`#${i} .report_list`).width();for(let n=0;n<t.length;n++)if(t[n].id==i)if(e>t[n].width){$(`#${i}`).width(+e+20);for(let t=0;t<$(`#${i} .report_list`).children()[0].children.length;t++)$(`#${i} .report_list`).children()[0].children[t].style.width=+e+20+"px"}else{$(`#${i}`).width(t[n].width),$(`#${i} .report_list`).width(t[n].width);for(let e=0;e<$(`#${i} .report_list`).children()[0].children.length;e++)$(`#${i} .report_list`).children()[0].children[e].style.width=t[n].width+"px"}}(),$(".report_list").fadeIn(400),$(`#${i} .field_with_modal`).addClass("active"),$(`#${i} .drop_down_img`).addClass("drop_active"),$("li").click(function(){$("#not_found").remove();let t=this.id;$("table").remove(),$(`#${i}`).width("auto"),$(`#${i} #active_field`).html(function(){if("admin"==e.role)return l[t.split("_")[2]];if("manager"==e.role)return l[+t.split("_")[2]-1]}()),$(`#${i} .field_with_modal`).addClass("active");$(".info").append((()=>{const e=[{id:"stock_group",filterName:"Group_name",name:"Группа товаров"},{id:"stock_product",filterName:"Name",name:"Товар"}];for(let t=0;t<e.length;t++)if($(`#${e[t].id}`).children().children()[0].innerHTML!=e[t].name)for(let n=0;n<filter_parameters.length;n++)filter_parameters[n].name==e[t].filterName&&(filter_parameters[n].filter=$(`#${e[t].id}`).children().children()[0].innerHTML);categoryInStockAdmin[1][1]=[];let t=[];for(let e=0;e<filter_table.length;e++)for(let n=0;n<filter_table[e].items.length;n++)filter_table[e].items[n][filter_parameters[0].name]!=filter_parameters[0].filter&&""!=filter_parameters[0].filter||filter_table[e].items[n][filter_parameters[1].name]!=filter_parameters[1].filter&&""!=filter_parameters[1].filter||t.push({stock_address:filter_table[e].stock_address,items:[filter_table[e].items[n]]});for(let e=0;e<t.length-1;e++)for(let n=e+1;n<t.length;n++)if(t[e].stock_address===t[n].stock_address){for(let i=0;i<t[n].items.length;i++)t[e].items.push(t[n].items[i]);t.splice(n,1),n--}return categoryInStockAdmin[1][1]=t,fillingTables(categoryInStockAdmin)})()),0==categoryInStockAdmin[1][1].length&&$(".info").append('\n                    <div id="not_found" class="row">\n                        <span style="margin-left: 10px; margin-top: -20px;">Ничего не найдено</span>\n                    </div>\n                ')})})}function positions(){$("._block").remove(),$("#filter_admin").remove(),$.ajax({url:"/getRoles",type:"GET",dataType:"html",beforeSend:function(){$("body").append('\n                <div id="preloader">\n                    <div id="preloader_preload"></div>\n                </div>\n            '),preloader=document.getElementById("preloader_preload")},success:function(e){e=JSON.parse(e),$(".table").remove(),$("#addNewPerson").remove(),activeThisField("positions"),$(".info").append(function(){let t=$("<div>",{class:"_block"});for(let n=0;n<e.length;n++)t.append(`<div class="block_ flex"><span>${e[n].Name}</span></div>`);return t.append('\n                    <div class="block_ flex block_add">\n                        <input placeholder="Введите должность" class="format" type="text" id="new_position">\n                        <button class="btn btn-main" style="height: 25px; font-size: 11px" onclick="addNewPosition_Save()">Добавить</button>\n                    </div>\n                '),t}())},complete:function(){$("#loading").remove(),setTimeout(function(){fadeOutPreloader(preloader)},0)}})}function activeThisField(e){const t=["persons","positions","items"];for(let n=0;n<t.length;n++)$(`#${t[n]}`).removeClass("active"),t[n]==e&&$(`#${e}`).addClass("active")}function adminPanel(close=""){$.ajax({url:"/getThisUser",type:"GET",dataType:"html",success:function(data){if(data=JSON.parse(data),"admin"==data.role){function admin(){function fillingTable(){$.ajax({url:"/getUsers",type:"GET",dataType:"html",beforeSend:function(){$("body").append('\n                                    <div id="preloader">\n                                        <div id="preloader_preload"></div>\n                                    </div>\n                                '),preloader=document.getElementById("preloader_preload")},success:function(data){data=JSON.parse(data);for(let e=0;e<data.length;e++)"admin"==data[e].role&&(data[e].role="Администратор"),"manager"==data[e].role&&(data[e].role="Менеджер"),$("#admin").append(`\n                                        <tr id="${data[e].id}" onclick="userInfo(this)">\n                                            <td>${data[e].second_name}</td>\n                                            <td>${data[e].name}</td>\n                                            <td>${data[e].third_name}</td>\n                                            <td>${data[e].role}</td>\n                                            <td>${data[e].email}</td>\n                                            <td>${data[e].login}</td>\n                                            <td>${data[e].password}</td>\n                                        </tr>\n                                    `);$(".info").append('\n                                    <div id="addNewPerson" onclick="addNewPerson()" class="add_something_main" style="margin-top: -20px;">\n                                        <img style="width: 15px;" src="static/images/plus.svg">\n                                    <div>\n                                '),""!=close&&eval(close)()},complete:function(){$("#loading").remove(),setTimeout(function(){fadeOutPreloader(preloader)},0)}})}function getContent(){$(".info").append('\n                            <div class="row">\n                                <div class="fields" style="width: auto">\n                                    <div class="field active" id="persons" onclick="persons()">Сотрудники</div>\n                                    <div class="field" id="positions" onclick="positions()">Должности</div>\n                                    <div class="field" id="items" onclick="items()">Редактирование товаров</div>\n                                </div>\n                                <div class="category">АДМИН ПАНЕЛЬ</div>\n                            </div>\n                            <table class="table" id="admin">\n                                <tr>\n                                    <th width="170">Фамилия</th>\n                                    <th width="170">Имя</th>\n                                    <th width="170">Отчество</th>\n                                    <th width="130">Должность</th>\n                                    <th width="170">Email</th>\n                                    <th width="120">Логин</th>\n                                    <th width="150">Пароль</th>\n                                </tr>\n                            </table>'),fillingTable()}$(".info").empty(),$('[name="linkCategory"]').removeClass("active"),$("#mini_logo").addClass("active"),getContent()}admin()}}})}function addNewPerson(){$("#addNewPerson").remove(),$(".table, .card_menu").remove(),$(".info").append('\n    <div class="card_menu persons" id="card_menu">\n        <div class="title">\n            <div class="left_side">\n                <span>Добавление сотрудника</span>\n            </div>\n            <div class="right_side">\n                <div class="close" onclick="closePersonCard()">\n                    <img src="static/images/cancel.png">\n                </div>\n            </div>\n        </div>\n        <div class="content">\n            <div class="row_card">\n                <table class="table_block">\n                    <tr>\n                        <td>Фамилия</td>\n                        <td>\n                            <input type="text" id="create_last_name">\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Имя</td>\n                        <td>\n                            <input type="name" id="create_first_name">\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Отчество</td>\n                        <td>\n                            <input type="text" id="create_patronymic">\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Должность</td>\n                        <td>\n                            <select type="text" id="create_role">\n                                <option value="null" selected disabled>Не выбран</option>\n                                <option value="admin">Администратор</option>\n                                <option value="manager">Менеджер</option>\n                            </select>\n                        </td>\n                    </tr>\n                </table>\n                <table class="table_block">\n                    <tr>\n                        <td>Email</td>\n                        <td>\n                            <input type="email" id="create_email">\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Логин</td>\n                        <td>\n                            <input type="login" id="create_login">\n                        </td>\n                    </tr>\n                    <tr>\n                        <td>Пароль</td>\n                        <td>\n                            <input type="text" id="create_password">\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            <div class="next">\n                <button class="btn btn-main" onclick="createNewMember()">Добавить</button>\n            </div>\n        </div>\n    </div>')}function closeThisMenu(e){adminPanel(e)}function editItem(e){let t=e.split("_")[1];$.ajax({url:"/getThisItem",data:{id:t},type:"GET",dataType:"html",beforeSend:function(){$("body").append('\n                <div id="preloader">\n                    <div id="preloader_preload"></div>\n                </div>\n            '),preloader=document.getElementById("preloader_preload")},success:function(e){e=JSON.parse(e)[0],$(".table").remove(),$(".info").append(`\n                <div class="card_menu">\n                    <div class="title">\n                        <div class="left_side">\n                            <span>Изменение данных по товару</span>\n                        </div>\n                        <div class="right_side">\n                            <div class="close" id="items" onclick="closeThisMenu(this.id)">\n                                <img src="static/images/cancel.png">\n                            </div>\n                        </div>\n                    </div>\n                    <div class="content">\n                        <div class="row_card">\n                            <table class="table_block">\n                                <tr>\n                                    <td>Склад</td>\n                                    <td>\n                                        <select type="text" id="stock_id">${function(){let t;$.ajax({url:"/getStocks",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});let n="";n+='<option value="0">Не выбран</option>';for(let i=0;i<t.length;i++)t[i].id==e.Stock_id?n+=`<option selected value="${t[i].id}">${t[i].Name}</option>`:n+=`<option value="${t[i].id}">${t[i].Name}</option>`;return n}()}</select>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>Группа товаров</td>\n                                    <td>\n                                        <select type="text" id="group_id">${function(){let t;$.ajax({url:"/getItemGroup",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});let n="";for(let i=0;i<t.length;i++)t[i].id==e.Group_id?n+=`<option selected value="${t[i].id}">${t[i].Group}</option>`:n+=`<option value="${t[i].id}">${t[i].Group}</option>`;return setTimeout(function(){fadeOutPreloader(preloader)},0),n}()}</select>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>Товар</td>\n                                    <td><input type="text" id="item_product" class="string" value="${e.Name}"></td>\n                                </tr>\n                            </table>\n                            <table class="table_block">\n                                <tr>\n                                    <td>Объем, кг.</td>\n                                    <td><input onkeyup="maskNumber(this.id)" type="text" id="item_volume" class="string" value="${e.Volume}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Фасовка</td>\n                                    <td>\n                                        <select type="text" id="item_packing">${function(){e.Packing;let t=["Насыль","Мешки","ББ"],n="";for(let i=0;i<t.length;i++)e.Packing==t[i]?n+=`<option selected value="${t[i]}">${t[i]}</option>`:n+=`<option value="${t[i]}">${t[i]}</option>`;return n}()}</select>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>Вес, кг.</td>\n                                    <td><input onkeyup="maskNumber(this.id)" type="text" id="item_weight" class="string" value="${e.Weight}"></td>\n                                </tr>\n                            </table>\n                            <table class="table_block">\n                                <tr>\n                                    <td>Юр. лицо</td>\n                                    <td>\n                                        <select type="text" id="item_prefix">\n                                            ${"ООО"==e.Prefix?'\n                        <option selected value="ООО">ООО</option>\n                        <option value="ИП">ИП</option>\n                    ':'\n                        <option value="ООО">ООО</option>\n                        <option selected value="ИП">ИП</option>\n                    '}\n                                        </select>\n                                    </td>\n                                </tr>\n                                <tr>\n                                    <td>НДС</td>\n                                    <td><input maxlength="12" type="number" id="item_vat" class="string" value="${e.NDS}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Цена прайса, руб.</td>\n                                    <td><input onkeyup="maskNumber(this.id)" type="text" id="item_price" class="string" value="${e.Cost}"></td>\n                                </tr>\n                                <tr>\n                                    <td>Закупочная цена, руб.</td>\n                                    <td><input onkeyup="maskNumber(this.id)" type="text" id="item_purchase_price" class="string" value="${e.Purchase_price}"></td>\n                                </tr>\n                            </table> \n                        </div>\n                        <div class="next">\n                            <button class="btn btn-main" id="item_${e.Item_id}" onclick="saveEditItem(this.id)">Изменить товар</button>\n                        </div>\n                    </div>\n                </div>\n            `)},complete:function(){$("#loading").remove(),setTimeout(function(){fadeOutPreloader(preloader)},0)}})}function saveEditItem(e){let t=e.split("_")[1],n=[{type:1,value:"stock_id"},{type:1,value:"group_id"},{type:1,value:"item_product"},{type:1,value:"item_prefix"},{type:2,value:"item_volume"},{type:1,value:"item_packing"},{type:2,value:"item_weight"},{type:2,value:"item_vat"},{type:2,value:"item_price"},{type:2,value:"item_purchase_price"}],i={};for(let e=0;e<n.length;e++)2==n[e].type?i[n[e].value]=deleteSpaces($(`#${n[e].value}`).val()):i[n[e].value]=$(`#${n[e].value}`).val();i.item_fraction="test",i.item_creator="test",i.id=t,$.ajax({url:"/editItem",type:"GET",data:i,dataType:"html",success:function(){closeThisMenu("items")}})}function addNewPosition_Save(){let e=$("#new_position").val().trim();if(""==e)return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px;">Введите должность!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));$.ajax({url:"/addRole",data:{name:e,priority:0},type:"GET",dataType:"html",success:function(){positions()}})}function createNewMember(){let e=["create_last_name","create_first_name","create_patronymic","create_role","create_password","create_login","create_email"],t={};for(let n=0;n<e.length;n++)if(t[e[n]]=$(`#${e[n]}`).val(),""==$(`#${e[n]}`).val()&&"create_email"!=e[n]&&"create_patronymic"!=e[n]||null==$(`#${e[n]}`).val())return $(".page").append($("<div>",{class:"background"}).add('\n                                <div class="modal_select">\n                                    <div class="title">\n                                        <span>Ошибка</span>\n                                        <img onclick="closeModal()" src="static/images/cancel.png">\n                                    </div>\n                                    <div class="content">\n                                        <div class="message">\n                                            <p style="font-size: 14px;">Все поля, кроме почты и отчества, обязательны к заполнению!</p>\n                                        </div>\n                                    </div>\n                                </div>\n                            '));t.id="new",$.ajax({url:"/addUser",data:t,type:"GET",dataType:"html",success:function(){closePersonCard()}})}function getValidationDate(e){let t=/(\d\d)\.(\d\d)\.(\d\d)/.exec(e);return new Date("20"+ +t[3],+t[2]-1,t[1])}function analyticsFilterTable_0(e,t=!1){let n;$.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",beforeSend:function(){$("body").prepend('\n                    <div id="preloader">\n                        <div id="preloader_preload"></div>\n                    </div>\n                '),preloader=document.getElementById("preloader_preload")},success:function(e){n=JSON.parse(e)},complete:function(){setTimeout(function(){fadeOutPreloader(preloader)},0)}});let i=[];for(let t=0;t<n.length;t++){let a=getValidationDate(n[t].account.Date);if(a>=e[0]&&a<=e[1])for(let e=0;e<n[t].items.length;e++)i.push({item:n[t].items[e],account:[n[t].account]})}for(let e=0;e<i.length-1;e++)for(let t=e+1;t<i.length;t++)if(i[e].item.Item_id==i[t].item.Item_id){for(let n=0;n<i[t].account.length;n++)i[e].account.push(i[t].account[n]);i.splice(t,1),t--}function a(){let e="",n=0,a=[];for(let d=0;d<i.length;d++)for(let s=0;s<i[d].account.length;s++){let r=JSON.parse(i[d].account[s].Item_ids),o=JSON.parse(i[d].account[s].Shipping),c=JSON.parse(i[d].account[s].Hello);for(let u=0;u<r.length;u++)if(+r[u].id==+i[d].item.Item_id){let p=+deleteSpaces(o[u])+ +deleteSpaces(c[u])+ +deleteSpaces(i[d].item.Transferred_volume)*+deleteSpaces(i[d].item.Cost);if(t)a.push({product:i[d].item.Name,name:i[d].account[s].Name,volume:returnSpaces(r[u].volume),price:returnSpaces(p),delivery:returnSpaces(o[u]),hello:returnSpaces(c[u]),cost:returnSpaces(i[d].item.Cost),purchase_price:returnSpaces(i[d].item.Purchase_price),earned:returnSpaces(Math.round(+deleteSpaces(i[d].item.Cost)/+deleteSpaces(i[d].item.Volume))-+deleteSpaces(i[d].item.Purchase_price)),profit:returnSpaces((Math.round(+deleteSpaces(i[d].item.Cost)/+deleteSpaces(i[d].item.Volume))-+deleteSpaces(i[d].item.Purchase_price))*+deleteSpaces(r[u].volume))});else{function l(){let e="";return 0==s&&(e+=`<td rowspan="${i[d].account.length}">${i[d].item.Name}</td>`),e+=`<td>${i[d].account[s].Name}</td>\n                                                <td>${returnSpaces(r[u].volume)}</td>\n                                                <td>${returnSpaces(p)}</td>\n                                                <td>${returnSpaces(o[u])}</td>\n                                                <td>${returnSpaces(c[u])}</td>\n                                                <td>${returnSpaces(i[d].item.Cost)}</td>\n                                                <td>${returnSpaces(i[d].item.Purchase_price)}</td>\n                                                <td>${returnSpaces(+deleteSpaces(i[d].item.Cost)-+deleteSpaces(i[d].item.Purchase_price))}</td>\n                                                <td>${returnSpaces((+deleteSpaces(i[d].item.Cost)-+deleteSpaces(i[d].item.Purchase_price))*+deleteSpaces(r[u].volume))}</td>`}let t;e+=t=0==s?`<tbody class="tr_tr"><tr>${l()}</tr>`:s==i[d].account.length-1?`<tr>${l()}</tr></tbody>`:`<tr>${l()}</tr>`,n++}}}return t?a:($("div").is("#analytics_block_hidden")?$("#info_in_accounts_count").html(`${n} ${current_count_accounts(n,"счет",1)}`):($(".fields").append(`\n                    <div id="info_in_accounts">\n                        <span id="info_in_accounts_count" style="margin-right: 5px;">${n} ${current_count_accounts(n,"счет",1)}</span> \n                        <div id="select_period_info_accounts" onclick="visibleSelectPeriodInAnalytics()">\n                            <span id="period_accounts">за последний месяц</span> <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                        </div>\n                    </div>\n                    <div id="analytics_0" name="unload_table" class="btn btn-main btn-div" onclick="unloadThisTable(this.id)" style="width: 90px; margin-left: 30px;">Выгрузить</div>\n                `),$("body").append('<div id="analytics_block_hidden"></div>')),e)}return t?a():`\n            <table class="table analytics">\n                <tr>\n                    <th>Товар</th>\n                    <th width="230">Клиент</th>\n                    <th>Объем, кг.</th>\n                    <th>Цена, руб.</th>\n                    <th>Доставка</th>\n                    <th>Привет</th>\n                    <th>Себестоимость</th>\n                    <th>Закупочная цена</th>\n                    <th>Заработали</th>\n                    <th>Прибыль</th>\n                </tr>\n                ${a()}\n            </table>\n        `}function analyticsFilterTable_1(e,t=!1){let n,i;$.ajax({url:"/getStockTable",type:"GET",async:!1,dataType:"html",success:function(e){i=JSON.parse(e)}});let a=[];for(let e=0;e<i.length;e++)for(let t=0;t<i[e].items.length;t++)a.push(i[e].items[t]);function l(){$.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",beforeSend:function(){$("body").prepend('\n                        <div id="preloader">\n                            <div id="preloader_preload"></div>\n                        </div>\n                    '),preloader=document.getElementById("preloader_preload")},complete:function(){setTimeout(function(){fadeOutPreloader(preloader)},0)},success:function(e){n=JSON.parse(e)}});let l=[];for(let e=0;e<a.length;e++)l[e]=0;let d="";function s(t){let i=JSON.parse(t.Item_ids);for(let a=0;a<n.length;a++){let l=JSON.parse(n[a].account.Item_ids),d=getValidationDate(n[a].account.Date);if(t.Name===n[a].account.Name&&t.id!==n[a].account.id&&d>=e[0]&&d<=e[1]){for(let e=0;e<l.length;e++)i.push(l[e]);for(let e=0;e<i.length-1;e++)for(let t=e+1;t<i.length;t++)i[e].id===i[t].id&&(i[e].volume=+deleteSpaces(i[e].volume)+ +deleteSpaces(i[t].volume),i.splice(t,1),t--);n.splice(a,1),a--}}return i}let r=0,o=[];for(let u=0;u<n.length;u++){let p=getValidationDate(n[u].account.Date);if(p>=e[0]&&p<=e[1]){let e=s(n[u].account);if(e.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),t)for(let t=0;t<e.length;t++)for(let l=0;l<a.length;l++){let d=0;for(let e=0;e<o.length;e++)o[e].name==n[u].account.Name&&d++;if(0==d&&o.push({name:n[u].account.Name,list:[]}),+a[l].Item_id==+e[t].id){for(let a=0;a<o.length;a++)if(n[u].account.Name==o[a].name)for(let n=0;n<i.length;n++)for(let l=0;l<i[n].items.length;l++)i[n].items[l].Item_id==e[t].id&&o[a].list.push({name:i[n].items[l].Name,volume:deleteSpaces(e[t].volume)});e.length-1!=t&&t++}else for(let e=0;e<o.length;e++)if(n[u].account.Name==o[e].name)for(let t=0;t<i.length;t++)for(let n=0;n<i[t].items.length;n++)i[t].items[n].Item_id==a[l].Item_id&&o[e].list.push({name:i[t].items[n].Name,volume:"0"})}else{function c(){let t="";for(let n=0;n<e.length;n++)for(let i=0;i<a.length;i++)+a[i].Item_id==+e[n].id?(l[i]+=+deleteSpaces(e[n].volume),t+=`<td id="item_${i+1}">${returnSpaces(e[n].volume)}</td>`,e.length-1!=n&&n++):t+=`<td id="item_${i+1}">0</td>`;return t}d+=`\n                            <tr>\n                                <td>${n[u].account.Name}</td>\n                                ${c()}\n                            </tr>\n                        `,r++}}}if(t)return o;return $("div").is("#analytics_block_hidden")?$("#info_in_accounts_count").html(`${r} ${current_count_accounts(r,"счет",1)}`):($(".fields").append(`\n                    <div id="info_in_accounts">\n                        <span id="info_in_accounts_count" style="margin-right: 5px;">${r} ${current_count_accounts(r,"счет",1)}</span> \n                        <div id="select_period_info_accounts" onclick="visibleSelectPeriodInAnalytics()">\n                            <span id="period_accounts">за последний месяц</span> <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                        </div>\n                    </div>\n                    <div id="analytics_1" name="unload_table" class="btn btn-main btn-div" onclick="unloadThisTable(this.id)" style="width: 90px; margin-left: 30px;">Выгрузить</div>\n                `),$("body").append('<div id="analytics_block_hidden"></div>')),d+=`<tr>${function(){let e="<td></td>";for(let t=0;t<l.length;t++)e+=`<td class="bold">${returnSpaces(l[t])}</td>`;return e}()}</tr>`}return a.sort(function(e,t){return e.Item_id>t.Item_id?1:e.Item_id<t.Item_id?-1:0}),t?l():`\n                <div style="overflow-x: auto; overflow-y: scroll; position: relative;">\n                    <table class="table analytics" style="width: max-content; margin-bottom: 0px">\n                        <tr>\n                            <th width="270">Клиент</th>\n                            ${function(){let e="";for(let t=0;t<a.length;t++)e+=`<th width="120">${a[t].Name}</th>`;return e}()}\n                        </tr>\n                        ${l()}\n                    </table>\n                </div>\n            `}function analyticsFilterTable_2(e,t=!1){let n,i;$.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",success:function(e){n=JSON.parse(e)}}),$.ajax({url:"/getDeliveries",type:"GET",async:!1,dataType:"html",beforeSend:function(){$("body").prepend('\n                    <div id="preloader">\n                        <div id="preloader_preload"></div>\n                    </div>\n                '),preloader=document.getElementById("preloader_preload")},complete:function(){setTimeout(function(){fadeOutPreloader(preloader)},0)},success:function(e){i=JSON.parse(e)}});let a=[],l=0;for(let t=0;t<n.length;t++){let i=getValidationDate(n[t].account.Date);if(i>=e[0]&&i<=e[1])for(let e=0;e<n[t].items.length;e++)a.push({items:[n[t].items[e]],account:n[t].account})}for(let e=0;e<a.length-1;e++)for(let t=e+1;t<a.length;t++)if(a[e].account.Name===a[t].account.Name&&+a[e].account.id==+a[t].account.id){for(let n=0;n<a[t].items.length;n++)a[e].items.push(a[t].items[n]);a.splice(t,1),t--}let d=null;function s(){let e="",n=[];for(let r=0;r<a.length;r++){let o='<tbody class="tr_tr">';for(let e=0;e<a[r].items.length;e++){let c=JSON.parse(a[r].account.Item_ids),u=JSON.parse(a[r].account.Items_amount);for(let p=0;p<c.length;p++){for(let m=0;m<i.length;m++){let _=JSON.parse(i[m].delivery.Item_ids);for(let f=0;f<_.length;f++)if(+c[p].id==+a[r].items[e].Item_id&&+a[r].items[e].Item_id==+_[f]&&+i[m].delivery.Account_id==+a[r].account.id){if(null==d)d=+i[m].delivery.id;else if(d!=+i[m].delivery.id)continue;if(t)n.push({name:a[r].account.Name,product:a[r].items[e].Name,volume:returnSpaces(c[p].volume),start_date:null!=i[m].delivery.Start_date||""!=i[m].delivery.Start_date?i[m].delivery.Start_date:"Не указана",amount:returnSpaces(u[p].amount)});else{function s(){let t="";return 0==e&&(t+=`<td rowspan="${a[r].items.length}">${a[r].account.Name}</td>`),t+=`<td>${a[r].items[e].Name}</td>\n                                                        <td>${returnSpaces(c[p].volume)}</td>\n                                                        <td>${null!=i[m].delivery.Start_date||""!=i[m].delivery.Start_date?i[m].delivery.Start_date:"Не указана"}</td>\n                                                        <td>${returnSpaces(u[p].amount)}</td>`}o+=`<tr>${s()}</tr>`,l++}}}d=null}}'<tbody class="tr_tr">'!=o&&(e+=o+"</tbody>")}return t?n:($("div").is("#analytics_block_hidden")?$("#info_in_accounts_count").html(`${l} ${current_count_accounts(l,"счет",1)}`):($(".fields").append(`\n                    <div id="info_in_accounts">\n                        <span id="info_in_accounts_count" style="margin-right: 5px;">${l} ${current_count_accounts(l,"счет",1)}</span> \n                        <div id="select_period_info_accounts" onclick="visibleSelectPeriodInAnalytics()">\n                            <span id="period_accounts">за последний месяц</span> <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                        </div>\n                    </div>\n                    <div id="analytics_2" name="unload_table" class="btn btn-main btn-div" onclick="unloadThisTable(this.id)" style="width: 90px; margin-left: 30px;">Выгрузить</div>\n                `),$("body").append('<div id="analytics_block_hidden"></div>')),e)}return t?s():`\n                <table class="table analytics">\n                    <tr>\n                        <th width="350">Клиент</th>\n                        <th>Товары</th>\n                        <th>Вес</th>\n                        <th>Дата отгрузки</th>\n                        <th>Сумма, руб.</th>\n                    </tr>\n                    ${s()}\n                </table>\n            `}function analyticsFilterTable_3(e,t=!1,n=""){function i(){let i;$.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",beforeSend:function(){$("body").prepend('\n                        <div id="preloader">\n                            <div id="preloader_preload"></div>\n                        </div>\n                    '),preloader=document.getElementById("preloader_preload")},complete:function(){setTimeout(function(){fadeOutPreloader(preloader)},0)},success:function(e){i=JSON.parse(e)}});let a="",l=[],d=[],s=0;for(let t=0;t<i.length;t++){let a=getValidationDate(i[t].account.Date),d=""==i[t].account.Shipment_hello?"Не оплачено":"Оплачено";if(a>=e[0]&&a<=e[1]&&(n==d||""==n)){let e=JSON.parse(i[t].account.Item_ids),n=JSON.parse(i[t].account.Hello),a=e.reduce((e,t)=>({volume:+deleteSpaces(e.volume)+ +deleteSpaces(t.volume)})),d=0,r=0,o=categoryInListClient[1][1];for(let e=0;e<o.length;e++)if(o[e].Name===i[t].account.Name){r=o[e].id;break}for(let t=0;t<e.length;t++)d+=+deleteSpaces(e[t].volume)*+deleteSpaces(n[t]);let c=""==i[t].account.Shipment_hello?'<span class="red">Не оплачено</span>':'<span class="green">Оплачено</span>';l.push({client_id:r,name:i[t].account.Name,shipment_hello:c,volume:+deleteSpaces(a.volume),average_volume:Math.ceil(+deleteSpaces(d)/+deleteSpaces(a.volume)),amount_hello:Math.ceil(+deleteSpaces(d)),amount:Math.round(.9*+deleteSpaces(i[t].account.Sum))}),s++}}$("div").is("#analytics_block_hidden")?$("#info_in_accounts_count").html(`${s} ${current_count_accounts(s,"счет",1)}`):($(".fields").append(`\n                    <div id="info_in_accounts">\n                        <span id="info_in_accounts_count" style="margin-right: 5px;">${s} ${current_count_accounts(s,"счет",1)}</span> \n                        <div id="select_period_info_accounts" onclick="visibleSelectPeriodInAnalytics()">\n                            <span id="period_accounts">за последний месяц</span> <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                        </div>\n                    </div>\n                    <div id="analytics_3" name="unload_table" class="btn btn-main btn-div" onclick="unloadThisTable(this.id)" style="width: 90px; margin-left: 30px;">Выгрузить</div>\n                `),$("body").append('<div id="analytics_block_hidden"></div>'));for(let e=0;e<l.length-1;e++)for(let t=e+1;t<l.length;t++)l[e].name===l[t].name&&(l[e].volume=+deleteSpaces(l[e].volume)+ +deleteSpaces(l[t].volume),l[e].amount_hello=+deleteSpaces(l[e].amount_hello)+ +deleteSpaces(l[t].amount_hello),l[e].average_volume=Math.ceil(+deleteSpaces(l[e].amount_hello)/+deleteSpaces(l[e].volume)),l[e].amount=Math.round(.9*(+deleteSpaces(l[e].amount)+ +deleteSpaces(l[t].amount))),l.splice(t,1),t--);for(let e=0;e<l.length;e++)t?d.push({name:l[e].name,volume:returnSpaces(l[e].volume),average_volume:returnSpaces(l[e].average_volume),hello:returnSpaces(l[e].amount_hello),amount:returnSpaces(l[e].amount)}):a+=`\n                        <tr id="client_${l[e].client_id}_search" onclick="openCardMenu(this)">\n                            <td>${l[e].name}</td>\n                            <td>${l[e].shipment_hello}</td>\n                            <td>${returnSpaces(l[e].volume)}</td>\n                            <td>${returnSpaces(l[e].average_volume)}</td>\n                            <td>${returnSpaces(l[e].amount_hello)}</td>\n                            <td>${returnSpaces(l[e].amount)}</td>\n                        </tr>\n                    `;return t?d:a}return t?i():`\n                <table class="table analytics">\n                    <tr>\n                        <th width="350">Клиент</th>\n                        <th id="an_status" onclick="selectFilterStatusAn(this)">\n                            <div class="flex jc-sb">\n                                <span>Статус</span>\n                                <img src="static/images/dropmenu.svg" class="drop_down_img drop_arrow">\n                            </div>\n                        </th>\n                        <th>Объём</th>\n                        <th>Сколько</th>\n                        <th>Сумма, руб.</th>\n                        <th>Итого</th>\n                    </tr>\n                    ${i()}\n                </table>\n            `}function analyticsFilterTable_4(e,t=!1){let n,i;$.ajax({url:"/getAccounts",type:"GET",async:!1,dataType:"html",success:function(e){i=JSON.parse(e)}}),$.ajax({url:"/getStockTable",type:"GET",async:!1,dataType:"html",beforeSend:function(){$("body").prepend('\n                    <div id="preloader">\n                        <div id="preloader_preload"></div>\n                    </div>\n                '),preloader=document.getElementById("preloader_preload")},complete:function(){setTimeout(function(){fadeOutPreloader(preloader)},0)},success:function(e){n=JSON.parse(e)}});let a=[];for(let e=0;e<n.length;e++)for(let t=0;t<n[e].items.length;t++)a.push(n[e].items[t]);a.sort(function(e,t){return e.Item_id>t.Item_id?1:e.Item_id<t.Item_id?-1:0});let l=[],d=0;for(let e=0;e<a.length;e++)l[e]=0;function s(t){let n=i.slice(),a=JSON.parse(t.Items_amount);for(let i=0;i<n.length;i++){let l=JSON.parse(n[i].account.Items_amount),d=getValidationDate(n[i].account.Date);if(t.Manager_id==n[i].account.Manager_id&&t.id!=n[i].account.id&&d>=e[0]&&d<=e[1]){for(let e=0;e<l.length;e++)a.push(l[e]);for(let e=0;e<a.length-1;e++)for(let t=e+1;t<a.length;t++)a[e].id===a[t].id&&(a[e].amount=+deleteSpaces(a[e].amount)+ +deleteSpaces(a[t].amount),a.splice(t,1),t--);n.splice(i,1),i--}}return a}function r(t){let n=i.slice(),a=JSON.parse(t.Item_ids);for(let i=0;i<n.length;i++){let l=JSON.parse(n[i].account.Item_ids),d=getValidationDate(n[i].account.Date);if(t.Manager_id==n[i].account.Manager_id&&t.id!=n[i].account.id&&d>=e[0]&&d<=e[1]){for(let e=0;e<l.length;e++)a.push(l[e]);for(let e=0;e<a.length-1;e++)for(let t=e+1;t<a.length;t++)a[e].id===a[t].id&&(a[e].volume=+deleteSpaces(a[e].volume)+ +deleteSpaces(a[t].volume),a.splice(t,1),t--);n.splice(i,1),i--}}return a}function o(){let n;$.ajax({url:"/getUsers",type:"GET",async:!1,dataType:"html",success:function(e){n=JSON.parse(e)}});let o=[];for(let e=0;e<n.length;e++)"manager"===n[e].role&&o.push(n[e]);function c(n){let o="";for(let u=0;u<i.length;u++){let p=getValidationDate(i[u].account.Date);if(i[u].account.Manager_id==n&&p>=e[0]&&p<=e[1]){let e=r(i[u].account),n=s(i[u].account);e.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),n.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0});let p=0;for(let e=0;e<n.length;e++)p+=Math.round(+deleteSpaces(n[e].amount));d+=p,o+=`<td>${returnSpaces(p)}</td>`;let m=[{id:"total",name:"Итого",volume:+deleteSpaces(p)}];if(t)for(let t=0;t<e.length;t++)for(let n=0;n<a.length;n++){let i=0;for(let n=0;n<m.length;n++)m[n].id==e[t].id&&i++;function c(e){for(let t=0;t<a.length;t++)if(a[t].Item_id==e)return a[t].Name}if(0==i&&m.push({id:+e[t].id,name:c(+e[t].id)}),+a[n].Item_id==+e[t].id){for(let n=0;n<m.length;n++)m[n].id==e[t].id&&(m[n].volume=+deleteSpaces(e[t].volume));e.length-1!=t&&t++}else{let e=0;for(let t=0;t<m.length;t++)m[t].id!=a[n].Item_id&&e++;e==m.length&&m.push({id:a[n].Item_id,name:a[n].Name,volume:0})}}else for(let t=0;t<e.length;t++)for(let n=0;n<a.length;n++)+a[n].Item_id==+e[t].id?(l[n]+=+deleteSpaces(e[t].volume),o+=`<td id="item_${n+1}">${returnSpaces(e[t].volume)}</td>`,e.length-1!=t&&t++):o+=`<td id="item_${n+1}">0</td>`;if(t)return m;break}}return o}function u(e){for(let t=0;t<i.length;t++)if(i[t].account.Manager_id==e)return c(e);return t?{total:0}:"<td>0</td>".repeat(a.length+1)}let p="",m=0,_=[];for(let e=0;e<o.length;e++)t?_.push({manager:o[e].second_name,list:u(o[e].id)}):(p+=`\n                        <tr>\n                            <td>${o[e].second_name}</td>\n                            ${u(o[e].id)}\n                        </tr>\n                    `,m++);if(t)return _;return $("div").is("#analytics_block_hidden")?$("#info_in_accounts_count").html(`${m} ${current_count_accounts(m,"менеджер",1)}`):($(".fields").append(`\n                    <div id="info_in_accounts">\n                        <span id="info_in_accounts_count" style="margin-right: 5px;">${m} ${current_count_accounts(m,"менеджер",1)}</span> \n                        <div id="select_period_info_accounts" onclick="visibleSelectPeriodInAnalytics()">\n                            <span id="period_accounts">за последний месяц</span> <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                        </div>\n                    </div>\n                    <div id="analytics_4" name="unload_table" class="btn btn-main btn-div" onclick="unloadThisTable(this.id)" style="width: 90px; margin-left: 30px;">Выгрузить</div>\n                `),$("body").append('<div id="analytics_block_hidden"></div>')),p+=`<tr>${function(){let e=`<td></td><td>${returnSpaces(d)}</td>`;for(let t=0;t<l.length;t++)e+=`<td class="bold">${returnSpaces(l[t])}</td>`;return e}()}</tr>`}return t?o():`\n                <div style="overflow-x: auto; overflow-y: scroll; position: relative;">\n                    <table class="table analytics" style="width: max-content; margin-bottom: 0px">\n                        <tr>\n                            <th width="170">Менеджер</th>\n                            <th width="130">Итого</th>\n                            ${function(){let e="";for(let t=0;t<a.length;t++)e+=`<th width="120">${a[t].Name}</th>`;return e}()}\n                        </tr>\n                        ${o()}\n                    </table>\n                </div>\n            `}function analyticsFilterTable_5(e,t=!1,n=""){function i(){let i="";return $.ajax({url:"/getManagerStat",type:"GET",async:!1,dataType:"html",beforeSend:function(){$("body").prepend('\n                        <div id="preloader">\n                            <div id="preloader_preload"></div>\n                        </div>\n                    '),preloader=document.getElementById("preloader_preload")},complete:function(){setTimeout(function(){fadeOutPreloader(preloader)},0)},success:function(a){result=JSON.parse(a);let l=0,d=[];for(let a=0;a<result.data.length;a++){let s=0,r=0;for(let t in result.data[a].orgs){let n=getValidationDate(result.data[a].orgs[t]);n>=e[0]&&n<=e[1]&&r++}let o='<tbody class="tr_tr">';for(let i in result.data[a].orgs){let l=getValidationDate(result.data[a].orgs[i]);if(l>=e[0]&&l<=e[1]&&(n==result.data[a].name||""==n)){if(t)d.push({manager:result.data[a].name,name:i,last_comment:result.data[a].orgs[i]});else{let e=i.split("$$");o+=0==s?`\n                                            <tr>\n                                                <td name="username_analytics" rowspan="${r}">${result.data[a].name}</td>\n                                                <td onclick="openThisCardMenu(this)" id="${e[2]}_${e[1]}_search">${e[0]}</td>\n                                                <td>${result.data[a].orgs[i]}</td>\n                                            </tr>\n                                        `:`\n                                            <tr>\n                                                <td onclick="openThisCardMenu(this)" id="${e[2]}_${e[1]}_search">${e[0]}</td>\n                                                <td>${result.data[a].orgs[i]}</td>\n                                            </tr>\n                                        `}s++}}'<tbody class="tr_tr">'==o||t||(i+=o+"</tbody>"),l+=s}t?i=d:$("div").is("#analytics_block_hidden")?$("#info_in_accounts_count").html(`${l} ${current_count_accounts(l,"комментари",3)}`):($(".fields").append(`\n                            <div id="info_in_accounts">\n                                <span id="info_in_accounts_count" style="margin-right: 5px;">${l} ${current_count_accounts(l,"комментари",3)}</span> \n                                <div id="select_period_info_accounts" onclick="visibleSelectPeriodInAnalytics()">\n                                    <span id="period_accounts">за последний месяц</span> <img src="static/images/dropmenu_black.svg" class="drop_down_img">\n                                </div>\n                            </div>\n                            <div id="analytics_5" name="unload_table" class="btn btn-main btn-div" onclick="unloadThisTable(this.id)" style="width: 90px; margin-left: 30px;">Выгрузить</div>\n                        `),$("body").append('<div id="analytics_block_hidden"></div>'))}}),i}return t?i():`\n                <table class="table analytics">\n                    <tr>\n                        <th id="pd_manager" onclick="selectManagerAnalytics(this)">\n                            <div class="flex jc-sb">\n                                <span>Менеджер</span>\n                                <img src="static/images/dropmenu.svg" class="drop_down_img drop_arrow">\n                            </div>\n                        </th>\n                        <th>Наименование</th>\n                        <th width="350">Дата последнего комментария</th>\n                    </tr>\n                    ${i()}\n                </table>\n            `}function openThisCardMenu(e){let t=[{id:"carrier",request:"/getCarriers",table:categoryInListCarrier},{id:"client",request:"/getClients",table:categoryInListClient},{id:"provider",request:"/getProviders",table:categoryInListProvider}];for(let n=0;n<t.length;n++)if(t[n].id==e.id.split("_")[0]){$.ajax({url:t[n].request,type:"GET",dataType:"html",success:function(i){i=JSON.parse(i),null==t[n].table[1][1]&&t[n].table[1].push(i),openCardMenu(e)}});break}}function selectManagerAnalytics(e){let t=e.id;function n(){let e,t=$("<ul>",{class:"list"}),n=[];$.ajax({url:"/getUsers",type:"GET",async:!1,dataType:"html",success:function(t){e=JSON.parse(t)}});for(let t=0;t<e.length;t++)for(let i of $('[name="username_analytics"]'))e[t].second_name==$(i).html().split(" ")[1]&&e[t].name==$(i).html().split(" ")[0]&&n.push({name:$(i).html(),id:e[t].id});for(let e=0;e<n.length;e++)t.append($("<li>",{html:n[e].name,id:n[e].id,onclick:"sortTableByManagersAn(this)"}));return t}if($(".filter_list").fadeOut(200),setTimeout(function(){$(".filter_list").remove()},200),$(`#${t} .drop_arrow`).hasClass("drop_active"))return $(`#${t} .drop_arrow`).removeClass("drop_active");$(".drop_arrow").removeClass("drop_active"),$(`#${t} .drop_arrow`).addClass("drop_active"),setTimeout(function(){$(e).append($("<div>",{class:"filter_list",css:{top:`${$(e).height()+30}px`},append:n()})),$(".filter_list").fadeIn(100)},250)}function sortTableByManagersAn(e){let t,n=e.innerHTML;$(".centerBlock .header .cancel").remove(),$.ajax({url:"/getUsers",type:"GET",async:!1,dataType:"html",success:function(e){t=JSON.parse(e)}});let i=$("#period_accounts").html(),a=[{id:"day",text:"за последний день"},{id:"weak",text:"за последнюю неделю"},{id:"month",text:"за последний месяц"},{id:"year",text:"за последний год"},{id:"all",text:"за все время"}];for(let e=0;e<a.length;e++)if(a[e].text==i){$(".table").remove(),$(".info").append(analyticsFilterTable_5(datePeriod(a[e].id),!1,n));break}}function visibleSelectPeriodInAnalytics(){$("div").is(".period_info_accounts")?$(".period_info_accounts").remove():$("#select_period_info_accounts").append('\n                <div class="period_info_accounts">\n                    <ul>\n                        <li id="day" onclick="selectPeriodInAnalytics(this.id)">за последний день</li>\n                        <li id="weak" onclick="selectPeriodInAnalytics(this.id)">за последнюю неделю</li>\n                        <li id="month" onclick="selectPeriodInAnalytics(this.id)">за последний месяц</li>\n                        <li id="year" onclick="selectPeriodInAnalytics(this.id)">за последний год</li>\n                        <li id="all" onclick="selectPeriodInAnalytics(this.id)">за все время</li>\n                    </ul>\n                </div>\n            ')}function selectPeriodInAnalytics(e){let t=datePeriod(e),n=[{function:analyticsFilterTable_0,name:"Прибыль по клиентам"},{function:analyticsFilterTable_1,name:"Сводный по объёмам"},{function:analyticsFilterTable_2,name:"По клиентам"},{function:analyticsFilterTable_3,name:"По приветам"},{function:analyticsFilterTable_4,name:"Отгрузки менеджеров"},{function:analyticsFilterTable_5,name:"Проделанная работа"}];for(let e=0;e<n.length;e++)if(n[e].name==$("#analytics_reports #active_field").html()){$(".table").remove(),$(".info").append(n[e].function(t));break}}function datePeriod(e){let t=[{id:"day",period:0,text:"за последний день"},{id:"weak",period:7,text:"за последнюю неделю"},{id:"month",period:30,text:"за последний месяц"},{id:"year",period:365,text:"за последний год"},{id:"all",period:5475,text:"за все время"}];for(let n=0;n<t.length;n++)if(e==t[n].id){let e=getCurrentDate("year"),i=/(\d\d)\.(\d\d)\.(\d\d)/.exec(e),a=new Date("20"+ +i[3],+i[2],i[1]),l=new Date("20"+ +i[3],+i[2],i[1]);return l.setDate(l.getDate()-t[n].period),$("#period_accounts").html(t[n].text),[l,a]}}function unloadThisTable(e){let t=e.split("_")[1],n=[{function:analyticsFilterTable_0,id:0},{function:analyticsFilterTable_1,id:1},{function:analyticsFilterTable_2,id:2},{function:analyticsFilterTable_3,id:3},{function:analyticsFilterTable_4,id:4},{function:analyticsFilterTable_5,id:5}];for(let e=0;e<n.length;e++)if(n[e].id==t){let i=n[e].function(datePeriod("all"),!0);const a=document.createElement("a");a.href=`/excelStat?id=${t}&data=${JSON.stringify(i)}`,a.download="Аналитика.xlsx",a.click()}}function selectFilterStatusAn(e){let t=e.id;function n(){let e=$("<ul>",{class:"list"}),t=["Оплачено","Не оплачено"];for(let n=0;n<t.length;n++)e.append(`\n                    <li id="${n+1}" onclick="sortTableByStatusAn(this)">${t[n]}</li>\n                `);return e}if($(".filter_list").fadeOut(200),setTimeout(function(){$(".filter_list").remove()},200),$(`#${t} .drop_arrow`).hasClass("drop_active"))return $(`#${t} .drop_arrow`).removeClass("drop_active");$(".drop_arrow").removeClass("drop_active"),$(`#${t} .drop_arrow`).addClass("drop_active"),setTimeout(function(){$(e).append($("<div>",{class:"filter_list",css:{top:`${$(e).height()+30}px`},append:n()})),$(".filter_list").fadeIn(100)},250)}function sortTableByStatusAn(e){let t=e.innerHTML;$(".centerBlock .header .cancel").remove();let n=$("#period_accounts").html(),i=[{id:"day",text:"за последний день"},{id:"weak",text:"за последнюю неделю"},{id:"month",text:"за последний месяц"},{id:"year",text:"за последний год"},{id:"all",text:"за все время"}];for(let e=0;e<i.length;e++)if(i[e].text==n){$(".table").remove(),$(".info").append(analyticsFilterTable_3(datePeriod(i[e].id),!1,t));break}setTimeout(function(){$("#an_status .drop_arrow").removeClass("drop_active")},150)}